
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My code works, I don&#8217;t know why.</title>
  <meta name="author" content="Wen Liao">
  <meta property="og:image" content="https://wen00072.github.io/files/pb.jpg" />


  
  <meta name="description" content="接續前一篇的話題。在查資料的時候看到valgrind可以和gdb合作，試了一下發現他的作法和我想的不一樣。原本以為是valgrind跑出來以後直接把漏掉的call stack和program counter傳給gdb，而gdb把他當成一種中斷點。結果完全不是，他的用法是： 跑valgrind， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wen00072.github.io/posts/10/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My code works, I don't know why." type="application/atom+xml">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My code works, I don&#8217;t know why.</a></h1>
  
    <h2>國王的耳朵是驢耳朵</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="wen00072.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/categories">Categories</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/29/catch-the-leak-gdb-and-valgrind-siamese-juggling/">抓漏 - Gdb 和 Valgrind 合體技</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-29T08:27:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:27 am</span></time>
        
           | <a href="/blog/2014/11/29/catch-the-leak-gdb-and-valgrind-siamese-juggling/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/11/29/catch-the-leak-gdb-and-valgrind-siamese-juggling/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>接續<a href="http://wen00072.github.io/blog/2014/11/29/catching-leakage-use-valgrind-checking-c-memory-leak">前一篇</a>的話題。在查資料的時候看到valgrind可以和gdb合作，試了一下發現他的作法和我想的不一樣。原本以為是valgrind跑出來以後直接把漏掉的call stack和program counter傳給gdb，而gdb把他當成一種中斷點。結果完全不是，他的用法是：</p>

<ul>
<li>跑valgrind，參數指定要和gdb合體，還有你要抓漏的程式</li>
<li>另外一邊執行gdb，載入你要抓漏的程式</li>
<li>gdb 連到valgrind</li>
<li>從gdb中設<strong>懷疑漏掉</strong>的中斷點</li>
<li>從gdb叫valgrind開始執行你要抓漏的程式，gdb將會中斷在你設置的中斷點</li>
<li>在使用valgrind提供的指令，比對執行中斷點之前和之後是否有memory leak</li>
</ul>


<p>測試程式碼和測試環境和<a href="http://wen00072.github.io/blog/2014/11/29/catching-leakage-use-valgrind-checking-c-memory-leak">前一篇</a>一模一樣，所以就請自行看連結。</p>

<h2>合體示範</h2>

<ul>
<li>跑valgrind，參數指定要和gdb合體，還有你要抓漏的程式

<ul>
<li><code>valgrind --vgdb=yes --vgdb-error=0 ./你要抓漏的程式</code></li>
</ul>
</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ valgrind --vgdb=yes --vgdb-error=0 ./leak
</span><span class='line'>==28450== Memcheck, a memory error detector
</span><span class='line'>==28450== Copyright (C) 2002-2013, and GNU GPL'd, by Julian Seward et al.
</span><span class='line'>==28450== Using Valgrind-3.10.0.SVN and LibVEX; rerun with -h for copyright info
</span><span class='line'>==28450== Command: ./leak
</span><span class='line'>==28450== 
</span><span class='line'>==28450== (action at startup) vgdb me ... 
</span><span class='line'>==28450== 
</span><span class='line'>==28450== TO DEBUG THIS PROCESS USING GDB: start GDB like this
</span><span class='line'>==28450==   /path/to/gdb ./leak
</span><span class='line'>==28450== and then give GDB the following command
</span><span class='line'>==28450==   target remote | /usr/lib/valgrind/../../bin/vgdb --pid=28450
</span><span class='line'>==28450== --pid is optional if only one valgrind process is running
</span><span class='line'>==28450== </span></code></pre></td></tr></table></div></figure>


<ul>
<li>另外一邊執行gdb，載入你要抓漏的程式</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gdb ./leak
</span><span class='line'>GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
</span><span class='line'>Copyright (C) 2014 Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
</span><span class='line'>and "show warranty" for details.
</span><span class='line'>This GDB was configured as "x86_64-linux-gnu".
</span><span class='line'>Type "show configuration" for configuration details.
</span><span class='line'>For bug reporting instructions, please see:
</span><span class='line'>&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
</span><span class='line'>Find the GDB manual and other documentation resources online at:
</span><span class='line'>&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
</span><span class='line'>For help, type "help".
</span><span class='line'>Type "apropos word" to search for commands related to "word"...
</span><span class='line'>Reading symbols from ./leak...done.
</span><span class='line'>(gdb) </span></code></pre></td></tr></table></div></figure>


<ul>
<li>gdb 連到valgrind

<ul>
<li><code>target remote | vgdb</code></li>
</ul>
</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(gdb)  target remote | vgdb
</span><span class='line'>Remote debugging using | vgdb
</span><span class='line'>relaying data between gdb and process 28450
</span><span class='line'>Reading symbols from /lib64/ld-linux-x86-64.so.2...Reading symbols from /usr/lib/debug//lib/x86_64-linux-gnu/ld-2.19.so...done.
</span><span class='line'>done.
</span><span class='line'>Loaded symbols for /lib64/ld-linux-x86-64.so.2
</span><span class='line'>0x00000000040012d0 in _start () from /lib64/ld-linux-x86-64.so.2
</span><span class='line'>(gdb) </span></code></pre></td></tr></table></div></figure>


<ul>
<li>從gdb中設<strong>懷疑漏掉</strong>的中斷點</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(gdb) b 47
</span><span class='line'>Breakpoint 1 at 0x400703: file leak.c, line 47.
</span><span class='line'>(gdb) b 48
</span><span class='line'>Breakpoint 2 at 0x400708: file leak.c, line 48.</span></code></pre></td></tr></table></div></figure>


<p>47, 48行內容是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">47</span>      <span class="nf">leak1</span><span class="p">();</span>
</span><span class='line'><span class="mi">48</span>        <span class="n">ch_ptr</span> <span class="o">=</span> <span class="n">leak2</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>從gdb叫valgrind開始執行你要抓漏的程式，gdb將會中斷在你設置的中斷點</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">c</span>
</span><span class='line'><span class="n">Continuing</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">47</span>
</span><span class='line'><span class="mi">47</span>        <span class="n">leak1</span><span class="p">();</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>在使用valgrind提供的指令，比對執行中斷點之前和之後是否有memory leak

<ul>
<li>詳細指令可以在gdb中打<code>help monitor</code>查詢</li>
</ul>
</li>
</ul>


<p>執行中斷點前</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">monitor</span> <span class="n">leak_check</span> <span class="n">full</span> <span class="n">reachable</span> <span class="n">any</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span> <span class="n">All</span> <span class="n">heap</span> <span class="n">blocks</span> <span class="n">were</span> <span class="n">freed</span> <span class="o">--</span> <span class="n">no</span> <span class="n">leaks</span> <span class="n">are</span> <span class="n">possible</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>
</span></code></pre></td></tr></table></div></figure>


<p>執行下一步後再檢查</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">n</span>
</span><span class='line'>
</span><span class='line'><span class="n">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">48</span>
</span><span class='line'><span class="mi">48</span>        <span class="n">ch_ptr</span> <span class="o">=</span> <span class="n">leak2</span><span class="p">();</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">monitor</span> <span class="n">leak_check</span> <span class="n">full</span> <span class="n">reachable</span> <span class="n">any</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span> <span class="mi">100</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span> <span class="n">are</span> <span class="n">still</span> <span class="n">reachable</span> <span class="n">in</span> <span class="n">loss</span> <span class="n">record</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">1</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">at</span> <span class="mh">0x4C2AB80</span><span class="o">:</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">valgrind</span><span class="o">/</span><span class="n">vgpreload_memcheck</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">linux</span><span class="p">.</span><span class="n">so</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x40065E</span><span class="o">:</span> <span class="n">leak1</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">11</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x400707</span><span class="o">:</span> <span class="n">main</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">47</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span> <span class="n">LEAK</span> <span class="nl">SUMMARY</span><span class="p">:</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">definitely</span> <span class="nl">lost</span><span class="p">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">indirectly</span> <span class="nl">lost</span><span class="p">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>      <span class="n">possibly</span> <span class="nl">lost</span><span class="p">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">still</span> <span class="nl">reachable</span><span class="p">:</span> <span class="mi">100</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>         <span class="nl">suppressed</span><span class="p">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
</span></code></pre></td></tr></table></div></figure>


<p>多執行幾步後再看看leak情況</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">n</span>
</span><span class='line'><span class="mi">49</span>        <span class="k">if</span><span class="p">(</span><span class="n">ch_ptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">n</span>
</span><span class='line'><span class="mi">50</span>            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">ch_ptr</span><span class="p">);</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">n</span>
</span><span class='line'><span class="mi">53</span>        <span class="n">lk_ptr</span> <span class="o">=</span> <span class="n">leak3</span><span class="p">();</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">n</span>
</span><span class='line'><span class="mi">54</span>        <span class="k">if</span><span class="p">(</span><span class="n">lk_ptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">monitor</span> <span class="n">leak_check</span> <span class="n">full</span> <span class="n">reachable</span> <span class="n">any</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span> <span class="mi">8</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span> <span class="n">are</span> <span class="n">still</span> <span class="n">reachable</span> <span class="n">in</span> <span class="n">loss</span> <span class="n">record</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">5</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">at</span> <span class="mh">0x4C2AB80</span><span class="o">:</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">valgrind</span><span class="o">/</span><span class="n">vgpreload_memcheck</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">linux</span><span class="p">.</span><span class="n">so</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x4006C3</span><span class="o">:</span> <span class="n">leak3</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">33</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x400732</span><span class="o">:</span> <span class="n">main</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">53</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span> <span class="mi">14</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span> <span class="n">are</span> <span class="n">still</span> <span class="n">reachable</span> <span class="n">in</span> <span class="n">loss</span> <span class="n">record</span> <span class="mi">3</span> <span class="n">of</span> <span class="mi">5</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">at</span> <span class="mh">0x4C2AB80</span><span class="o">:</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">valgrind</span><span class="o">/</span><span class="n">vgpreload_memcheck</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">linux</span><span class="p">.</span><span class="n">so</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x4EC02B9</span><span class="o">:</span> <span class="n">strdup</span> <span class="p">(</span><span class="n">strdup</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">42</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x400687</span><span class="o">:</span> <span class="n">leak2</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">20</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x40070C</span><span class="o">:</span> <span class="n">main</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">48</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span> <span class="mi">14</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span> <span class="n">are</span> <span class="n">still</span> <span class="n">reachable</span> <span class="n">in</span> <span class="n">loss</span> <span class="n">record</span> <span class="mi">4</span> <span class="n">of</span> <span class="mi">5</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">at</span> <span class="mh">0x4C2AB80</span><span class="o">:</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">valgrind</span><span class="o">/</span><span class="n">vgpreload_memcheck</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">linux</span><span class="p">.</span><span class="n">so</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x4EC02B9</span><span class="o">:</span> <span class="n">strdup</span> <span class="p">(</span><span class="n">strdup</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">42</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x4006E2</span><span class="o">:</span> <span class="n">leak3</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">37</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x400732</span><span class="o">:</span> <span class="n">main</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">53</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span> <span class="mi">100</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span> <span class="n">are</span> <span class="n">definitely</span> <span class="n">lost</span> <span class="n">in</span> <span class="n">loss</span> <span class="n">record</span> <span class="mi">5</span> <span class="n">of</span> <span class="mi">5</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">at</span> <span class="mh">0x4C2AB80</span><span class="o">:</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">in</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">valgrind</span><span class="o">/</span><span class="n">vgpreload_memcheck</span><span class="o">-</span><span class="n">amd64</span><span class="o">-</span><span class="n">linux</span><span class="p">.</span><span class="n">so</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x40065E</span><span class="o">:</span> <span class="n">leak1</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">11</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">by</span> <span class="mh">0x400707</span><span class="o">:</span> <span class="n">main</span> <span class="p">(</span><span class="n">leak</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">47</span><span class="p">)</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span> <span class="n">LEAK</span> <span class="nl">SUMMARY</span><span class="p">:</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">definitely</span> <span class="nl">lost</span><span class="p">:</span> <span class="mi">100</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">1</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">indirectly</span> <span class="nl">lost</span><span class="p">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>      <span class="n">possibly</span> <span class="nl">lost</span><span class="p">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>    <span class="n">still</span> <span class="nl">reachable</span><span class="p">:</span> <span class="mi">36</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">3</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>         <span class="nl">suppressed</span><span class="p">:</span> <span class="mi">0</span> <span class="n">bytes</span> <span class="n">in</span> <span class="mi">0</span> <span class="n">blocks</span>
</span><span class='line'><span class="o">==</span><span class="mi">28450</span><span class="o">==</span>
</span></code></pre></td></tr></table></div></figure>


<h2>參考資料</h2>

<ul>
<li><a href="http://billiob.net/blog/20140330_vgdb.html">gdb + valgrind - (billiob&rsquo;s blog)</a></li>
<li><code>man valgrind</code></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/29/catching-leakage-use-valgrind-checking-c-memory-leak/">抓漏 - 使用valgrind檢查C語言memory Leak</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-29T07:51:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:51 am</span></time>
        
           | <a href="/blog/2014/11/29/catching-leakage-use-valgrind-checking-c-memory-leak/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/11/29/catching-leakage-use-valgrind-checking-c-memory-leak/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>使用C 語言，memory leak的問題是最棘手的狀況之一，茫茫code海要一個一個比對簡直是大海撈針。幸好Linux下面有好的的工具可以救你一命。簡單介紹一下希望對大家有幫助。</p>

<h2>目錄</h2>

<ul>
<li><a href="#env">測試環境</a></li>
<li><a href="#ex-prg">測試程式</a></li>
<li><a href="#ex-run">執行方式</a></li>
<li><a href="#ex-res">執行結果</a></li>
<li><a href="#ref">參考資料</a></li>
</ul>


<p><a name="env"></a></p>

<h2>測試環境</h2>

<ul>
<li>valgrind 在Ubuntu下面可以直接用<code>sudo apt-get install valgrind</code>安裝。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.1 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty
</span><span class='line'>
</span><span class='line'>$ valgrind --version
</span><span class='line'>valgrind-3.10.0.SVN
</span></code></pre></td></tr></table></div></figure>


<p><a name="ex-prg"></a></p>

<h2>測試程式</h2>

<p>這邊準備了幾個典型的memory leak程式，應該是很簡單看出哪邊有leak，所以我就不多做說明了。</p>

<figure class='code'><figcaption><span>leak.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">leak_example</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">leak1</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Oops, malloc fail!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">char</span> <span class="o">*</span><span class="nf">leak2</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">&quot;Hey Hey Hey!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Oops, strdup fail!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">leak_example</span> <span class="o">*</span><span class="nf">leak3</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">leak_example</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">leak_example</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">leak_example</span><span class="p">));</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Oops, malloc fail!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">ptr</span><span class="o">-&gt;</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">&quot;Hey Hey Hey!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">leak_example</span> <span class="o">*</span><span class="n">lk_ptr</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">char</span> <span class="o">*</span> <span class="n">ch_ptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">leak1</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ch_ptr</span> <span class="o">=</span> <span class="n">leak2</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">ch_ptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">ch_ptr</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">lk_ptr</span> <span class="o">=</span> <span class="n">leak3</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">lk_ptr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">lk_ptr</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">);</span>
</span><span class='line'>        <span class="n">free</span><span class="p">(</span><span class="n">lk_ptr</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>因為只是單一檔案，我懶得寫Makefile，編譯指令如下:</p>

<figure class='code'><figcaption><span>leak.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">CFLAGS</span><span class="o">=</span><span class="s">&quot;-g&quot;</span> <span class="n">make</span> <span class="n">leak</span>
</span></code></pre></td></tr></table></div></figure>


<p>這行指令可以去找Makefile中<code>Implicit Rules</code>得到解答。</p>

<p><a name="ex-run"></a></p>

<h2>執行方式</h2>

<p>最簡單的方式就是用下面的方式</p>

<figure class='code'><figcaption><span>leak.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">valgrind</span> <span class="err">你的執行檔</span>
</span></code></pre></td></tr></table></div></figure>


<p>然而這樣只會顯示出有漏掉多少的空間，因此要詳細地列出memory leak細節我會使用:</p>

<figure class='code'><figcaption><span>leak.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">valgrind</span> <span class="o">--</span><span class="n">leak</span><span class="o">-</span><span class="n">check</span><span class="o">=</span><span class="n">full</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">leak</span><span class="o">-</span><span class="n">kinds</span><span class="o">=</span><span class="n">all</span> <span class="o">--</span><span class="n">verbose</span> <span class="err">你的程式檔</span>
</span></code></pre></td></tr></table></div></figure>


<p>這些選項應該是可以望文生義，所以就不解釋了。想知道細節可以問男人<code>man valgrind</code></p>

<p><a name="ex-res"></a></p>

<h2>執行結果</h2>

<ul>
<li>節錄重點，我們可以看到valgrind不但找出洩漏多少空間，也明確地列出未釋放的記憶體被分配時的callstack，真是佛心來者。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ valgrind --leak-check=full --show-leak-kinds=all --verbose
</span><span class='line'>...
</span><span class='line'>==26518== HEAP SUMMARY:
</span><span class='line'>==26518==     in use at exit: 128 bytes in 3 blocks
</span><span class='line'>==26518==   total heap usage: 4 allocs, 1 frees, 136 bytes allocated
</span><span class='line'>==26518==
</span><span class='line'>==26518== Searching for pointers to 3 not-freed blocks
</span><span class='line'>==26518== Checked 78,136 bytes
</span><span class='line'>==26518==
</span><span class='line'>==26518== 14 bytes in 1 blocks are definitely lost in loss record 1 of 3
</span><span class='line'>==26518==    at 0x4C2AB80: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
</span><span class='line'>==26518==    by 0x4EC02B9: strdup (strdup.c:42)
</span><span class='line'>==26518==    by 0x400687: leak2 (leak.c:20)
</span><span class='line'>==26518==    by 0x40070C: main (leak.c:48)
</span><span class='line'>==26518==
</span><span class='line'>==26518== 14 bytes in 1 blocks are definitely lost in loss record 2 of 3
</span><span class='line'>==26518==    at 0x4C2AB80: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
</span><span class='line'>==26518==    by 0x4EC02B9: strdup (strdup.c:42)
</span><span class='line'>==26518==    by 0x4006E2: leak3 (leak.c:37)
</span><span class='line'>==26518==    by 0x400732: main (leak.c:53)
</span><span class='line'>==26518==
</span><span class='line'>==26518== 100 bytes in 1 blocks are definitely lost in loss record 3 of 3
</span><span class='line'>==26518==    at 0x4C2AB80: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
</span><span class='line'>==26518==    by 0x40065E: leak1 (leak.c:11)
</span><span class='line'>==26518==    by 0x400707: main (leak.c:47)
</span><span class='line'>==26518==
</span><span class='line'>==26518== LEAK SUMMARY:
</span><span class='line'>==26518==    definitely lost: 128 bytes in 3 blocks
</span><span class='line'>==26518==    indirectly lost: 0 bytes in 0 blocks
</span><span class='line'>==26518==      possibly lost: 0 bytes in 0 blocks
</span><span class='line'>==26518==    still reachable: 0 bytes in 0 blocks
</span><span class='line'>==26518==         suppressed: 0 bytes in 0 blocks
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>詳細結果</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ CFLAGS= -g make leak
</span><span class='line'>cc  -g    leak.c   -o leak
</span><span class='line'>
</span><span class='line'>$ valgrind --leak-check=full --show-leak-kinds=all --verbose ./leak
</span><span class='line'>==26518== Memcheck, a memory error detector
</span><span class='line'>==26518== Copyright (C) 2002-2013, and GNU GPL&#39;d, by Julian Seward et al.
</span><span class='line'>==26518== Using Valgrind-3.10.0.SVN and LibVEX; rerun with -h for copyright info
</span><span class='line'>==26518== Command: ./leak
</span><span class='line'>==26518==
</span><span class='line'>--26518-- Valgrind options:
</span><span class='line'>--26518--    --leak-check=full
</span><span class='line'>--26518--    --show-leak-kinds=all
</span><span class='line'>--26518--    --verbose
</span><span class='line'>--26518-- Contents of /proc/version:
</span><span class='line'>--26518--   Linux version 3.13.0-40-generic (buildd@comet) (gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) ) #69-Ubuntu SMP Thu Nov 13 17:53:56 UTC 2014
</span><span class='line'>--26518-- Arch and hwcaps: AMD64, amd64-cx16-rdtscp-sse3-avx
</span><span class='line'>--26518-- Page sizes: currently 4096, max supported 4096
</span><span class='line'>--26518-- Valgrind library directory: /usr/lib/valgrind
</span><span class='line'>--26518-- Reading syms from /home/wen/work/practice/Linux_Programming_Practice/15_leak/leak
</span><span class='line'>--26518-- Reading syms from /lib/x86_64-linux-gnu/ld-2.19.so
</span><span class='line'>--26518--   Considering /lib/x86_64-linux-gnu/ld-2.19.so ..
</span><span class='line'>--26518--   .. CRC mismatch (computed 4cbae35e wanted 8d683c31)
</span><span class='line'>--26518--   Considering /usr/lib/debug/lib/x86_64-linux-gnu/ld-2.19.so ..
</span><span class='line'>--26518--   .. CRC is valid
</span><span class='line'>--26518-- Reading syms from /usr/lib/valgrind/memcheck-amd64-linux
</span><span class='line'>--26518--   Considering /usr/lib/valgrind/memcheck-amd64-linux ..
</span><span class='line'>--26518--   .. CRC mismatch (computed 37cdde19 wanted adc367dd)
</span><span class='line'>--26518--    object doesn&#39;t have a symbol table
</span><span class='line'>--26518--    object doesn&#39;t have a dynamic symbol table
</span><span class='line'>--26518-- Scheduler: using generic scheduler lock implementation.
</span><span class='line'>--26518-- Reading suppressions file: /usr/lib/valgrind/default.supp
</span><span class='line'>==26518== embedded gdbserver: reading from /tmp/vgdb-pipe-from-vgdb-to-26518-by-wen-on-???
</span><span class='line'>==26518== embedded gdbserver: writing to   /tmp/vgdb-pipe-to-vgdb-from-26518-by-wen-on-???
</span><span class='line'>==26518== embedded gdbserver: shared mem   /tmp/vgdb-pipe-shared-mem-vgdb-26518-by-wen-on-???
</span><span class='line'>==26518==
</span><span class='line'>==26518== TO CONTROL THIS PROCESS USING vgdb (which you probably
</span><span class='line'>==26518== don&#39;t want to do, unless you know exactly what you&#39;re doing,
</span><span class='line'>==26518== or are doing some strange experiment):
</span><span class='line'>==26518==   /usr/lib/valgrind/../../bin/vgdb --pid=26518 ...command...
</span><span class='line'>==26518==
</span><span class='line'>==26518== TO DEBUG THIS PROCESS USING GDB: start GDB like this
</span><span class='line'>==26518==   /path/to/gdb ./leak
</span><span class='line'>==26518== and then give GDB the following command
</span><span class='line'>==26518==   target remote | /usr/lib/valgrind/../../bin/vgdb --pid=26518
</span><span class='line'>==26518== --pid is optional if only one valgrind process is running
</span><span class='line'>==26518==
</span><span class='line'>--26518-- REDIR: 0x4019ca0 (strlen) redirected to 0x38068331 (???)
</span><span class='line'>--26518-- Reading syms from /usr/lib/valgrind/vgpreload_core-amd64-linux.so
</span><span class='line'>--26518--   Considering /usr/lib/valgrind/vgpreload_core-amd64-linux.so ..
</span><span class='line'>--26518--   .. CRC mismatch (computed 329d6860 wanted c0186920)
</span><span class='line'>--26518--    object doesn&#39;t have a symbol table
</span><span class='line'>--26518-- Reading syms from /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so
</span><span class='line'>--26518--   Considering /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so ..
</span><span class='line'>--26518--   .. CRC mismatch (computed 1fb85af8 wanted 2e9e3c16)
</span><span class='line'>--26518--    object doesn&#39;t have a symbol table
</span><span class='line'>==26518== WARNING: new redirection conflicts with existing -- ignoring it
</span><span class='line'>--26518--     old: 0x04019ca0 (strlen              ) R-&gt; (0000.0) 0x38068331 ???
</span><span class='line'>--26518--     new: 0x04019ca0 (strlen              ) R-&gt; (2007.0) 0x04c2e1a0 strlen
</span><span class='line'>--26518-- REDIR: 0x4019a50 (index) redirected to 0x4c2dd50 (index)
</span><span class='line'>--26518-- REDIR: 0x4019c70 (strcmp) redirected to 0x4c2f2f0 (strcmp)
</span><span class='line'>--26518-- REDIR: 0x401a9c0 (mempcpy) redirected to 0x4c31da0 (mempcpy)
</span><span class='line'>--26518-- Reading syms from /lib/x86_64-linux-gnu/libc-2.19.so
</span><span class='line'>--26518--   Considering /lib/x86_64-linux-gnu/libc-2.19.so ..
</span><span class='line'>--26518--   .. CRC mismatch (computed e7228afa wanted 93ff6981)
</span><span class='line'>--26518--   Considering /usr/lib/debug/lib/x86_64-linux-gnu/libc-2.19.so ..
</span><span class='line'>--26518--   .. CRC is valid
</span><span class='line'>--26518-- REDIR: 0x4ec47e0 (strcasecmp) redirected to 0x4a25720 (_vgnU_ifunc_wrapper)
</span><span class='line'>--26518-- REDIR: 0x4ec6ad0 (strncasecmp) redirected to 0x4a25720 (_vgnU_ifunc_wrapper)
</span><span class='line'>--26518-- REDIR: 0x4ec3fb0 (memcpy@GLIBC_2.2.5) redirected to 0x4a25720 (_vgnU_ifunc_wrapper)
</span><span class='line'>--26518-- REDIR: 0x4ec2240 (rindex) redirected to 0x4c2da30 (rindex)
</span><span class='line'>--26518-- REDIR: 0x4eba1d0 (malloc) redirected to 0x4c2ab10 (malloc)
</span><span class='line'>--26518-- REDIR: 0x4ec0540 (strlen) redirected to 0x4c2e0e0 (strlen)
</span><span class='line'>--26518-- REDIR: 0x4ec9200 (__GI_memcpy) redirected to 0x4c2fc90 (__GI_memcpy)
</span><span class='line'>--26518-- REDIR: 0x4ecb540 (strchrnul) redirected to 0x4c319b0 (strchrnul)
</span><span class='line'>Hey Hey Hey!
</span><span class='line'>Hey Hey Hey!
</span><span class='line'>--26518-- REDIR: 0x4eba870 (free) redirected to 0x4c2bd80 (free)
</span><span class='line'>==26518==
</span><span class='line'>==26518== HEAP SUMMARY:
</span><span class='line'>==26518==     in use at exit: 128 bytes in 3 blocks
</span><span class='line'>==26518==   total heap usage: 4 allocs, 1 frees, 136 bytes allocated
</span><span class='line'>==26518==
</span><span class='line'>==26518== Searching for pointers to 3 not-freed blocks
</span><span class='line'>==26518== Checked 78,136 bytes
</span><span class='line'>==26518==
</span><span class='line'>==26518== 14 bytes in 1 blocks are definitely lost in loss record 1 of 3
</span><span class='line'>==26518==    at 0x4C2AB80: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
</span><span class='line'>==26518==    by 0x4EC02B9: strdup (strdup.c:42)
</span><span class='line'>==26518==    by 0x400687: leak2 (leak.c:20)
</span><span class='line'>==26518==    by 0x40070C: main (leak.c:48)
</span><span class='line'>==26518==
</span><span class='line'>==26518== 14 bytes in 1 blocks are definitely lost in loss record 2 of 3
</span><span class='line'>==26518==    at 0x4C2AB80: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
</span><span class='line'>==26518==    by 0x4EC02B9: strdup (strdup.c:42)
</span><span class='line'>==26518==    by 0x4006E2: leak3 (leak.c:37)
</span><span class='line'>==26518==    by 0x400732: main (leak.c:53)
</span><span class='line'>==26518==
</span><span class='line'>==26518== 100 bytes in 1 blocks are definitely lost in loss record 3 of 3
</span><span class='line'>==26518==    at 0x4C2AB80: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
</span><span class='line'>==26518==    by 0x40065E: leak1 (leak.c:11)
</span><span class='line'>==26518==    by 0x400707: main (leak.c:47)
</span><span class='line'>==26518==
</span><span class='line'>==26518== LEAK SUMMARY:
</span><span class='line'>==26518==    definitely lost: 128 bytes in 3 blocks
</span><span class='line'>==26518==    indirectly lost: 0 bytes in 0 blocks
</span><span class='line'>==26518==      possibly lost: 0 bytes in 0 blocks
</span><span class='line'>==26518==    still reachable: 0 bytes in 0 blocks
</span><span class='line'>==26518==         suppressed: 0 bytes in 0 blocks
</span><span class='line'>==26518==
</span><span class='line'>==26518== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 0 from 0)
</span><span class='line'>==26518== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 0 from 0)
</span></code></pre></td></tr></table></div></figure>


<p><a name="ref"></a></p>

<h2>參考資料</h2>

<ul>
<li><code>$ man valgrind</code></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/24/the-skin-slides-to-trace-code-on-line/">Trace 程式碼之皮投影片上線</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-24T17:00:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:00 pm</span></time>
        
           | <a href="/blog/2014/11/24/the-skin-slides-to-trace-code-on-line/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/11/24/the-skin-slides-to-trace-code-on-line/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>非常簡單的介紹vim trace code時可以用到的功能</p>

<iframe src="//www.slideshare.net/slideshow/embed_code/41960022" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/zzz00072/trace-41960022" title="Trace 程式碼之皮" target="_blank">Trace 程式碼之皮</a> </strong> from <strong><a href="//www.slideshare.net/zzz00072" target="_blank">Wen Liao</a></strong> </div></p>

<script async class="speakerdeck-embed" data-id="9ce02020562801328ec912126f62240e" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/20/package-debian-packages-using-local-debian-pbuilder-package/">[Debian套件打包] Pbuilder 中如何安裝自己打包的套件</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-20T16:20:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:20 pm</span></time>
        
           | <a href="/blog/2014/11/20/package-debian-packages-using-local-debian-pbuilder-package/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/11/20/package-debian-packages-using-local-debian-pbuilder-package/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>標題有點難下。直接講為什麼會有這樣的需求好了，<a href="http://wen00072.github.io/blog/2014/07/31/package-debian-packages-discussion-on-pbuilder">在這邊</a>介紹了使用pbuilder驗證單獨的套件。但是如果你要打包的套件需要先安裝另外一個自行先打包的套件就GG了。原因是因為pbuilder不知道去那邊找相依的套件以致於無法編譯你的套件。</p>

<p>舉例來說，假設你現在要打包一個套件是顯示圖片的程式，我們把他叫<code>pkg_image</code>。而這個<code>pkg_image</code>套件使用了<code>lib_img</code>這套函式庫開發。不巧的是<code>lib_img</code>並不在debian官方套件中，所以你必須要先打包<code>lib_img</code>、<code>lib_img-dev</code>和<code>lib_dbg</code>這三個套件。接下來你要確定<code>lib_img-dev</code>套件安裝到你的系統中，你才能夠開始打包<code>pkg_img</code>。</p>

<p>這樣的狀況在pbuilder會有前面講到的套件相依問題。後來在Debian文件的<a href="https://wiki.debian.org/PbuilderTricks">PbuilderTricks</a>中找到解法，整理如下。</p>

<ul>
<li><a href="#prepare">複習 &amp; 事先準備</a></li>
<li><a href="#conf">修改pbuilder config檔案</a></li>
<li><a href="#test">套用並測試</a></li>
<li><a href="#ref">參考資料</a></li>
</ul>


<p><a name="prepare"></a></p>

<h2>複習 ＆ 事先準備</h2>

<p>首先我們依照Ubuntu的文件<a href="https://wiki.ubuntu.com/PbuilderHowto">PbuilderHowto</a>中的建議，安裝下面的套件。這部份應該和前面有重複。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install pbuilder debootstrap devscripts</span></code></pre></td></tr></table></div></figure>


<p>其中devscripts提供打包debian套件所需要的script，如前面提到的debuild。而debootstrap則是可以讓你在系統中安裝並執行另外一個debian Linux。在使用時可以指定要裝debian的版本，至於debootstrap支援那些版本？你可以用下面的方式查詢： <code>ls /usr/share/debootstrap/scripts</code></p>

<p>如果你準備打包並上傳到debian官方套件管理庫，那麼你還要安裝debian 的GPG key，指令如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install debian-archive-keyring</span></code></pre></td></tr></table></div></figure>


<p>接下來我們要建立一個待測Debian的基本image。我使用</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo pbuilder create --distribution sid \
</span><span class='line'>                     --mirror http://ftp.tw.debian.org/debian \
</span><span class='line'>                     --debootstrapopts \ 
</span><span class='line'>                     "--keyring=/usr/share/keyrings/debian-archive-keyring.gpg --variant=buildd"</span></code></pre></td></tr></table></div></figure>


<p>這個指令表示</p>

<ul>
<li>我要針對下建立基於debian sid的base.tgz檔案: <code>--distribution sid</code></li>
<li>指定mirror site: <code>--mirror http://ftp.tw.debian.org/debian</code></li>
<li>傳遞下面的參數給debootstrap: <code>--debootstrapopts</code>

<ul>
<li>使用debian archive的gpg key 來驗證下載的套件<code>--keyring=/usr/share/keyrings/debian-archive-keyring.gpg</code></li>
<li>除了基本的套件外，請幫我額外安裝編譯軟體需要的相關套件 (&ndash;variant=buildd)</li>
</ul>
</li>
</ul>


<p><a name="conf"></a></p>

<h2>修改pbuilder config檔案</h2>

<p>建立了base.tgz後。還要更改pbuilder的設定以及加入hook。請編輯/etc/pbuilderrc，或是你執行的pbuilder身份home目錄下的~/.pbuilderrc。主要是描述你的local repository放在那邊，以及hook放在那邊。local repository就是你自己打包的套件要放的地方，以前面的例子，就是要放lib_imag.deb和lib_imag-dev.deb到該目錄。而hook可以比喻成/etc/rc.d內的東西，基本上就是在該目錄寫一些script，當pbuilder啟動後就會依順序呼叫。</p>

<figure class='code'><figcaption><span>/etc/pbuilder.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>OTHERMIRROR=&quot;deb [trusted=yes] file:///path/to/the/dir/deps ./&quot;
</span><span class='line'>BINDMOUNTS=&quot;/path/to/the/dir/deps&quot;
</span><span class='line'>HOOKDIR=&quot;/path/to/hook/dir&quot;
</span><span class='line'>EXTRAPACKAGES=&quot;apt-utils&quot;
</span></code></pre></td></tr></table></div></figure>


<p>請確認內容中的每個路徑都存在，還有[trusted=yes]有被加入。沒加這個在pbuilder安裝自己local套件會因為安全條件不滿足而無法安裝。</p>

<p>寫完設定檔後，記得要告訴pbuilder你已經更新了設定。指令如下</p>

<figure class='code'><figcaption><span>/etc/pbuilder.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>sudo pbuilder --update --override-config --distribution sid
</span></code></pre></td></tr></table></div></figure>


<p>接下來就是在HOOKDIR指定的目錄中填寫hook的內容，debian trick網頁是使用<code>D05deps</code>，我也是照抄。</p>

<figure class='code'><figcaption><span>D05deps</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>#!/bin/sh
</span><span class='line'>(cd /path/to/the/dir/deps; apt-ftparchive packages . &gt; Packages)
</span><span class='line'>apt-get update
</span></code></pre></td></tr></table></div></figure>


<p>這個hook就是切換到你存放自己打包deb套件的目錄，然後產生出apt看得懂的套件列表到Packages檔案，最後就是更新apt。所以每次該目錄有新的deb套件時，都可以確保pbuilder一定可以使用。</p>

<p><a name="test"></a></p>

<h2>套用並測試</h2>

<p>完全和前面一樣，pbuilder &ndash;build 一個dsc檔。以前面的例子，我們會依照下面的順序打包</p>

<ul>
<li><code>pbuilder --build lib_img.dsc</code>打包<code>lib_img</code>，<code>lib_img-dev</code>，<code>lib_img-dbg</code>這三個套件。</li>
<li>把<code>lib_img</code>，<code>lib_img-dev</code>，<code>lib_img-dbg</code>搬到你給pbuilder吃的local repository目錄</li>
<li><code>pbuilder --build pkg_image.dsc</code>，pbuilder會自動從local repository中找出並安裝相依套件。</li>
</ul>


<p><a name="ref"></a></p>

<h2>參考資料</h2>

<ul>
<li><a href="https://wiki.debian.org/PbuilderTricks">PbuilderTricks</a></li>
<li><a href="https://wiki.ubuntu.com/PbuilderHowto">(Ubuntu) PbuilderHowto</a>

<ul>
<li>後面的提到dput之後我就沒往下看了，感覺似乎和Debian的稍微不同？</li>
</ul>
</li>
<li><a href="http://pbuilder.alioth.debian.org/">pbuilder User&rsquo;s Manual</a></li>
<li><a href="https://wiki.debian.org/Debootstrap">Debian: Bootstrap</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/09/automatically-turn-off-touchpad/">[Linux] 自動關閉TouchPad</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-09T09:27:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:27 am</span></time>
        
           | <a href="/blog/2014/11/09/automatically-turn-off-touchpad/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/11/09/automatically-turn-off-touchpad/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>2015年3月29日更新</strong>
直接打開dconf-editor，選擇 &ldquo;org&rdquo;->&ldquo;gnome&rdquo;->&ldquo;settings-daemon&rdquo;->&ldquo;peripherals&rdquo;->&ldquo;touchpad&#8221;，把裏面的
&#8220;touchpad-enabled&#8221;選項disable掉就可以了。</p>

<h2>參考資料</h2>

<ul>
<li><a href="http://xmodulo.com/how-to-disable-touchpad-on-debian-ubuntu-desktop.html">How to disable touchpad on Debian or Ubuntu Desktop</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/17/long-term-travel-experiences-to-share/">單人本地長期旅遊心得分享</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-17T16:37:00+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:37 pm</span></time>
        
           | <a href="/blog/2014/10/17/long-term-travel-experiences-to-share/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/10/17/long-term-travel-experiences-to-share/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>分類</h2>

<ul>
<li><a href="#trav-live">住宿</a></li>
<li><a href="#trav-lag">行李</a></li>
<li><a href="#trav-out">外出</a></li>
<li><a href="#trav-oth">其他</a></li>
</ul>


<p><a name="trav-live"></a></p>

<h2>住宿</h2>

<ul>
<li>換洗衣物以快乾為考量。</li>
<li>節省旅費可以住青年旅社(背包客棧)，收費約新台幣五百元上下。一般的平價旅社價位約一千上下，所以兩人出遊選擇青年旅社不一定比較省錢。

<ul>
<li>青年旅社不一定提供盥洗用品，請自備牙刷牙膏毛巾。</li>
</ul>
</li>
<li>如果找到旅館不是整棟的，很有機會可以使用免費的烘衣設備。

<ul>
<li>推測是整棟通常有自備曬衣場，但是只有幾層的就有沒有足夠的空間晾衣服。</li>
</ul>
</li>
</ul>


<p><a name="trav-lag"></a></p>

<h2>行李</h2>

<ul>
<li>自備牙刷牙膏的話，牙膏可以使用兒童牙膏節省空間。</li>
<li>建議自備延長線，以防止插座不夠和插座離床位太遠。</li>
<li>電器類物品放入厚的布質購物袋後再放厚的塑膠袋，一方面防止插頭刺破袋子、一方面也防水。</li>
<li>確認沒有需要參加極度正式的場合的話，穿有護趾的運動涼鞋可以省去襪子，並且下水也比較方便。</li>
<li>建議攜帶藥品：綠油精、止痛藥、止瀉藥、面速力達姆（胯下摩擦紅腫疼痛用）。</li>
<li>可以攜帶附剪刀的原廠瑞士刀，這東西處理指甲和鼻毛很好用。</li>
<li>連續下整天又要騎車的時候，什麼樣的雨具效果都有限。多準備幾個塑膠袋，當遇到長時間下雨時，就把貴重物品，皮夾，手機等東西放入塑膠袋內防水。</li>
</ul>


<p><a name="trav-out"></a></p>

<h2>外出</h2>

<ul>
<li>防曬一定要做，有寒流來被曬傷的經驗。</li>
<li>隨身攜帶水壺。</li>
<li>可以攜帶環保餐具減少垃圾。</li>
<li>機車旅行的話油料必須考量，不是所有地方都有加油站的。</li>
</ul>


<p><a name="trav-oth"></a></p>

<h2>其他</h2>

<ul>
<li>好奇心、同理心、不要打擾人。</li>
<li>建議參觀當地市場看看本地人的生活型態以及食物。</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/22/talk-about-debian-packages-package-slides-on-line/">淺談Debian套件打包 投影片上線</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-22T11:21:00+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>11:21 am</span></time>
        
           | <a href="/blog/2014/09/22/talk-about-debian-packages-package-slides-on-line/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/09/22/talk-about-debian-packages-package-slides-on-line/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe src="//www.slideshare.net/slideshow/embed_code/39338832" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/zzz00072/debian-39338832" title="淺談Debian套件打包" target="_blank">淺談Debian套件打包</a> </strong> from <strong><a href="http://www.slideshare.net/zzz00072" target="_blank">Wen Liao</a></strong> </div></p>

<script async class="speakerdeck-embed" data-id="7608980023ab01328db012917f3c7eff" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/31/package-debian-packages-discussion-on-pbuilder/">[Debian套件打包] 使用pbuilder驗證套件</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-31T03:57:00+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>3:57 am</span></time>
        
           | <a href="/blog/2014/07/31/package-debian-packages-discussion-on-pbuilder/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/07/31/package-debian-packages-discussion-on-pbuilder/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>之前的<a href="http://wen00072.github.io/blog/2014/06/12/package-debian-packages-set-after-list-of-debian-packages">文章</a>有提到使用pbuilder驗證套件。最近抽空玩了一下。整理到這邊。</p>

<p>[回收以前文章]
pbuilder透過pbuilder套件中的image以及chroot，使用乾淨的環境來產生並測是套件。如此一來可以確認是否debian目錄下面的設定是否真的可以在這些乾淨的環境被編譯和安裝。</p>

<h2>目錄：</h2>

<ul>
<li><a href="#env">環境設定並建立image</a></li>
<li><a href="#pkg">使用pbuilder打包source package</a></li>
<li><a href="#ref">參考資料</a></li>
</ul>


<hr />

<p><a name="env"></a></p>

<h2>環境設定並建立image</h2>

<ul>
<li>測試環境</li>
</ul>


<figure class='code'><figcaption><span>lsb_release -a畫面</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Debian
</span><span class='line'>Description:  Debian GNU/Linux unstable (sid)
</span><span class='line'>Release:  unstable
</span><span class='line'>Codename: sid
</span></code></pre></td></tr></table></div></figure>


<p>先使用下面指令產生乾淨的Linux環境所對應的tarball，之後會用chroot切換到該環境中。</p>

<ul>
<li><code>sudo pbuilder create</code></li>
</ul>


<figure class='code'><figcaption><span>執行畫面</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo pbuilder create
</span><span class='line'>W: /root/.pbuilderrc does not exist
</span><span class='line'>I: Distribution is sid.
</span><span class='line'>I: Current time: Thu Jul 31 12:44:44 CST 2014
</span><span class='line'>I: pbuilder-time-stamp: 1406781884
</span><span class='line'>I: Building the build environment
</span><span class='line'>I: running debootstrap
</span><span class='line'>...
</span><span class='line'>I: new cache content grep_2.18-2_amd64.deb added
</span><span class='line'>I: unmounting dev/pts filesystem
</span><span class='line'>I: unmounting run/shm filesystem
</span><span class='line'>I: unmounting proc filesystem
</span><span class='line'>I: creating base tarball [/var/cache/pbuilder/base.tgz]
</span><span class='line'>I: cleaning the build env
</span><span class='line'>I: removing directory /var/cache/pbuilder/build//27394 and its subdirectories
</span></code></pre></td></tr></table></div></figure>


<p>從log中可以看到處理的時候會暫時放在<code>/var/cache/pbuilder/build//27394</code>中，當執行結束的時候會刪除。</p>

<p>我們可以更進一步看一下<code>/var/cache/pbuilder</code>目錄：</p>

<figure class='code'><figcaption><span>/var/cache/pbuilder</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>#  tree -d /var/cache/pbuilder
</span><span class='line'>.
</span><span class='line'>|-- aptcache
</span><span class='line'>|-- build
</span><span class='line'>|-- ccache
</span><span class='line'>|-- pbuildd
</span><span class='line'>|-- pbuilder-mnt
</span><span class='line'>|-- pbuilder-umlresult
</span><span class='line'>`-- result
</span></code></pre></td></tr></table></div></figure>


<p>aptcache目錄可以看到裡面就是一堆deb檔案。我們可以合理的推論當測試十有需要額外安裝相依套件下載後會先存放在這邊。</p>

<p>接下來我們可以使用下面的方式玩一下</p>

<ul>
<li><code>sudo pbuilder --login</code></li>
</ul>


<figure class='code'><figcaption><span>sudo pbuilder &#8211;login 執行畫面</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ sudo pbuilder --login
</span><span class='line'>W: /root/.pbuilderrc does not exist
</span><span class='line'>I: Building the build Environment
</span><span class='line'>I: extracting base tarball [/var/cache/pbuilder/base.tgz]
</span><span class='line'>I: creating local configuration
</span><span class='line'>I: copying local configuration
</span><span class='line'>I: mounting /proc filesystem
</span><span class='line'>I: mounting /run/shm filesystem
</span><span class='line'>I: mounting /dev/pts filesystem
</span><span class='line'>I: policy-rc.d already exists
</span><span class='line'>I: Obtaining the cached apt archive contents
</span><span class='line'>I: entering the shell
</span><span class='line'>File extracted to: /var/cache/pbuilder/build//10030
</span><span class='line'>
</span><span class='line'>root@debian:/#
</span></code></pre></td></tr></table></div></figure>


<p>重點是<code>File extracted to: /var/cache/pbuilder/build//10030</code>，所以我們可以在本機中去看<code>/var/cache/pbuilder/build/10030</code>，裡面就是一個完整的Linux root</p>

<figure class='code'><figcaption><span>列出目錄：/var/cache/pbuilder/build/10030</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>##  ls /var/cache/pbuilder/build/10030
</span><span class='line'>bin  boot  dev    etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</span></code></pre></td></tr></table></div></figure>


<p>當我們離開pbuilder shell後，可以看到該root目錄也隨之消失。如此一來，可以確保所有的資料一開始都會是從<code>/var/cache/pbuilder/base.tgz</code>解出來最乾淨的狀態。</p>

<figure class='code'><figcaption><span>離開pbuilder &#8211;login</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>root@debian:/# exit
</span><span class='line'>logout
</span><span class='line'>I: Copying back the cached apt archive contents
</span><span class='line'>I: unmounting dev/pts filesystem
</span><span class='line'>I: unmounting run/shm filesystem
</span><span class='line'>I: unmounting proc filesystem
</span><span class='line'>I: cleaning the build env
</span><span class='line'>I: removing directory /var/cache/pbuilder/build//10030 and its subdirectories
</span></code></pre></td></tr></table></div></figure>


<hr />

<p><a name="pkg"></a></p>

<h2>使用pbuilder打包驗證source package</h2>

<p>我自己的方式是先用<code>debbuild -S</code>或是<code>dpkg-buildpackage -S</code>產生dsc檔案。在同一個目錄下面下下面的指令。</p>

<ul>
<li><code>sudo pbuilder --build 你的套件.dsc</code></li>
</ul>


<p>當你原始套件debian/control的depend沒寫好，pbuilder乾淨的環境就不會安裝depend的套件而執行失敗。這時候你就要加入缺少的depend套件到debian/control。最後產生的套件會放在<code>/var/cache/pbuilder/result/</code>中</p>

<p>執行畫面如下：</p>

<figure class='code'><figcaption><span>sudo pbuilder &#8211;build testautotools_0-1.dsc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>W: /root/.pbuilderrc does not exist
</span><span class='line'>I: using fakeroot in build.
</span><span class='line'>I: pbuilder: network access will be disabled during build
</span><span class='line'>I: Current time: Thu Jul 31 15:28:32 CST 2014
</span><span class='line'>I: pbuilder-time-stamp: 1406791712
</span><span class='line'>I: Building the build Environment
</span><span class='line'>...
</span><span class='line'>I: Obtaining the cached apt archive contents
</span><span class='line'>I: Installing the build-deps
</span><span class='line'> -&gt; Attempting to satisfy build-dependencies
</span><span class='line'> -&gt; Creating pbuilder-satisfydepends-dummy package
</span><span class='line'>...
</span><span class='line'>I: Extracting source
</span><span class='line'>dpkg-source: warning: extracting unsigned source package (testautotools_0-1.dsc)
</span><span class='line'>dpkg-source: info: extracting testautotools in testautotools-0
</span><span class='line'>dpkg-source: info: unpacking testautotools_0.orig.tar.xz
</span><span class='line'>dpkg-source: info: unpacking testautotools_0-1.debian.tar.xz
</span><span class='line'>I: Building the package
</span><span class='line'>I: Running cd tmp/buildd/*/ &amp;&amp; env PATH=&quot;/usr/sbin:/usr/bin:/sbin:/bin&quot; dpkg-buildpackage -us -uc  -rfakeroot
</span><span class='line'>...
</span><span class='line'>I: Copying back the cached apt archive contents
</span><span class='line'>I: unmounting dev/pts filesystem
</span><span class='line'>I: unmounting run/shm filesystem
</span><span class='line'>I: unmounting proc filesystem
</span><span class='line'>I: cleaning the build env
</span><span class='line'>I: removing directory /var/cache/pbuilder/build//18912 and its subdirectories
</span><span class='line'>I: Current time: Thu Jul 31 15:29:09 CST 2014
</span><span class='line'>I: pbuilder-time-stamp: 1406791749
</span></code></pre></td></tr></table></div></figure>


<hr />

<p><a name="ref"></a></p>

<h2>參考資料</h2>

<ul>
<li><a href="https://wiki.ubuntu.com/PbuilderHowto">PbuilderHowto </a></li>
<li><a href="https://wiki.debian.org/Diaspora/Packaging/pbuilder">Debian: Pbuilder</a></li>
<li><a href="https://www.debian.org/doc/manuals/maint-guide/build.en.html">Debian New Maintainers&#8217; Guide: Chapter 6. Building the package</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/09/gnu-make-autotools-and-cmake-introduction-slides-on-line/">GNU Make, Autotools, CMake 簡介投影片上線</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-09T17:39:00+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:39 pm</span></time>
        
           | <a href="/blog/2014/07/09/gnu-make-autotools-and-cmake-introduction-slides-on-line/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/07/09/gnu-make-autotools-and-cmake-introduction-slides-on-line/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>Slideshare</li>
</ul>


<iframe src="//www.slideshare.net/slideshow/embed_code/36801801" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px 1px 0; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/zzz00072/gnu-make-autotools-cmake" title="GNU Make, Autotools, CMake 簡介" target="_blank">GNU Make, Autotools, CMake 簡介</a> </strong> from <strong><a href="http://www.slideshare.net/zzz00072" target="_blank">Wen Liao</a></strong> </div></p>

<ul>
<li>Speaker Deck</li>
</ul>


<script async class="speakerdeck-embed" data-id="46ad0fc0e9c001313be5762c67c15dde" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/06/zen-and-the-art-of-motorcycle-maintenance-books-focus-on-finishing/">閱讀心得： Zen and the Art of Motorcycle Maintenance (CH1 ~ CH27)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-06T02:48:00+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:48 am</span></time>
        
           | <a href="/blog/2014/07/06/zen-and-the-art-of-motorcycle-maintenance-books-focus-on-finishing/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2014/07/06/zen-and-the-art-of-motorcycle-maintenance-books-focus-on-finishing/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>書本資訊：<a href="http://flaneur.tw/?p=1865">禪與摩托車維修的藝術 - 行人出版社</a></p>

<hr />

<h2>前言</h2>

<p>對於Zen and the Art of Motorcycle Maintenance這本書的印象是在看軟工書籍時一直提到這本書。最近終於把他看完了。這本小說做了許多哲學思考，書中可以看出作者反對「主客分離」的二元式思考方式，並且建構出自己看待事物的哲學model。書中並且反思了當代社會偏重於理性思考產生的副作用。因為這是自己的心得感想，表示這是個人主觀認定書本的意義，也就是說我看到和想像的，不一定是真正作者想要表達的意念和思想，請讀者自行參考原書，思考一下作者的結論，而不是把這邊的內容當作作者講的話。</p>

<hr />

<h2>Quality:</h2>

<ul>
<li>判斷事物好壞美醜的直覺，無法定義。如果沒有這樣的直覺，噴和美食將沒有什麼差別、比賽只剩數字的加減法而已。

<ul>
<li>Wen: Quality是絕對的還是相對的？要如何證明沒有定義的東西存在？</li>
</ul>
</li>
<li>一般的判斷感受一定是始於感官知覺，接下來判斷決定這些接收的資料為何。作者認為介於接受感官知覺的資訊透過Quality後，產生判斷做出結論。浪漫quailty 是眼前立即感受到的事物，古典quailty是眼前的事物作為過去現在未來時間空間下可預測的model。</li>
<li>做出目前感知的對象對應的判斷決策是基於相似可以類比的經驗。因此面對無可對比經驗的事物時，就很難判斷決定；例如沒接觸華語的人對於捲舌和平上去入發音的感受度就很低。同樣的，一群經驗背景類似的人同時接觸新的事物，那麼他們的判斷決定應該相近而不會差異太多。</li>
<li>所有語言的名詞只是一個分類的概念，沒有和對象產生連結前他們只是抽象概念。所以可以說我們發明出存在、貓、狗、、顏色、重量、以及所有可以使用言語描述的東西和他們對應的屬性。而作者認為Quailty就是針對這些抽象概念類比產生名詞的起源，因此他的世界論是一元論，也就是說所有的東西透過Quailty產生意義，所以真正確認存在的事物為Quailty。</li>
<li>突然出現的靈感，照作者的解釋，就是Quailty的產出。Quailty不只有意識的判斷，也會在無意識下觸發靈感。這是因為Quality讓人決定美醜善惡，因此Quality覺得美的的東西(數學美、規律美等)也可以在無意識中進入人的思想中。

<ul>
<li>Wen: 有點神祕主義的感覺，雖然作者有解釋到這部份，不過我實在沒印象他怎麼解釋。</li>
</ul>
</li>
<li>對現實現象和想法判斷決策是一種評價的行為，也就是說內心有一種標準決定好壞對錯。而我們對事物的是非對錯好壞美醜的判斷，隨者理性分析觀察後隨時變動。</li>
<li>做事情除了知識外，對於衡量工作品質的敏感度也是決定做事成功失敗的決勝關鍵。而這些好壞品質的敏感度和Quaility有直接的關係。</li>
</ul>


<hr />

<h2>古典理性與浪漫模式</h2>

<ul>
<li>感官感覺到的對象的本身和對象意義的是不同的。</li>
<li>浪漫模式講求感官上的美，而古典理性講求規則和限制的條件下的約束美。</li>
<li>古典理性強調Model，也就是將觀察的對象依特定目的切割並分析，希望能夠從中找到這些切割出來的「零件」彼此之間的關係、以及「零件」和觀察對象的關係，進而建立一套標準規格用來預測這類的事物。分析到最後缺點就是<strong>無趣</strong>、沒有好壞觀點、並且人逐漸和<strong>分析對象</strong>的感情分離以及缺乏認同，最終只剩下冷冰冰的數學公式和假設。這就是主客分離必然的現象。</li>
<li>浪漫模式看的是<strong>零件</strong>，而古典理性看到的則是<strong>系統</strong>和<strong>功能</strong>。因此修理物品並不是拆拆裝裝零件，而是從狀況產生<strong>想法</strong>，透過拆解系統、分析驗證<strong>概念</strong>的來解決問題。</li>
<li>主客分離是很奇怪的事，處理事情的情況一定是人和對象（機器，程式等）一同參與，對象的本質決定人要採取的動作，進而改變對象，最終讓對象接近或達到對象應該扮演的本質。</li>
</ul>


<hr />

<h2>系統</h2>

<ul>
<li>系統是個很有趣的概念。從系統的角度，零件的價值就是提供功能，其他的特性一點都不重要。而最大的系統是人的「思考模式」。如果思考模式沒有更動，推翻掉外在的系統，砍掉重練的外在系統可能最後的宿命仍然相同。</li>
<li>人們很容易認為系統是一個硬梆梆的東西，每個元件都有其必要的功能，不可侵犯。然而系統其實是心理投射的對象，而不是單純的零件組合。以機車來說，一般人會認為機車零件就是由金屬、塑膠等依不同功能需求型塑出來的外型。然而形狀，是先有想法概念後製造出來的。也就是說你可以宣稱金屬塑膠是沒有外型的，一切都是人隨心所欲製作出來的。外在的世界只是提供這些概念的材質而已。</li>
</ul>


<hr />

<h2>科學方法</h2>

<ul>
<li>邏輯思考分為歸納法和推論法。前者是觀察現象找出pattern，後者是依據model推測原因。</li>
<li>問題釐清筆記，協助解決問題。需要細心觀察，精確思考。

<ul>
<li>問題描述</li>
<li>使用奧坎剃刀！</li>
<li>問蠢問題是為了防止犯蠢錯誤</li>
<li>猜測的原因，以及猜測原因背後的假設</li>
<li>針對上面的原因，設計測試方式。

<ul>
<li>要小心變因的控制

<ul>
<li>實驗真正失敗是「數據」無法被解釋或分析任何事實？</li>
</ul>
</li>
<li>要注意測試步驟的因果關係，推論是否合邏輯</li>
<li>測試的預期結果</li>
</ul>
</li>
<li>觀察到的測試結果</li>
<li>結論</li>
</ul>
</li>
<li>假設是所有理性思考中最不可思議的因素，往往要訴諸直覺和人肉模擬model後才會蹦出假設。</li>
<li>透過觀察、假設產生的model會愈精確。這暗示不存在絕對的真理，因為隨時有新的現象和假設出現，這造成一個科學model被推翻、補強的iteration次數多到一般人思想和價值觀無所適從，反應在社會上就會出現「無感情」、「沒有美醜善惡等主觀判斷」、「空虛」。</li>
<li>Model建立是基於pattern，也就是共同出現，有規律的特徵。科學界傾向以宏觀或微觀的角度，觀察現象，進而從觀察到的pattern歸納整理成model。建立model後，需要想辦法「擴充」model的適用性。擴充適用性可以經由找出model的limiataion如無法解釋的現象、無法處理哪些特異情況、或是照model演譯後和觀察的現象矛盾的地方下手。</li>
</ul>


<hr />

<h2>說明論述</h2>

<ul>
<li>說明論述文的常見的問題是缺乏藝術聯貫性。另外連續性也是個問題，如果需要反覆翻頁參照才能弄懂那麼就不是好的論述方式了。</li>
<li>維修時要心平氣和，否則個人情緒會影響到處理的對象。如果機器讓你心平氣和，那就是一台好機器；讓你心浮氣躁的就是壞機器。而好壞是取決於於使用者的心，也就是說可以透過行動，改變機器或是使用方式讓人心平氣和，讓壞機器變成好機器。</li>
<li>當寫使用手冊的時候，如果沒有描述整體狀況直接切入步驟。就會發生安裝時要嘛裝完不知道對象為何這樣動作，或是出問題完全不知道如何處理。手冊上的步驟只是官方的建議方法，然而安裝方法也不一定只有這種方式。

<ul>
<li>Wen: 同樣的狀況更可能發生在就算有描述，但是安裝的人沒有也不想去了解而直接跳到安裝的步驟去而有一樣的悲劇。</li>
</ul>
</li>
</ul>


<hr />

<h2>知識論？</h2>

<ul>
<li>所有實質的物質是透過感官感知的，也就是說外在世界我們只能體驗到我們能感知到的部份。另一方面，我們以為的外在世界事實上是從感覺中鉤勒出來的想像世界。</li>
<li>知識是始於經驗。但是知識不一定全部從經驗中得出。</li>
<li>康得的「先驗」：人在感官感知時同時附加的屬性，如時間、因果關係等。透過經驗、感官、和先驗，人在也就是說玩頭腦中產生特定事物的model，用來理解、分析、和預測該事物的發展。</li>
</ul>


<hr />

<h2>教堂啤酒屋比喻</h2>

<p>一個教堂因為教會經濟理由被賣出，內部重新裝潢後改為啤酒屋。有人會因此而反對營業，原因是褻瀆宗教。然而維持宗教神聖性的並非實體的房屋，而是精神層次的東西；特殊外型的房屋不過是這樣精神概念延伸出來的實體物質罷了。這樣的精神概念性質的東西可以稱為「本質」。</p>

<p>了解了本質以後，面對衝突矛盾的時候比較容易看得出衝突的本質。舉例來說，執法單位遇到民意代表以預算邀脅反對執法，負責人如果深刻體會並認同執法本質是維護法律的話，自然會為法律而不是預算或是自己前途服務。</p>

<hr />

<h2>學習和模仿</h2>

<ul>
<li>很多時候遇到問題或是被指定描述特定事物時第一個遇到的問題是不知道從那邊開始。這是因為被學習經驗受限，如果沒有找到記憶中類似的經驗或是可以<strong>模仿</strong>的對象，就卡住了。也就是說缺少自信，不習慣使用自己的角度檢視、看待、認識對象，反而把精力放在別人說過的話上面。簡而言之，就是沒有原創力的表現。</li>
<li>學校學習的型態讓評分者以為學生沒有在模仿，而以為學生學到精髓、用自己方式表達，但是這還是模仿。發揮原創性不理會原則達到目的得到分數的方式變異性會超大，從滿分到不及格都有可能。</li>
<li>主流的學問教學方式是把對象抽出來，學習對象的定義，整理出來的抽象model。而不是先觀察、使用、操作對象，這也是疏離感產生的原因。而解決問題的能力就再這樣的濃縮還原中漸漸消失。另外當代教育的問題是「成績評量」，成績評量的目的是量化以及讓學生評估自己對於特定對象的判別能力，但是這樣的方式有很致命的缺點–奴隸心態。因為主流的教學以成績評量作為懲罰獎賞的機制。而這樣的方式造成對很多學生來說，沒有懲罰獎賞就沒有進度。也就是說需要有人踢你的屁股才會前進。更慘的是，降低了分辨對於該堂知識討論的對象優劣的能力，而這是管理者的主要責任以及學生最該學到的東西。</li>
</ul>


<hr />

<h2>腦筋打結</h2>

<ul>
<li>一次想做太多事腦筋會打結。不要想同時要做什麼又想先做什麼。依順序來，先列出事項，再決定要做事情。</li>
<li>另外一種情況就是處理事情時進度卡住時的狀況。卡住的事情是極微小的事項的話會讓人更加煩躁。可惜這時候你學到的東西都是model或是經驗都是<strong>後知之明</strong>，無法告訴你現在應該怎麼做。如果意識不到你的狀況和你經驗知識的關聯性，那麼就會腦筋打結了。創意、原創性、inventiveness、直覺、想像力這些解開問題的特性，完全不在科學方法理面。</li>
<li>打結時如果不去<strong>主動</strong>地觀察對象、發覺新的線索的話，永遠不會有新的突破。</li>
<li>禪宗花了很多功夫研究打結的狀況。他們透過呼吸打坐、參公案等方式追求頓悟，跳出頭腦打結的心理狀況，並且reset個人思緒，考慮各種可能。

<ul>
<li>Wen: 自己的解釋，不一定理解正確。</li>
</ul>
</li>
<li>打結是面對真理前的一關。這也是為何自學成功的人士有時會比專業訓練的人表現還佳。原因是專業訓練是狀況，解法這樣的訓練；而很少教到應付新的狀況。</li>
</ul>


<hr />

<h2>當代產品和美醜的關係</h2>

<ul>
<li>藝術和製造本為一體。在主流的古典理性思考和藝術二分法下，造成一般人不願意理解使用古典理性思考產出的物品運作法則。所以他們認為科技產品醜陋，原因是就是他們這無法使用些產品背後原理的辨別這些的產品美醜好壞。</li>
<li>作者認為當代產品之所以醜主要的原因是缺少identity。製造產品的人和產品沒有identity、消費者和產產品也沒有identity。這樣的identity正是主客分離的二元論式科學方法所欠缺的。科技並不是剝削大自然的產品，而是天人合一的結果。</li>
<li>想要達使用優美的方式解決問題，需要有分辨好壞的能力，以及達到好的境界的基礎方法。現在的知識和方式有意無意地讓人尋求標準答案。這個標準答案非常可能達到「好」的境界的方法之一，然而如何判別體會什麼叫作「好」，這些標準答案可沒有辦法幫得上忙。</li>
<li>由於缺少identity，現代產品外表顯現出來的特性就是枯燥。而製造者也發現這樣的現象，他們的workaround就是使用設計將產品加上「風格」美化。然而這樣的workaround最壞的狀況會讓枯燥的外表加上虛偽的感覺。到處充滿人工美化的造型產品並不會讓人感覺生活在美好的生活中。這樣的科技雖然帶來物質上好處，卻把整個世界變成美化的垃圾場。</li>
</ul>


<h2>內心寧靜</h2>

<ul>
<li>保持內心寧靜是很重要的評價方式。能夠讓人保持內心平靜的產品或是方式就是好的，反之則是壞的。所有的外在事物的目的是協助人心平氣和。只有心平氣和的情況才能夠體會Quailty，也就是說心平氣和後才能夠從理性以及藝術的角度體會Quailty。</li>
<li>當內心平靜後，非自我意識能夠產生對外環境完全自我認同的感覺。這樣的寧靜有三種層次

<ol>
<li>肉體上的平靜</li>
<li>心靈上的平靜</li>
<li>在平常生活中也能排除雜念</li>
</ol>
</li>
<li>心靈雜亂時的活動產生出來的品質不可能好。</li>
<li>工作時內心平靜，做事就能夠流暢平順。「感興趣」、「投入」、「有感覺」就是形容這樣的狀態。</li>
<li>作者提倡做事情應該要關心自己處理的對象，不要有心物分離的現象。</li>
<li>內心寧靜產生正確的價值，正確的價值產生正確的想法，正確的想法產稱正確的行動。</li>
</ul>


<hr />

<h2>Gumption</h2>

<ul>
<li>Gumption中文對應的概念是「選擇、做決定並施行的能力」。作者認為Gumption是心靈汽油，對應到書上的描述，中文也許翻譯成「氣勢」、「士氣」、「幹勁」比較符合作者的意念的感覺。</li>
<li>做事情或是解決問題最重要的就是要有Gumption，沒有這個東西，乾脆收工回家好了。所以做事的過程，保持足夠的Gumption是最重要的事情。為了保持足夠的Gumption，我們要隨時注意Gumption的水位，是否有太多消耗Gumption的事情發生。</li>
</ul>


<p><a href="http://en.wikipedia.org/wiki/Gumption_trap">Gumption Trap</a>: review和體會Quailty 遭遇到的各種阻礙：</p>

<ul>
<li>Setbacks: 外在因素讓人脫離Quailty。

<ul>
<li>拆了裝不回去。多善用筆記，沈穩思考定立方式防止在犯。</li>
<li>錯誤發生的情況不固定，找不出reproduce的步驟。</li>
<li>零件可能不齊全，或是規格不符。或是買到貴又不好的零件。</li>
</ul>
</li>
<li>Hang-ups: 內在因素讓人脫離Quailty

<ul>
<li>value trap: 重點是陷入其中時要仔細觀察看自己價值觀那邊需要修正。列是作者自己發現體會到的，也許對於每個人都有自己的value trap，有些可能不在下面。

<ul>
<li>value rigidity, 價值僵化，固守以前的經驗以至於無法發現新的事實。更精確的說，由於以前的經驗，造成眼前的事實對於你無法給予他們正確的評價，也就是有意無意的覺得眼前看到的事實不重要而視而不見。當你對於一個問題過早判斷，而判斷失物時，就要記得reset自己的結論，避免進入這個trap。新的事實發現，剛開始一定價值低到無法被注意到，隨者觀察者的注意，價值才會被提高，或是確認無益而降低。面對value trap的情況，一定要放慢腳步，像釣魚一樣，用心體會感受魚竿的的狀況，感受當魚吃餌釣竿的細微變化。另外面對新的事實，請避免使用原本假設和價值觀去判斷這個新事實，而是從新的事實出發看看有什麼其他的發現。</li>
<li>ego, 自負：為了自負唬爛不能夠解決問題，而且可以因為拒絕承認錯誤而讓你遠離發現新事實以及朝向解決問題的路上行進。</li>
<li>anxiety, 焦慮：焦慮是解決問題一開始最常見的trap，通常原因是動機太強烈，太過拘泥在無意的細節、產生更多的錯誤而嚇壞自己，形成惡性循環。這時候可以多讀相關領域書籍增加自信心，並且牢記<strong>追求的是心平氣和，而不是把痛苦解除</strong>。作者建議可以先列出想做的事情，再排列決定要做的順序。另外也要說服自己面對失手是會出現的。</li>
<li>Boredom, 無聊: 無聊代表已經失去注意力、不以新的角度看待事物。這時候中斷去做其他事如上網或睡覺後再回來。如果狀況仍然相同，可能要再確認是否有更深層的原因造成無聊。</li>
<li>Impatience, 缺乏耐心：作者以維修機車的情況認為是低估維修所需的時間，然而放到其他地方顯然並不適用。但是這個問題的確會影響gumption。</li>
</ul>
</li>
<li>truth trap: 作者引用禪宗無的概念，認為狀況並不是只有是、否這樣的狀態。而應該包含無，無代表的是答案不在目前假設的狀況投影出來的範圍內。這表示要修正假設、或是檢查步驟是否違反假設。</li>
<li>musle trap:

<ul>
<li>工具不充足</li>
<li>工作環境不優</li>
<li>個人體力不足以及肌肉對於器具的感觸不夠靈敏</li>
</ul>
</li>
</ul>
</li>
</ul>


<hr />

<h2>其他</h2>

<ul>
<li>幽靈和科學假設是否存在是同樣的情形。因為他們都是的感官無法察覺驗證，但是會有人深信存在的東西。</li>
<li>意識是從感官進來的資料，經過大腦篩選判定值得注意的事物。</li>
<li>理性思考<strong>切勿</strong>在精神狀態不佳時使用。</li>
<li>解決問題時一定會被謎團包圍，但是想要解決<strong>每個</strong>謎團最後就是永遠解決不了最初要處理的問題。</li>
<li>東方哲學否定西方理性思考的主客分離概念，他們認為思考的人和思考對象是一體的。他們透過消除「肢體活動」、「心理活動」、和「情緒活動」等方式去除思考時主客分離的情況(太玄了)。</li>
<li>當你對某些事物有絕對的信心，就不會致力於推廣。也就是說對於這些事物信心不足，想要取得自我認同才會致力於推廣。

<ul>
<li>我個人覺得部份同意，然而如果是這樣有很多好的想法可能就無法用足夠的速度傳播，甚至會變成獨善其身而任由好的想法出現卻沒有辦法造福全人類。</li>
</ul>
</li>
<li>目前的model遇到無法預測的事物，必須要停下來review，try-and-error後才可能做出改正。也許是砍掉重練或是擴充目前的model。這段時間會上讓人心不穩定，陷入恐懼或焦慮的情形。</li>
<li>理性思考，切割分析整理出來的model並無法套用到藝術，美感上面。這也是理性的限制。

<ul>
<li>Wen: 康得好像有關於美的一些思考，不過作者只有隱約提到那些很「醜」。另外康得的作品我也沒讀。</li>
</ul>
</li>
<li>作文評價因素：一貫性、鮮活度、權威性、敏感度、清晰度、強調性、流暢感、懸疑感等。</li>
<li>證明自我式的登山目的是征服山脈，除了山頂什麼都看不到。人在登山心卻不在裏面，focus在山頂而不是「現在」，每一步都走的很辛苦，因為他的目標想像成外在又遙遠的東西。到了山頂又更不滿足，因為變得還要找到下一個山頂來證明自我。</li>
<li>邏輯兩難處理方式

<ul>
<li>承認其中一種定義，據此反駁。</li>
<li>指出選項以外的情況。</li>
<li>訴諸權威。</li>
<li>詭辯法

<ul>
<li>轉移話題，避重就輕。</li>
<li>裝死。</li>
</ul>
</li>
</ul>
</li>
<li>不精確的描述比不描述還慘。</li>
<li>知道答案以後，答案才變得簡單。</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/11">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/9">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/08/03/load-elf-binary-trace/">Load_elf_binary Trace</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/06/15/field-investigation-link-objs/">田野調查：Ubuntu 18.04.2 產生執行檔細節</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/06/08/glibc-build-observing/">觀察編譯glibc的產出</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/06/08/glibc-surface-observing/">在Ubuntu 18.04.2 Trace 程式呼叫 Glibc 函數</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/03/20/dump-process-memory-block-via-gdb/">從gdb Dump Process 記憶體資料</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Top Categories</h1>
    <ul id="top-category-list"><li><a href='/blog/categories/linux'>linux (45)</a></li><li><a href='/blog/categories/c'>c (36)</a></li><li><a href='/blog/categories/debian'>debian (16)</a></li><li><a href='/blog/categories/presentation'>presentation (14)</a></li><li><a href='/blog/categories/binutils'>binutils (14)</a></li><li><a href='/blog/categories/arm'>arm (12)</a></li><li><a href='/blog/categories/octopress'>octopress (9)</a></li><li><a href='/blog/categories/gan-xiang'>感想 (8)</a></li><li><a href='/blog/categories/make'>make (6)</a></li><li><a href='/blog/categories/stm32'>stm32 (5)</a></li></ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/arm'>arm (12)</a></li><li><a href='/blog/categories/asm'>asm (1)</a></li><li><a href='/blog/categories/assembler'>assembler (2)</a></li><li><a href='/blog/categories/assembly'>assembly (3)</a></li><li><a href='/blog/categories/autotools'>autotools (4)</a></li><li><a href='/blog/categories/banana-pi'>banana pi (1)</a></li><li><a href='/blog/categories/bash'>bash (1)</a></li><li><a href='/blog/categories/binutil'>binutil (1)</a></li><li><a href='/blog/categories/binutils'>binutils (14)</a></li><li><a href='/blog/categories/buildroot'>buildroot (2)</a></li><li><a href='/blog/categories/c'>c (36)</a></li><li><a href='/blog/categories/c-preprocessor'>c preprocessor (1)</a></li><li><a href='/blog/categories/c99'>c99 (2)</a></li><li><a href='/blog/categories/cmake'>cmake (2)</a></li><li><a href='/blog/categories/cscope'>cscope (1)</a></li><li><a href='/blog/categories/ctags'>ctags (1)</a></li><li><a href='/blog/categories/dbdoclet'>dbdoclet (1)</a></li><li><a href='/blog/categories/debian'>debian (16)</a></li><li><a href='/blog/categories/debootstrap'>debootstrap (1)</a></li><li><a href='/blog/categories/debug'>debug (1)</a></li><li><a href='/blog/categories/doxygen'>doxygen (1)</a></li><li><a href='/blog/categories/elf'>elf (2)</a></li><li><a href='/blog/categories/f9'>f9 (1)</a></li><li><a href='/blog/categories/free-software'>free software (1)</a></li><li><a href='/blog/categories/freertos'>freertos (1)</a></li><li><a href='/blog/categories/fsf'>fsf (1)</a></li><li><a href='/blog/categories/gcc'>gcc (2)</a></li><li><a href='/blog/categories/gdb'>gdb (4)</a></li><li><a href='/blog/categories/getopt'>getopt (1)</a></li><li><a href='/blog/categories/gettext'>gettext (2)</a></li><li><a href='/blog/categories/git'>git (4)</a></li><li><a href='/blog/categories/git-remote'>git remote (2)</a></li><li><a href='/blog/categories/github-flavored-markdown'>github flavored markdown (1)</a></li><li><a href='/blog/categories/github-pages'>github pages (1)</a></li><li><a href='/blog/categories/glibc'>glibc (3)</a></li><li><a href='/blog/categories/gnu'>gnu (2)</a></li><li><a href='/blog/categories/gnu-as'>gnu as (1)</a></li><li><a href='/blog/categories/gpl'>gpl (1)</a></li><li><a href='/blog/categories/gstreamer'>gstreamer (1)</a></li><li><a href='/blog/categories/hole'>hole (1)</a></li><li><a href='/blog/categories/inline'>inline (1)</a></li><li><a href='/blog/categories/javadoc'>javadoc (2)</a></li><li><a href='/blog/categories/kernel'>kernel (2)</a></li><li><a href='/blog/categories/ld'>ld (1)</a></li><li><a href='/blog/categories/libtool'>libtool (2)</a></li><li><a href='/blog/categories/linker'>linker (2)</a></li><li><a href='/blog/categories/linker-script'>linker script (5)</a></li><li><a href='/blog/categories/linux'>linux (45)</a></li><li><a href='/blog/categories/linux-kernel'>linux kernel (3)</a></li><li><a href='/blog/categories/linux-utilities'>linux utilities (2)</a></li><li><a href='/blog/categories/live-cd'>live cd (1)</a></li><li><a href='/blog/categories/lseek'>lseek (1)</a></li><li><a href='/blog/categories/macro'>macro (1)</a></li><li><a href='/blog/categories/make'>make (6)</a></li><li><a href='/blog/categories/markdown'>markdown (2)</a></li><li><a href='/blog/categories/octopress'>octopress (9)</a></li><li><a href='/blog/categories/osm'>osm (1)</a></li><li><a href='/blog/categories/patch'>patch (1)</a></li><li><a href='/blog/categories/pbuilder'>pbuilder (2)</a></li><li><a href='/blog/categories/pomodoro-technique'>pomodoro technique (1)</a></li><li><a href='/blog/categories/presentation'>presentation (14)</a></li><li><a href='/blog/categories/python'>python (4)</a></li><li><a href='/blog/categories/qemu'>qemu (5)</a></li><li><a href='/blog/categories/quilt'>quilt (1)</a></li><li><a href='/blog/categories/regex'>regex (2)</a></li><li><a href='/blog/categories/rtenv'>rtenv (1)</a></li><li><a href='/blog/categories/rtos'>rtos (1)</a></li><li><a href='/blog/categories/semihosting'>semihosting (1)</a></li><li><a href='/blog/categories/shell-script'>shell script (4)</a></li><li><a href='/blog/categories/software-development'>software development (1)</a></li><li><a href='/blog/categories/stm32'>stm32 (5)</a></li><li><a href='/blog/categories/strip'>strip (1)</a></li><li><a href='/blog/categories/trace'>trace (1)</a></li><li><a href='/blog/categories/ubuntu'>ubuntu (1)</a></li><li><a href='/blog/categories/upnp'>upnp (1)</a></li><li><a href='/blog/categories/usb'>usb (1)</a></li><li><a href='/blog/categories/valgrind'>valgrind (2)</a></li><li><a href='/blog/categories/vim'>vim (5)</a></li><li><a href='/blog/categories/vim-plugin'>vim plugin (1)</a></li><li><a href='/blog/categories/virtualbox'>virtualbox (2)</a></li><li><a href='/blog/categories/vundle'>vundle (1)</a></li><li><a href='/blog/categories/wireless'>wireless (1)</a></li><li><a href='/blog/categories/wpa-supplicant'>wpa_supplicant (1)</a></li><li><a href='/blog/categories/tai-wan-xiao-chi'>台灣小吃 (1)</a></li><li><a href='/blog/categories/gan-xiang'>感想 (8)</a></li><li><a href='/blog/categories/kuang-rou'>爌肉 (1)</a></li><li><a href='/blog/categories/bi-ji'>筆記 (2)</a></li><li><a href='/blog/categories/zu-zhuang'>組裝 (3)</a></li><li><a href='/blog/categories/lao-jian-zhu'>老建築 (3)</a></li><li><a href='/blog/categories/guo-qi'>過期 (3)</a></li></ul>
</section>
<section>
  <h1>Category Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/arm' style='font-size: 116.0%'>arm(12)</a> <a href='/blog/categories/asm' style='font-size: 101.33333333333333%'>asm(1)</a> <a href='/blog/categories/assembler' style='font-size: 102.66666666666667%'>assembler(2)</a> <a href='/blog/categories/assembly' style='font-size: 104.0%'>assembly(3)</a> <a href='/blog/categories/autotools' style='font-size: 105.33333333333333%'>autotools(4)</a> <a href='/blog/categories/banana-pi' style='font-size: 101.33333333333333%'>banana pi(1)</a> <a href='/blog/categories/bash' style='font-size: 101.33333333333333%'>bash(1)</a> <a href='/blog/categories/binutil' style='font-size: 101.33333333333333%'>binutil(1)</a> <a href='/blog/categories/binutils' style='font-size: 118.66666666666667%'>binutils(14)</a> <a href='/blog/categories/buildroot' style='font-size: 102.66666666666667%'>buildroot(2)</a> <a href='/blog/categories/c' style='font-size: 148.0%'>c(36)</a> <a href='/blog/categories/c-preprocessor' style='font-size: 101.33333333333333%'>c preprocessor(1)</a> <a href='/blog/categories/c99' style='font-size: 102.66666666666667%'>c99(2)</a> <a href='/blog/categories/cmake' style='font-size: 102.66666666666667%'>cmake(2)</a> <a href='/blog/categories/cscope' style='font-size: 101.33333333333333%'>cscope(1)</a> <a href='/blog/categories/ctags' style='font-size: 101.33333333333333%'>ctags(1)</a> <a href='/blog/categories/dbdoclet' style='font-size: 101.33333333333333%'>dbdoclet(1)</a> <a href='/blog/categories/debian' style='font-size: 121.33333333333333%'>debian(16)</a> <a href='/blog/categories/debootstrap' style='font-size: 101.33333333333333%'>debootstrap(1)</a> <a href='/blog/categories/debug' style='font-size: 101.33333333333333%'>debug(1)</a> <a href='/blog/categories/doxygen' style='font-size: 101.33333333333333%'>doxygen(1)</a> <a href='/blog/categories/elf' style='font-size: 102.66666666666667%'>elf(2)</a> <a href='/blog/categories/f9' style='font-size: 101.33333333333333%'>f9(1)</a> <a href='/blog/categories/free-software' style='font-size: 101.33333333333333%'>free software(1)</a> <a href='/blog/categories/freertos' style='font-size: 101.33333333333333%'>freertos(1)</a> <a href='/blog/categories/fsf' style='font-size: 101.33333333333333%'>fsf(1)</a> <a href='/blog/categories/gcc' style='font-size: 102.66666666666667%'>gcc(2)</a> <a href='/blog/categories/gdb' style='font-size: 105.33333333333333%'>gdb(4)</a> <a href='/blog/categories/getopt' style='font-size: 101.33333333333333%'>getopt(1)</a> <a href='/blog/categories/gettext' style='font-size: 102.66666666666667%'>gettext(2)</a> <a href='/blog/categories/git' style='font-size: 105.33333333333333%'>git(4)</a> <a href='/blog/categories/git-remote' style='font-size: 102.66666666666667%'>git remote(2)</a> <a href='/blog/categories/github-flavored-markdown' style='font-size: 101.33333333333333%'>github flavored markdown(1)</a> <a href='/blog/categories/github-pages' style='font-size: 101.33333333333333%'>github pages(1)</a> <a href='/blog/categories/glibc' style='font-size: 104.0%'>glibc(3)</a> <a href='/blog/categories/gnu' style='font-size: 102.66666666666667%'>gnu(2)</a> <a href='/blog/categories/gnu-as' style='font-size: 101.33333333333333%'>gnu as(1)</a> <a href='/blog/categories/gpl' style='font-size: 101.33333333333333%'>gpl(1)</a> <a href='/blog/categories/gstreamer' style='font-size: 101.33333333333333%'>gstreamer(1)</a> <a href='/blog/categories/hole' style='font-size: 101.33333333333333%'>hole(1)</a> <a href='/blog/categories/inline' style='font-size: 101.33333333333333%'>inline(1)</a> <a href='/blog/categories/javadoc' style='font-size: 102.66666666666667%'>javadoc(2)</a> <a href='/blog/categories/kernel' style='font-size: 102.66666666666667%'>kernel(2)</a> <a href='/blog/categories/ld' style='font-size: 101.33333333333333%'>ld(1)</a> <a href='/blog/categories/libtool' style='font-size: 102.66666666666667%'>libtool(2)</a> <a href='/blog/categories/linker' style='font-size: 102.66666666666667%'>linker(2)</a> <a href='/blog/categories/linker-script' style='font-size: 106.66666666666667%'>linker script(5)</a> <a href='/blog/categories/linux' style='font-size: 160.0%'>linux(45)</a> <a href='/blog/categories/linux-kernel' style='font-size: 104.0%'>linux kernel(3)</a> <a href='/blog/categories/linux-utilities' style='font-size: 102.66666666666667%'>linux utilities(2)</a> <a href='/blog/categories/live-cd' style='font-size: 101.33333333333333%'>live cd(1)</a> <a href='/blog/categories/lseek' style='font-size: 101.33333333333333%'>lseek(1)</a> <a href='/blog/categories/macro' style='font-size: 101.33333333333333%'>macro(1)</a> <a href='/blog/categories/make' style='font-size: 108.0%'>make(6)</a> <a href='/blog/categories/markdown' style='font-size: 102.66666666666667%'>markdown(2)</a> <a href='/blog/categories/octopress' style='font-size: 112.0%'>octopress(9)</a> <a href='/blog/categories/osm' style='font-size: 101.33333333333333%'>osm(1)</a> <a href='/blog/categories/patch' style='font-size: 101.33333333333333%'>patch(1)</a> <a href='/blog/categories/pbuilder' style='font-size: 102.66666666666667%'>pbuilder(2)</a> <a href='/blog/categories/pomodoro-technique' style='font-size: 101.33333333333333%'>pomodoro technique(1)</a> <a href='/blog/categories/presentation' style='font-size: 118.66666666666667%'>presentation(14)</a> <a href='/blog/categories/python' style='font-size: 105.33333333333333%'>python(4)</a> <a href='/blog/categories/qemu' style='font-size: 106.66666666666667%'>qemu(5)</a> <a href='/blog/categories/quilt' style='font-size: 101.33333333333333%'>quilt(1)</a> <a href='/blog/categories/regex' style='font-size: 102.66666666666667%'>regex(2)</a> <a href='/blog/categories/rtenv' style='font-size: 101.33333333333333%'>rtenv(1)</a> <a href='/blog/categories/rtos' style='font-size: 101.33333333333333%'>rtos(1)</a> <a href='/blog/categories/semihosting' style='font-size: 101.33333333333333%'>semihosting(1)</a> <a href='/blog/categories/shell-script' style='font-size: 105.33333333333333%'>shell script(4)</a> <a href='/blog/categories/software-development' style='font-size: 101.33333333333333%'>software development(1)</a> <a href='/blog/categories/stm32' style='font-size: 106.66666666666667%'>stm32(5)</a> <a href='/blog/categories/strip' style='font-size: 101.33333333333333%'>strip(1)</a> <a href='/blog/categories/trace' style='font-size: 101.33333333333333%'>trace(1)</a> <a href='/blog/categories/ubuntu' style='font-size: 101.33333333333333%'>ubuntu(1)</a> <a href='/blog/categories/upnp' style='font-size: 101.33333333333333%'>upnp(1)</a> <a href='/blog/categories/usb' style='font-size: 101.33333333333333%'>usb(1)</a> <a href='/blog/categories/valgrind' style='font-size: 102.66666666666667%'>valgrind(2)</a> <a href='/blog/categories/vim' style='font-size: 106.66666666666667%'>vim(5)</a> <a href='/blog/categories/vim-plugin' style='font-size: 101.33333333333333%'>vim plugin(1)</a> <a href='/blog/categories/virtualbox' style='font-size: 102.66666666666667%'>virtualbox(2)</a> <a href='/blog/categories/vundle' style='font-size: 101.33333333333333%'>vundle(1)</a> <a href='/blog/categories/wireless' style='font-size: 101.33333333333333%'>wireless(1)</a> <a href='/blog/categories/wpa-supplicant' style='font-size: 101.33333333333333%'>wpa_supplicant(1)</a> <a href='/blog/categories/tai-wan-xiao-chi' style='font-size: 101.33333333333333%'>台灣小吃(1)</a> <a href='/blog/categories/gan-xiang' style='font-size: 110.66666666666667%'>感想(8)</a> <a href='/blog/categories/kuang-rou' style='font-size: 101.33333333333333%'>爌肉(1)</a> <a href='/blog/categories/bi-ji' style='font-size: 102.66666666666667%'>筆記(2)</a> <a href='/blog/categories/zu-zhuang' style='font-size: 104.0%'>組裝(3)</a> <a href='/blog/categories/lao-jian-zhu' style='font-size: 104.0%'>老建築(3)</a> <a href='/blog/categories/guo-qi' style='font-size: 104.0%'>過期(3)</a> </span>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.<br>
  Copyright &copy; 2020 - Wen Liao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'httpwen00072githubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
