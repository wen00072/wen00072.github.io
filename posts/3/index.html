
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My code works, I don&#8217;t know why.</title>
  <meta name="author" content="Wen Liao">
  <meta property="og:image" content="https://wen00072.github.io/files/pb.jpg" />


  
  <meta name="description" content="前言 閉著眼睛學東西最困擾的是資料很多，但是完全不知道怎麼從那邊下手。這次運氣很好終於找到大大推荐的入門教材: Discovering the STM32 Microcontroller作為一個突破點。雖然他上面講的是STM32F1，不過改一下還是可以在開發版上面動，短期內的自學大概會以這本書為主 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wen00072.github.io/posts/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My code works, I don't know why." type="application/atom+xml">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My code works, I don&#8217;t know why.</a></h1>
  
    <h2>國王的耳朵是驢耳朵</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="wen00072.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/categories">Categories</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/27/arm-cm4-pratice-2-lab-led/">ARM CM4 Pratice (2): 實驗軟體專案規劃和LED閃滅實驗</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-27T19:14:27+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:14 pm</span></time>
        
           | <a href="/blog/2016/06/27/arm-cm4-pratice-2-lab-led/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2016/06/27/arm-cm4-pratice-2-lab-led/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>前言</h2>

<p>閉著眼睛學東西最困擾的是資料很多，但是完全不知道怎麼從那邊下手。這次運氣很好終於找到大大推荐的<a href="http://homes.soic.indiana.edu/geobrown/index.cgi/teaching">入門教材: Discovering the STM32 Microcontroller</a>作為一個突破點。雖然他上面講的是STM32F1，不過改一下還是可以在開發版上面動，短期內的自學大概會以這本書為主。</p>

<p>本篇文章主要是介紹在GNU/Linux下的STM32F429　開發軟體，這次以LED閃滅為實習題目，以後的實習會基於這次的專案為主。有興趣的朋友請自行到我的<a href="https://github.com/zzz0072/STM32F429-Discovery-Disco-Pratice">Github repository</a>取用。注意是這個專案單純自爽，常常會<code>git push -f</code>變動commit，如果有人fork我再調整。</p>

<h2>目錄</h2>

<ul>
<li><a href="#STM-ENV">測試環境</a></li>
<li><a href="#STM_PRJ">專案規劃</a></li>
<li><a href="#STM_MK">Makefile撰寫</a>

<ul>
<li><a href="#STM_MK_COMM">共用變數</a></li>
<li><a href="#STM_MK_TEMP">專案Makefile template</a></li>
</ul>
</li>
<li><a href="#STM_LED">第一支程式: LED閃滅</a>

<ul>
<li><a href="#STM_LED_LK_STRP">Linker script 和 start up檔案</a></li>
<li><a href="#STM_LED_GPIO">GPIO API</a></li>
<li><a href="#STM_LED_TIMER_ISR">Timer ISR</a></li>
<li><a href="#STM_LED_CODE">程式碼</a></li>
<li><a href="#STM_LED_VERIFY">燒錄和測試</a></li>
</ul>
</li>
<li><a href="#STM-SPL-REF">參考資料</a></li>
</ul>


<p><a name="STM-ENV"></a></p>

<h2>測試環境</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.4 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty
</span><span class='line'>
</span><span class='line'>$ arm-none-eabi-gcc --version
</span><span class='line'>arm-none-eabi-gcc (GNU Tools for ARM Embedded Processors) 5.4.1 20160609 (release) [ARM/embedded-5-branch revision 237715]
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p></p>

<ul>
<li>SPL版本： STM32F4xx_DSP_StdPeriph_Lib_V1.6.1</li>
<li>開發板： STM32F4 Dicovery, <a href="http://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-eval-tools/stm32-mcu-eval-tools/stm32-mcu-discovery-kits/32f429idiscovery.html">STM32F429-Disco</a></li>
<li>SPL 目錄架構</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ tree -d -L 4
</span><span class='line'>.
</span><span class='line'>└── STM32F4xx_DSP_StdPeriph_Lib_V1.6.1
</span><span class='line'>    ├── _htmresc
</span><span class='line'>    ├── Libraries
</span><span class='line'>    │   ├── CMSIS
</span><span class='line'>    │   │   ├── Device
</span><span class='line'>    │   │   ├── Documentation
</span><span class='line'>    │   │   ├── DSP_Lib
</span><span class='line'>    │   │   ├── Include
</span><span class='line'>    │   │   ├── Lib
</span><span class='line'>    │   │   └── RTOS
</span><span class='line'>    │   └── STM32F4xx_StdPeriph_Driver
</span><span class='line'>    │       ├── inc
</span><span class='line'>    │       └── src
</span><span class='line'>    ├── Project
</span><span class='line'>    │   ├── STM32F4xx_StdPeriph_Examples
</span><span class='line'>    │   └── STM32F4xx_StdPeriph_Templates
</span><span class='line'>    └── Utilities
</span><span class='line'>        ├── Media
</span><span class='line'>        ├── ST
</span><span class='line'>        ├── STM32_EVAL
</span><span class='line'>        └── Third_Party
</span></code></pre></td></tr></table></div></figure>


<p><a name="STM_PRJ"></a></p>

<h2>專案規劃</h2>

<p>看<a href="http://www.cs.indiana.edu/~geobrown/book.pdf">Discovering the STM32 Microcontroller</a>這本書後啟發的。想法整理如下：</p>

<ul>
<li>目的：建立一個練習STM32F4開發版的專案</li>
<li>專案需要的資料

<ul>
<li>STM 函式庫 source code

<ul>
<li>這部份要去官方網站下載，不會放到github上面</li>
</ul>
</li>
<li>Build code 共用的設定如toolchain、路徑、compile flag等</li>
<li>一些template 檔案加入開發如Makefile、linker script、config header file</li>
</ul>
</li>
</ul>


<p>最後的目錄就是這樣。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ tree -L 3
</span><span class='line'>.
</span><span class='line'>├── conf
</span><span class='line'>│   ├── build.def
</span><span class='line'>│   ├── Makefile.template
</span><span class='line'>│   ├── stm32f4xx_conf.h
</span><span class='line'>│   └── template-bared.ld
</span><span class='line'>├── labs
</span><span class='line'>│   └── 0_led
</span><span class='line'>│       ├── led.c
</span><span class='line'>│       ├── led.ld
</span><span class='line'>│       ├── Makefile
</span><span class='line'>│       └── stm32f4xx_conf.h
</span><span class='line'>├── libraries
</span><span class='line'>│   ├── readme.txt
</span><span class='line'>│   └── STM32F4xx_DSP_StdPeriph_Lib_V1.6.1
</span><span class='line'>├── LICENSE
</span><span class='line'>└── README.md
</span></code></pre></td></tr></table></div></figure>


<p>請注意SPL可能會因為下載版本不同，變數宣告、常數宣告、和檔案名稱路徑可能不同造成編譯失敗，這時候就當組裝作業自己解決吧。</p>

<p><a name="STM_MK"></a></p>

<h2>Makefile撰寫</h2>

<p><a name="STM_MK_COMM"></a></p>

<h3>共用變數</h3>

<p>這邊我們需要一個共用的設定，在實習的時候直接include。詳細說明如下，懶得看的可以直接看<a href="https://github.com/zzz0072/STM32F429-Discovery-Disco-Pratice/blob/master/conf/build.def">檔案內容</a>。</p>

<ul>
<li>Toolchain設定

<ul>
<li>安裝請參考<a href="http://wen00072.github.io/blog/2016/04/06/arm-cm4-pratice-0-environment-setup/">這邊</a></li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">TOOL_CHAIN_PREFIX</span><span class="o">=</span>arm-none-eabi
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>路徑設定

<ul>
<li>我們需要<strong>定位</strong>專案的最頂端位址才能設定其他路徑的相對位址</li>
<li>除了您自己的檔案，ST 提供的函式庫和ARM的CMSIS在開發都會用到</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">PRJ_ROOT</span><span class="o">?=</span>..
</span><span class='line'><span class="nv">LIB_DIR</span><span class="o">=</span><span class="k">$(</span>PRJ_ROOT<span class="k">)</span>/libraries/STM32F4xx_DSP_StdPeriph_Lib_V1.6.1/Libraries
</span><span class='line'><span class="nv">STM_DIR</span><span class="o">=</span><span class="k">$(</span>LIB_DIR<span class="k">)</span>/STM32F4xx_StdPeriph_Driver
</span><span class='line'><span class="nv">CMSIS_DIR</span><span class="o">=</span><span class="k">$(</span>LIB_DIR<span class="k">)</span>/CMSIS
</span><span class='line'><span class="nv">LDSCRIPT</span><span class="o">?=</span><span class="k">$(</span>PRJ_ROOT<span class="k">)</span>/conf/bared.ld
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>指定開發平台</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">PLATFORM</span> <span class="o">=</span> STM32F429_439xx
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>設定header file路徑</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">SPL_INC</span><span class="o">=</span><span class="k">$(</span>STM_DIR<span class="k">)</span>/inc
</span><span class='line'><span class="nv">CMSIS_COMMON_INC</span> <span class="o">=</span> <span class="k">$(</span>CMSIS_DIR<span class="k">)</span>/Include
</span><span class='line'><span class="nv">CMSIS_STM32_INC</span>  <span class="o">=</span> <span class="k">$(</span>CMSIS_DIR<span class="k">)</span>/Device/ST/STM32F4xx/Include
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>指令所有產生的檔案都放到build目錄</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">OUT_DIR</span><span class="o">=</span><span class="k">$(</span>PRJ_ROOT<span class="k">)</span>/build
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>設定start up檔案和system檔案路徑</li>
</ul>


<p>除非你要自己從flash搬資料到RAM、設定ISR vector、RCC等，不然一定會用到start up 檔案和system檔案。start up 檔案在SPL中有很多範本，我們使用了<code>gcc_ride7</code>這個版本，原因是其他的都沒有<code>gcc</code>這個字眼。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">CMSIS_STARTUP_SRC</span> <span class="o">=</span> <span class="k">$(</span>CMSIS_DIR<span class="k">)</span>/Device/ST/STM32F4xx/Source/Templates/gcc_ride7/startup_stm32f429_439xx.s
</span><span class='line'><span class="nv">CMSIS_SYSTEM_SRC</span>  <span class="o">=</span> <span class="k">$(</span>CMSIS_DIR<span class="k">)</span>/Device/ST/STM32F4xx/Source/Templates/system_stm32f4xx.c
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>設定debug mode</li>
</ul>


<p>SPL提供assertion，使用USE_FULL_ASSERT打開。打開以後需要自行實作函數<code>void assert_failed(uint8_t* file, uint32_t line)</code>。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">BUILD_MODE</span> <span class="o">=</span> DEBUG
</span><span class='line'>
</span><span class='line'><span class="cp">ifeq ($(BUILD_MODE), DEBUG)</span>
</span><span class='line'>        CFLAGS +<span class="o">=</span> -DUSE_FULL_ASSERT -g3
</span><span class='line'><span class="cp">endif</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>CPU相關compile flags</li>
</ul>


<p>STM32F4使用Cotex M4。題外話，對於toolchain有興趣的可以用<code>arm-none-eabi-gcc -Q --help=target</code>查詢有支援哪些平台。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">ARCH_FLAGS</span> <span class="o">=</span> -mthumb -mcpu<span class="o">=</span>cortex-m4
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Compile flag分為

<ul>
<li>增加嚴格的錯誤檢查</li>
<li>設定include 路徑</li>
<li>叫toolchain不要用使用內建的函式庫如libc</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">LDFLAGS</span> <span class="o">+=</span> -T<span class="k">$(</span>LDSCRIPT<span class="k">)</span> <span class="k">$(</span>ARCH_FLAGS<span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">CFLAGS</span> <span class="o">+=</span> <span class="k">$(</span>ARCH_FLAGS<span class="k">)</span>
</span><span class='line'><span class="nv">CFLAGS</span> <span class="o">+=</span> -I. -I<span class="k">$(</span>SPL_INC<span class="k">)</span> -I<span class="k">$(</span>CMSIS_COMMON_INC<span class="k">)</span> -I<span class="k">$(</span>CMSIS_STM32_INC<span class="k">)</span>
</span><span class='line'><span class="nv">CFLAGS</span> <span class="o">+=</span> -D<span class="k">$(</span>PLATFORM<span class="k">)</span> -DUSE_STDPERIPH_DRIVER <span class="k">$(</span>FULLASSERT<span class="k">)</span>
</span><span class='line'><span class="nv">CFLAGS</span> <span class="o">+=</span> -Wall -Werror -MMD -std<span class="o">=</span>c99
</span><span class='line'><span class="nv">CFLAGS</span> <span class="o">+=</span> -fno-common -ffreestanding -O0
</span></code></pre></td></tr></table></div></figure>


<p><a name="STM_MK_TEMP"></a></p>

<h3>專案Makefile template</h3>

<p>這邊直接把LED閃滅的Makefile拿來當template，詳細說明如下，一樣懶得看的可以去<a href="https://github.com/zzz0072/STM32F429-Discovery-Disco-Pratice/blob/master/conf/Makefile.template">這邊</a>看檔案內容。</p>

<ul>
<li>產生的binary 檔名、定位專案的最頂端位址、並且載入<a href="#STM_MK_COMM">前面</a>的設定檔。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">TARGET</span><span class="o">=</span>led
</span><span class='line'><span class="nv">PRJ_ROOT</span><span class="o">=</span><span class="k">$(</span>shell <span class="nb">cd</span> ../../ <span class="p">;</span> <span class="nb">pwd</span><span class="k">)</span>
</span><span class='line'><span class="cp">include $(PRJ_ROOT)/conf/build.def</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>指定要編譯的SPL 檔案</li>
</ul>


<p>除了前面<a href="#STM_MK_COMM">前面</a>提到的start up檔案、system檔、還有你自己的程式碼外，根據你的需求，還會需要SPL的驅動程式。這個專案我們需要<code>GPIO</code>和<code>RCC</code> (reset clock control)這兩個部份。一個是用來控制LED、另外一個用來計算時間產生以控制閃滅。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">SRCS</span>  <span class="o">=</span> <span class="k">$(</span>CMSIS_STARTUP_SRC<span class="k">)</span> <span class="k">$(</span>CMSIS_SYSTEM_SRC<span class="k">)</span>
</span><span class='line'><span class="nv">SRCS</span> <span class="o">+=</span> <span class="k">$(</span>STM_DIR<span class="k">)</span>/src/stm32f4xx_gpio.c
</span><span class='line'><span class="nv">SRCS</span> <span class="o">+=</span> <span class="k">$(</span>STM_DIR<span class="k">)</span>/src/stm32f4xx_rcc.c
</span><span class='line'><span class="nv">SRCS</span> <span class="o">+=</span> led.c
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>檔名轉換</li>
</ul>


<p>上面的是source檔案，但是我們編譯需要把source檔案轉成object檔案並且存在./build目錄下。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">C_OBJS</span> <span class="o">=</span> <span class="k">$(</span>patsubst %.c, %.o, <span class="k">$(</span>SRCS<span class="k">))</span>   <span class="c"># translate *.c to *.o</span>
</span><span class='line'><span class="nv">OBJS</span>   <span class="o">=</span> <span class="k">$(</span>patsubst %.s, %.o, <span class="k">$(</span>C_OBJS<span class="k">))</span> <span class="c"># also *.s to *.o files</span>
</span><span class='line'>
</span><span class='line'><span class="nv">OUT_OBJS</span> <span class="o">=</span> <span class="k">$(</span>addprefix <span class="k">$(</span>OUT_DIR<span class="k">)</span>/, <span class="k">$(</span>OBJS<span class="k">))</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>產生led.bin</li>
</ul>


<p>不要被符號嚇到，說明如下</p>

<pre><code>* 產生build/led.bin檔，前提是上面的object 檔案都編譯完成
* 產生方式
    * 叫gcc 從前面的object檔案中，透過led.ld linker script產生出build/led.elf、build/led.map (debug用)
    * 從build/led.elf產生build/led.bin
    * 從build/led.elf產生build/led.list (debug用)
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nf">$(OUT_DIR)/$(TARGET).bin</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OUT_OBJS</span><span class="k">)</span>
</span><span class='line'>  <span class="k">$(</span>TOOL_CHAIN_PREFIX<span class="k">)</span>-gcc -Wl,-Map<span class="o">=</span><span class="k">$(</span>OUT_DIR<span class="k">)</span>/<span class="k">$(</span>TARGET<span class="k">)</span>.map,-T<span class="k">$(</span>TARGET<span class="k">)</span>.ld -nostartfiles <span class="se">\</span>
</span><span class='line'>      <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>OUT_OBJS<span class="k">)</span> -o <span class="k">$(</span>OUT_DIR<span class="k">)</span>/<span class="k">$(</span>TARGET<span class="k">)</span>.elf
</span><span class='line'>  <span class="k">$(</span>TOOL_CHAIN_PREFIX<span class="k">)</span>-objcopy -Obinary <span class="k">$(</span>OUT_DIR<span class="k">)</span>/<span class="k">$(</span>TARGET<span class="k">)</span>.elf <span class="nv">$@</span>
</span><span class='line'>  <span class="k">$(</span>TOOL_CHAIN_PREFIX<span class="k">)</span>-objdump -S <span class="k">$(</span>OUT_DIR<span class="k">)</span>/<span class="k">$(</span>TARGET<span class="k">)</span>.elf &gt; <span class="k">$(</span>OUT_DIR<span class="k">)</span>/<span class="k">$(</span>TARGET<span class="k">)</span>.list
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>編譯並產生object 檔案</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nf">$(OUT_DIR)/%.o</span><span class="o">:</span> %.<span class="n">s</span>
</span><span class='line'>  @mkdir -p <span class="k">$(</span>dir <span class="nv">$@</span><span class="k">)</span>
</span><span class='line'>  <span class="k">$(</span>TOOL_CHAIN_PREFIX<span class="k">)</span>-gcc -c <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="nv">$&lt;</span> -o <span class="nv">$@</span>
</span><span class='line'>
</span><span class='line'><span class="nf">$(OUT_DIR)/%.o</span><span class="o">:</span> %.<span class="n">c</span>
</span><span class='line'>  @mkdir -p <span class="k">$(</span>dir <span class="nv">$@</span><span class="k">)</span>
</span><span class='line'>  <span class="k">$(</span>TOOL_CHAIN_PREFIX<span class="k">)</span>-gcc -c <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="nv">$&lt;</span> -o <span class="nv">$@</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>燒錄</li>
</ul>


<p>可以下<code>make flash</code>燒錄。使用<code>openocd</code>的原因是因為<code>st-flash</code>偶爾會有寫燒錄完成但是實際上沒有燒進去的情況</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nf">flash</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OUT_DIR</span><span class="k">)</span>/<span class="k">$(</span><span class="nv">TARGET</span><span class="k">)</span>.<span class="n">bin</span>
</span><span class='line'>  openocd -f interface/stlink-v2.cfg  <span class="se">\</span>
</span><span class='line'>            -f target/stm32f4x.cfg      <span class="se">\</span>
</span><span class='line'>            -c <span class="s2">&quot;init&quot;</span>                   <span class="se">\</span>
</span><span class='line'>            -c <span class="s2">&quot;reset init&quot;</span>             <span class="se">\</span>
</span><span class='line'>            -c <span class="s2">&quot;stm32f2x unlock 0&quot;</span>      <span class="se">\</span>
</span><span class='line'>            -c <span class="s2">&quot;flash probe 0&quot;</span>          <span class="se">\</span>
</span><span class='line'>            -c <span class="s2">&quot;flash info 0&quot;</span>           <span class="se">\</span>
</span><span class='line'>            -c <span class="s2">&quot;flash write_image erase $&lt; 0x8000000&quot;</span> <span class="se">\</span>
</span><span class='line'>            -c <span class="s2">&quot;reset run&quot;</span> -c shutdown
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>以下不解釋</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nf">clean</span><span class="o">:</span>
</span><span class='line'>  rm -fr <span class="k">$(</span>OUT_DIR<span class="k">)</span> gdb.txt
</span></code></pre></td></tr></table></div></figure>


<p><a name="STM_LED"></a></p>

<h2>第一支程式: LED閃滅</h2>

<p><a name="STM_LED_LK_STRP"></a></p>

<h3>Linker script 和 start up檔案</h3>

<h4>Linker script</h4>

<p>linker script (<a href="https://github.com/zzz0072/STM32F429-Discovery-Disco-Pratice/blob/master/labs/0_led/led.ld">全文</a>)，這個script是從<a href="http://wiki.csie.ncku.edu.tw/embedded/rtenv">成大課程作業</a>修改的，簡單解釋如下</p>

<ul>
<li>有兩塊記憶體，一個是FLASH一個是RAM，FLASH 不可寫入。</li>
<li>那些<code>.text</code>、<code>.data</code>、<code>.bss</code>就不解釋了。我們這次關注下列的symbols

<ul>
<li><code>_sidata</code></li>
<li><code>_sdata</code></li>
<li><code>_edata</code></li>
<li><code>_sbss</code></li>
<li><code>_ebss</code></li>
<li><code>_estack</code></li>
</ul>
</li>
</ul>


<h4>Start up檔案</h4>

<p>上面的這些symbol，可以<a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S">對照</a>這邊的start up 程式碼中的<code>reset_handler</code>，可以發現：</p>

<ul>
<li><a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L49">第49行</a> 到 <a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L57">第57行</a>就宣告了這些symbol</li>
<li><a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L76">第76行</a> 到 <a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L89">第89行</a>使用了這些symbol將FLASH中的<code>.data</code>資料搬到<code>RAM</code>中</li>
<li><a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L89">第90行</a> 到 <a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L100">第100行</a>使用了這些symbol將<code>.bss</code>區段的值全部設成0</li>
</ul>


<p>搞定<code>.bss</code>和<code>.data</code>後，接下來start up會去<a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L103">呼叫systemInit</a>，而<code>systemInit</code>就在<code>system_stm32f4xx.c</code>裏面。設定完系統後就是你寫的程式碼<a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L105">main</a>上場了。</p>

<p>start up 檔案剩下的部份就是<a href="https://github.com/jserv/stm32f429-r3d/blob/master/startup_stm32f429_439xx.S#L128">.isr_vector</a>，可以想像成一個function pointer陣列(除了最開始的stack pointer，注意stack pointer初始值也是在linker script中設定的)。</p>

<p>另外一個要注意的是start up source code的順序和放在記憶體的順序不一致，真正在記憶體的順序請參考<a href="https://github.com/zzz0072/STM32F429-Discovery-Disco-Pratice/blob/master/labs/0_led/led.ld">linker script</a>。
<a name="STM_LED_GPIO"></a></p>

<h3>GPIO API</h3>

<p>設定順序如下</p>

<ul>
<li>看<a href="http://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-eval-tools/stm32-mcu-eval-tools/stm32-mcu-discovery-kits/32f429idiscovery.html">開發版手冊</a>找出要控制燈號的GPIO

<ul>
<li>我程式就是輪流點亮點滅LED 3和LED 4，手冊上說是GPIO G的第13和14腳位</li>
</ul>
</li>
<li>打開GPIO的clock（猜測嵌入式系統的電耗考慮，沒再用的設備都不開clock省電）</li>
<li>設定GPIO腳位的為輸出頻率為2MHz</li>
</ul>


<figure class='code'><figcaption><span>GPIO設定</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">setupLED</span><span class="p">(</span><span class="n">GPIO_InitTypeDef</span> <span class="o">*</span><span class="n">LED_InitStruct</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="cm">/* Setup LED GPIO */</span>
</span><span class='line'>    <span class="n">RCC_AHB1PeriphClockCmd</span><span class="p">(</span><span class="n">RCC_AHB1Periph_GPIOG</span><span class="p">,</span> <span class="n">ENABLE</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">GPIO_StructInit</span><span class="p">(</span><span class="n">LED_InitStruct</span><span class="p">);</span>
</span><span class='line'>    <span class="n">LED_InitStruct</span><span class="o">-&gt;</span><span class="n">GPIO_Pin</span>   <span class="o">=</span> <span class="n">GPIO_Pin_13</span> <span class="o">|</span> <span class="n">GPIO_Pin_14</span> <span class="p">;</span>
</span><span class='line'>    <span class="n">LED_InitStruct</span><span class="o">-&gt;</span><span class="n">GPIO_Mode</span>  <span class="o">=</span> <span class="n">GPIO_Mode_OUT</span><span class="p">;</span>
</span><span class='line'>    <span class="n">LED_InitStruct</span><span class="o">-&gt;</span><span class="n">GPIO_Speed</span> <span class="o">=</span> <span class="n">GPIO_Speed_2MHz</span><span class="p">;</span>
</span><span class='line'>    <span class="n">GPIO_Init</span><span class="p">(</span><span class="n">GPIOG</span><span class="p">,</span> <span class="n">LED_InitStruct</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>輸出資料到GPIO範例如下</li>
</ul>


<figure class='code'><figcaption><span>輸出資料到GPIO範例</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">GPIO_WriteBit</span><span class="p">(</span><span class="n">GPIOG</span><span class="p">,</span> <span class="n">GPIO_Pin_13</span> <span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><a name="STM_LED_TIMER_ISR"></a></p>

<h3>Timer ISR</h3>

<p>要做的是</p>

<ul>
<li>設定timer interrupt 出現的週期，設定成nano second的程式碼如下</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* Setup timer interrupt interval to nano second */</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="n">SysTick_Config</span><span class="p">(</span><span class="n">SystemCoreClock</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* Trap here if failed */</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>time out的ISR，基本上就是計數counter加上busy waiting而已</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">static</span> <span class="n">__IO</span> <span class="kt">uint32_t</span> <span class="n">g_timeToWakeUp</span><span class="p">;</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">sleep</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">nSec</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">g_timeToWakeUp</span> <span class="o">=</span> <span class="n">nSec</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Busy waiting */</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="n">g_timeToWakeUp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a name="STM_LED_CODE"></a></p>

<h3>程式碼</h3>

<p>這邊的assertion 實作單純是一個無限迴圈，當assertion失敗就會陷入這個迴圈。這時候用除錯器就可以找到出現assertion的行號了。</p>

<p>寫了以後開始修改程式碼或<code>Makefile</code>直到編譯過以後才針對程式行為除錯。</p>

<figure class='code'><figcaption><span>led.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &quot;stm32f4xx_conf.h&quot;</span>
</span><span class='line'><span class="cp">#include &lt;stm32f4xx.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stm32f4xx_gpio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* A Led blink lab for STM32 Discovry Disco                   *</span>
</span><span class='line'><span class="cm"> * Based on:                                                  *</span>
</span><span class='line'><span class="cm"> *   Discovering the STM32 Microcontroller by Geoffrey Brown. */</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">setupLED</span><span class="p">(</span><span class="n">GPIO_InitTypeDef</span> <span class="o">*</span><span class="n">LED_InitStruct</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">sleep</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">nSec</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">int</span> <span class="n">LEDVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">GPIO_InitTypeDef</span> <span class="n">LED_InitStruct</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Setup LED */</span>
</span><span class='line'>    <span class="n">setupLED</span><span class="p">(</span><span class="o">&amp;</span><span class="n">LED_InitStruct</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Setup timer interrupt interval to nano second */</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">SysTick_Config</span><span class="p">(</span><span class="n">SystemCoreClock</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* Trap here if failed */</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Blinking LED3 and LED4 */</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">GPIO_WriteBit</span><span class="p">(</span><span class="n">GPIOG</span><span class="p">,</span> <span class="n">GPIO_Pin_13</span> <span class="p">,</span> <span class="n">LEDVal</span><span class="p">);</span>
</span><span class='line'>        <span class="n">GPIO_WriteBit</span><span class="p">(</span><span class="n">GPIOG</span><span class="p">,</span> <span class="n">GPIO_Pin_14</span> <span class="p">,</span> <span class="o">!</span><span class="n">LEDVal</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">sleep</span><span class="p">(</span><span class="mi">250</span><span class="p">);</span>
</span><span class='line'>        <span class="n">LEDVal</span> <span class="o">=</span> <span class="o">!</span><span class="n">LEDVal</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">setupLED</span><span class="p">(</span><span class="n">GPIO_InitTypeDef</span> <span class="o">*</span><span class="n">LED_InitStruct</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="cm">/* Setup LED GPIO */</span>
</span><span class='line'>    <span class="n">RCC_AHB1PeriphClockCmd</span><span class="p">(</span><span class="n">RCC_AHB1Periph_GPIOG</span><span class="p">,</span> <span class="n">ENABLE</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">GPIO_StructInit</span><span class="p">(</span><span class="n">LED_InitStruct</span><span class="p">);</span>
</span><span class='line'>    <span class="n">LED_InitStruct</span><span class="o">-&gt;</span><span class="n">GPIO_Pin</span>   <span class="o">=</span> <span class="n">GPIO_Pin_13</span> <span class="o">|</span> <span class="n">GPIO_Pin_14</span> <span class="p">;</span>
</span><span class='line'>    <span class="n">LED_InitStruct</span><span class="o">-&gt;</span><span class="n">GPIO_Mode</span>  <span class="o">=</span> <span class="n">GPIO_Mode_OUT</span><span class="p">;</span>
</span><span class='line'>    <span class="n">LED_InitStruct</span><span class="o">-&gt;</span><span class="n">GPIO_Speed</span> <span class="o">=</span> <span class="n">GPIO_Speed_2MHz</span><span class="p">;</span>
</span><span class='line'>    <span class="n">GPIO_Init</span><span class="p">(</span><span class="n">GPIOG</span><span class="p">,</span> <span class="n">LED_InitStruct</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="n">__IO</span> <span class="kt">uint32_t</span> <span class="n">g_timeToWakeUp</span><span class="p">;</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">sleep</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">nSec</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">g_timeToWakeUp</span> <span class="o">=</span> <span class="n">nSec</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* Busy waiting */</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="n">g_timeToWakeUp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* ISR for system tick */</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">SysTick_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">g_timeToWakeUp</span> <span class="o">!=</span> <span class="mh">0x00</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">g_timeToWakeUp</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Trap here for gdb if asserted */</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">assert_failed</span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span> <span class="n">file</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">line</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>比較有趣的是<code>int LEDVal = 0;</code>一定要宣告成<code>static</code>，否則LED完全沒反應。在網路上請教似乎和進出ISR的時候context備份有關係，這部份有空再找時間了解一下，這次先跳過。</p>

<ul>
<li>更新，後來測試不管是沒有<code>static</code>，把<code>static</code>改成<code>volatile</code>，都出現第一次燒錄行為不正常，多燒幾次又正常的情況。需要再重新釐清。</li>
</ul>


<p><a name="STM_LED_VERIFY"></a></p>

<h3>燒錄和測試</h3>

<ul>
<li>直接在工作目錄下執行make</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>STM32F429-Discovery-Disco-Pratice/labs/0_led$ make
</span><span class='line'>arm-none-eabi-gcc -c -DUSE_FULL_ASSERT -g3 -mthumb -mcpu=cortex-m4 -I. -I../../libraries/STM32F4xx_DSP_StdPeriph_Lib_V1.6.1/Libraries/STM32F4xx_StdPeriph_Driver/inc -I../../libraries/
</span><span class='line'>...
</span><span class='line'>arm-none-eabi-objcopy -Obinary ../../build/led.elf ../../build/led.bin
</span><span class='line'>arm-none-eabi-objdump -S ../../build/led.elf &gt; ../../build/led.list
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>燒錄指令如下</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>STM32F429-Discovery-Disco-Pratice/labs/0_led$ st-flash write ../../build/led.bin  0x8000000
</span><span class='line'>2016-07-25T11:31:28 INFO src/stlink-common.c: Loading device parameters....
</span><span class='line'>2016-07-25T11:31:28 INFO src/stlink-common.c: Device connected is: F42x and F43x device, id 0x10036419
</span><span class='line'>...
</span><span class='line'>enabling 32-bit flash writes
</span><span class='line'>size: 11596
</span><span class='line'>2016-07-25T11:31:28 INFO src/stlink-common.c: Starting verification of write complete
</span><span class='line'>2016-07-25T11:31:29 INFO src/stlink-common.c: Flash written and verified! jolly good!
</span></code></pre></td></tr></table></div></figure>


<p>以下是LED點亮結果</p>

<center><img src="/files/stm32/STM_LED.jpg"></img></center>


<p><a name="STM-SPL-REF"></a></p>

<h2>參考資料</h2>

<ul>
<li><a href="http://homes.soic.indiana.edu/geobrown/index.cgi/teaching">Geoffrey Brown: Teaching </a>

<ul>
<li>請找 Lab Manual 裏面的link, 書名是<code>Discovering the STM32 Microcontroller</code></li>
</ul>
</li>
<li><a href="http://www.st.com/content/st_com/en/products/evaluation-tools/product-evaluation-tools/mcu-eval-tools/stm32-mcu-eval-tools/stm32-mcu-discovery-kits/32f429idiscovery.html">STM32F4 Discovry Disco 開發版手冊</a></li>
<li><a href="http://www.st.com/content/st_com/en/products/embedded-software/mcus-embedded-software/stm32-embedded-software/stm32-standard-peripheral-libraries/stsw-stm32065.html">STM32F4 DSP and standard peripherals library</a></li>
<li><a href="http://regalis.com.pl/en/arm-cortex-stm32-gnulinux/">Programming ARM Cortex (STM32) under GNU/Linux</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/06/25/stm32-f4xx-standard-peripherals-libraryshou-ce-zheng-li/">ARM CM4 Pratice (1): STM32 F4xx Standard Peripherals Library手冊整理</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-06-25T14:03:46+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>2:03 pm</span></time>
        
           | <a href="/blog/2016/06/25/stm32-f4xx-standard-peripherals-libraryshou-ce-zheng-li/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2016/06/25/stm32-f4xx-standard-peripherals-libraryshou-ce-zheng-li/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>前言</h2>

<p>以前在寫作業的時候，從來沒有想過那些週邊到底怎麼使用，只大概印象和<a href="http://www.arm.com/products/processors/cortex-m/cortex-microcontroller-software-interface-standard.php">CMSIS</a>有關。後來想應該是要去了解到底這些廠商提供的函式庫在軟體開發中扮演了什麼樣的角色？因此花了時間整理如下。</p>

<p>在使用之前，請自行到<a href="http://www.st.com/content/st_com/en/products/embedded-software/mcus-embedded-software/stm32-embedded-software/stm32-standard-peripheral-libraries/stsw-stm32065.html">官方網站</a>下載STM32F4 DSP and standard peripherals library。</p>

<h2>目錄</h2>

<ul>
<li><a href="#AST-%E7%B0%A1%E4%BB%8B">簡介</a>

<ul>
<li><a href="#AST-CMSIS">CMSIS和Standard Peripherals Library說明</a></li>
</ul>
</li>
<li><a href="#AST-Rules">Coding rules and conventions</a>

<ul>
<li><a href="#AST-Rules-general">一般命名規則</a></li>
<li><a href="#AST-Rules-reg">週邊 Register 命名規則</a></li>
</ul>
</li>
<li><a href="#AST-Ref">參考資料</a></li>
</ul>


<p><a name="AST-簡介"></a></p>

<h2>簡介</h2>

<p>手冊上提到Standard Peripherals Library (以下簡稱SPL)的特點</p>

<ul>
<li>提供STM32F4 XX的週邊驅動程式和常用的資料結構</li>
<li>基於CMSIS開發</li>
<li>ANSI C開發</li>
<li>使用SPL表示週邊設備存取效能和佔用的記憶體空間是由SPL決定，因此有特別限制的話必須要自行最佳化或是實作</li>
</ul>


<p>SPL包含:</p>

<ul>
<li>週邊設備暫存器的位址mapping，包含這些暫存器的bit</li>
<li>所有週邊的控制function以及對應的資料結構</li>
<li>範例程式</li>
</ul>


<p><a name="AST-CMSIS"></a></p>

<h3>CMSIS和Standard Peripherals Library說明</h3>

<p>整體的架構圖如下(參考手冊資料）</p>

<center><img src="/files/stm32/SPL_Diag.jpg"></img></center>


<p>簡單說明如下</p>

<ul>
<li>CMSIS 提供了

<ul>
<li>統一的暫存器定義、位址定義</li>
<li>協助開發的函數</li>
<li>RTOS 介面</li>
<li>DSP 相關函數</li>
</ul>
</li>
<li>開發版上實體的週邊驅動程式是透過SPL和CMSIS來控制硬體</li>
</ul>


<p><a name="AST-Rules"></a></p>

<h2>Coding rules and conventions</h2>

<p><a name="AST-Rules-general"></a></p>

<h3>一般命名規則</h3>

<ul>
<li>函數名稱以<strong>大寫週邊簡寫</strong>為prefix如<code>USART_SendData</code></li>
<li>文件舉例的API，請自行望文生義

<ul>
<li><code>週邊名稱_Init</code></li>
<li><code>週邊名稱_DeInit</code></li>
<li><code>週邊名稱_StructInit</code></li>
<li><code>週邊名稱_Cmd</code></li>
<li><code>週邊名稱_ITConfig</code>

<ul>
<li>IT: interrupt</li>
</ul>
</li>
<li><code>週邊名稱_DMAConfig</code></li>
<li><code>週邊名稱_XXXConfig</code>

<ul>
<li>週邊設備的XXX設定</li>
</ul>
</li>
<li><code>週邊名稱_GetFlagStatus</code></li>
<li><code>週邊名稱_ClearFlag</code></li>
<li><code>週邊名稱_ClearITPendingBit</code></li>
</ul>
</li>
</ul>


<p><a name="AST-Rules-reg"></a></p>

<h3>週邊 Register 命名規則</h3>

<ul>
<li>週邊 Register 一律包裝在<code>struct</code>中，名稱一律為大寫。在 stm32f4xx.h 另外已經宣告了週邊設備位址的結構如：</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#define SPI1                  ((SPI_TypeDef *) SPI1_BASE)</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>SPI_TypeDef</code>為一個struct，因此你可以使用下面方式直接存取週邊設備暫存器。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">SPI1</span><span class="o">-&gt;</span><span class="n">CR1</span> <span class="o">=</span> <span class="mh">0x0001</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>有了大概概念後，接下來就是開幹時間，敬請期待。</p>

<p><a name="AST-Ref"></a></p>

<h2>參考資料</h2>

<ul>
<li><a href="http://www.st.com/content/st_com/en/products/embedded-software/mcus-embedded-software/stm32-embedded-software/stm32-standard-peripheral-libraries/stsw-stm32065.html">STM32F4 DSP and standard peripherals library</a>

<ul>
<li>本篇絕大部分參考解開套件後的stm32f4xx_dsp_stdperiph_lib_um.chm　這個文件檔案</li>
</ul>
</li>
<li><a href="http://www.st.com/content/st_com/en/products/embedded-software/mcus-embedded-software/stm32-embedded-software/stm32cube-embedded-software/stm32cubef4.html">STM32CubeF4網頁</a>

<ul>
<li>有SPL的相關資料</li>
</ul>
</li>
<li><a href="http://www.st.com/content/st_com/en/products/embedded-software/mcus-embedded-software/stm32-embedded-software/stm32-standard-peripheral-libraries/stsw-stm32062.html">STM32F2 standard peripherals library手冊</a>

<ul>
<li>交叉比對用</li>
</ul>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/04/10/use-strace-to-trace-missing-files/">使用strace找出程式缺少的檔案路徑</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-10T01:14:38+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>1:14 am</span></time>
        
           | <a href="/blog/2016/04/10/use-strace-to-trace-missing-files/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2016/04/10/use-strace-to-trace-missing-files/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>這算極短篇。在組裝別人軟體的時候，常常出現缺少檔案的錯誤，運氣不好的不會跟你說缺少的檔案的期待路徑；運氣更差的就會連錯誤都不印，直接程式crash。我後來知道strace之後，才發覺它可以結省很多印log和trace程式碼的時間。</p>

<p>這次就以前一篇執行openocd遇到的問題為例：第一次編譯openocd後，直接執行會出現找不到openocd.cfg檔案。經過一些試誤後才有上一篇整理出來的指令。</p>

<p>錯誤訊息如下</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ openocd 
</span><span class='line'>Open On-Chip Debugger 0.10.0-dev-00250-g9c37747 (2016-04-07-22:20)
</span><span class='line'>Licensed under GNU GPL v2
</span><span class='line'>For bug reports, read
</span><span class='line'>  http://openocd.org/doc/doxygen/bugs.html
</span><span class='line'>embedded:startup.tcl:60: Error: Can't find openocd.cfg
</span><span class='line'>in procedure 'script' 
</span><span class='line'>at file "embedded:startup.tcl", line 60
</span><span class='line'>Error: Debug Adapter has to be specified, see "interface" command
</span><span class='line'>embedded:startup.tcl:60: Error: 
</span><span class='line'>in procedure 'script' 
</span><span class='line'>at file "embedded:startup.tcl", line 60</span></code></pre></td></tr></table></div></figure>


<p>用strace 觀察輸出訊息如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ strace -f openocd 2&gt;&1  | grep cfg
</span><span class='line'>open("openocd.cfg", O_RDONLY)           = -1 ENOENT (No such file or directory)
</span><span class='line'>open("/home/asdf/.openocd/openocd.cfg", O_RDONLY) = -1 ENOENT (No such file or directory)
</span><span class='line'>open("/usr/local/share/openocd/site/openocd.cfg", O_RDONLY) = -1 ENOENT (No such file or directory)
</span><span class='line'>open("/usr/local/share/openocd/scripts/openocd.cfg", O_RDONLY) = -1 ENOENT (No such file or directory)
</span><span class='line'>write(2, "embedded:startup.tcl:60: Error: "..., 118embedded:startup.tcl:60: Error: Can't find openocd.cfg</span></code></pre></td></tr></table></div></figure>


<p>從輸出訊息可以知道，openocd會依下面的順序讀取openocd.cfg</p>

<ul>
<li>目前目錄的openocd.cfg</li>
<li>~/.openocd/openocd.cfg</li>
<li>/usr/local/share/openocd/site/openocd.cfg</li>
<li>/usr/local/share/openocd/scripts/openocd.cfg</li>
</ul>


<p>所以接下來就是在openocd的原始碼中挑和你開發target可以使用config 檔案，放入~/.openocd、改成openocd.cfg。當然事情沒那麼簡單，解掉這個問題接下來還會有一些缺少檔案的問題，一樣靠strace就可以搞定。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/04/06/arm-cm4-pratice-0-environment-setup/">ARM CM4 Pratice (0): Environment Setup</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-06T22:15:15+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:15 pm</span></time>
        
           | <a href="/blog/2016/04/06/arm-cm4-pratice-0-environment-setup/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2016/04/06/arm-cm4-pratice-0-environment-setup/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>很久以前買了<a href="http://www.st.com/web/catalog/tools/FM116/SC959/SS1532/PF259090">STM32F4 Disco的開發版</a>（<a href="http://wiki.csie.ncku.edu.tw/embedded/STM32F429">繁體中文資訊</a>），最近開始想要學習ARM架構和硬體控制等技術。在設定目標，規劃進度前，一定要先把編譯和燒錄環境架設起來，整理如下：</p>

<h2>目錄</h2>

<ul>
<li><a href="#cm4-0-env">安裝作業系統環境</a></li>
<li><a href="#cm4-0-steps">安裝步驟</a>

<ul>
<li><a href="#cm4-0-steps-tl">安裝Toolchain</a></li>
<li><a href="#cm4-0-steps-pkg-install">手動安裝燒錄和除錯工具</a>

<ul>
<li><a href="#cm4-0-steps-pkg-install-prepare">安裝需要套件</a></li>
<li><a href="#cm4-0-steps-pkg-install-stlink">手動安裝st-link</a></li>
<li><a href="#cm4-0-steps-pkg-install-openocd">手動安裝OpenOCD</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cm4-0-test">驗證燒錄</a>

<ul>
<li><a href="#cm4-0-test-prepare">事前準備</a></li>
<li><a href="#cm4-0-test-stflash">使用st-flash 開發版燒錄</a></li>
<li><a href="#cm4-0-test-openocd">使用openocd 開發版燒錄</a></li>
</ul>
</li>
<li><a href="#cm4-0-ref">參考資料</a></li>
</ul>


<p><a name="cm4-0-env"></a></p>

<h2>安裝作業系統環境</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.4 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty</span></code></pre></td></tr></table></div></figure>


<p><a name="cm4-0-steps"></a></p>

<h2>安裝步驟</h2>

<p>要開發非本機的平台，我們會需要安裝</p>

<ul>
<li>Toolchain：提供編譯，函數，分析binary等功能</li>
<li>燒錄軟體</li>
<li>除錯工具</li>
</ul>


<p>st-link和openocd同時有燒錄和開發版軟體除錯的功能，因此我們兩個都安裝。</p>

<p><a name="cm4-0-steps-tl"></a></p>

<h3>安裝Toolchain</h3>

<p>網路上找到<a href="https://launchpad.net/gcc-arm-embedded">GCC ARM Embedded (ARM R和M系列使用 )</a>的PPA。簡單找一下網路，<strong><font color="red">沒有直接證據說這邊的PPA是由ARM官方維護</font></strong>。不過在<a href="http://yottadocs.mbed.com/#installing-on-linux">mbed(ARM 成立的IoT作業系統)網站裏面</a>的確有提到這個PPA，暫時當作間接證據。<strong><font color="red">目前我還沒有驗證這個Toolchain編譯出來的binary是否可以在開發版上正常動作</font></strong>。</p>

<figure class='code'><figcaption><span>安裝Toolchain指令</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>sudo add-apt-repository ppa:team-gcc-arm-embedded/ppa
</span><span class='line'>sudo apt-get update
</span><span class='line'>sudo apt-get install gcc-arm-embedded
</span></code></pre></td></tr></table></div></figure>


<p><a name="cm4-0-steps-pkg-install"></a></p>

<h3>手動安裝燒錄和除錯工具</h3>

<p><a name="cm4-0-steps-pkg-install-prepare"></a></p>

<h4>安裝需要套件</h4>

<figure class='code'><figcaption><span>系統安裝設定STM32F4環境相關套件 </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>sudo apt-get install git
</span><span class='line'>sudo apt-get install libtool
</span><span class='line'>sudo apt-get install automake
</span><span class='line'>sudo apt-get install autoconf
</span><span class='line'>sudo apt-get install pkg-config
</span><span class='line'>sudo apt-get install libusb-1.0-0-dev
</span><span class='line'>sudo apt-get install libftdi-dev   # 當openocd要支援MPSSE mode才需要裝，這是啥我不知道。
</span><span class='line'>sudo apt-get install libhidapi-dev # 當openocd要支援CMSIS-DAP才會用到，這是啥我不知道。
</span></code></pre></td></tr></table></div></figure>


<p>我自己的習慣是非必要不會放在系統中，<strong>接下來的指令都是預設<code>st-link</code>和<code>openocd</code>裝到<code>$HOME/bin</code>中</strong>，Ubuntu在登入時會自動將<code>~/bin</code>加入<code>PATH</code>中。</p>

<p>如果您沒有~/bin的話，請使用下面指令建立。</p>

<figure class='code'><figcaption><span>系統安裝設定STM32F4環境相關套件 </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>mkdir ~/bin/
</span><span class='line'>. ~/.profile # 強迫系統自動將`~/bin`加入`PATH`中
</span></code></pre></td></tr></table></div></figure>


<p><a name="cm4-0-steps-pkg-install-stlink"></a></p>

<h4>手動安裝st-link</h4>

<p>簡單講一下，就是下載、編譯、安裝軟體。特別要注意的是，為了要讓你的PC在使用Mini USB連到開發版後能夠讓Ubuntu的<code>udev</code>服務可以順利地偵測到開發版，需要加入相關設定並重新啟動<code>udev</code>服務。</p>

<p>下載Source code</p>

<figure class='code'><figcaption><span>下載Source code  </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>git clone https://github.com/texane/stlink
</span></code></pre></td></tr></table></div></figure>


<p>編譯stlink</p>

<figure class='code'><figcaption><span>編譯</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>cd stlink/
</span><span class='line'>./autogen.sh
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>cp st-* ~/bin
</span></code></pre></td></tr></table></div></figure>


<p>設定並重新起動udev</p>

<figure class='code'><figcaption><span>設定並重新起動udev</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>sudo cp 49-stlinkv* /etc/udev/rules.d/ -rv
</span><span class='line'>sudo service udev restart
</span></code></pre></td></tr></table></div></figure>


<p>驗證一下是否可以偵測到開發版，請確定測試前開發版已經和您的電腦透過Mini USB連線，以及有設定<code>udev</code>並且重新啟動。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ st-probe
</span><span class='line'>Found 1 stlink programmers
</span><span class='line'>30303030303030303030303100
</span><span class='line'>   flash: 2097152 (pagesize: 16384)
</span><span class='line'>    sram: 262144
</span><span class='line'>  chipid: 0x0419
</span><span class='line'>   descr: F42x and F43x device
</span></code></pre></td></tr></table></div></figure>


<p><a name="cm4-0-steps-pkg-install-openocd"></a></p>

<h4>手動安裝OpenOCD</h4>

<p>下載Source code</p>

<figure class='code'><figcaption><span>下載Source code</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>git clone git://git.code.sf.net/p/openocd/code openocd-code
</span></code></pre></td></tr></table></div></figure>


<p>編譯</p>

<figure class='code'><figcaption><span>編譯</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>cd openocd-code/
</span><span class='line'>./bootstrap
</span><span class='line'>./configure # script會自動偵測系統是否有相依開發套件
</span><span class='line'>make
</span></code></pre></td></tr></table></div></figure>


<p>安裝</p>

<figure class='code'><figcaption><span>安裝</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>cp src/openocd ~/bin
</span><span class='line'>cp tcl/board/stm32f429discovery.cfg ~/.openocd/openocd.cfg
</span><span class='line'>cp tcl/* ~/.openocd
</span></code></pre></td></tr></table></div></figure>


<p>驗證一下是否可以偵測到開發版，請確定測試前開發版已經和您的電腦透過Mini USB連線。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ openocd
</span><span class='line'>Open On-Chip Debugger 0.10.0-dev-00250-g9c37747 (2016-04-07-22:20)
</span><span class='line'>Licensed under GNU GPL v2
</span><span class='line'>For bug reports, read
</span><span class='line'>  http://openocd.org/doc/doxygen/bugs.html
</span><span class='line'>Info : The selected transport took over low-level target control. The results might differ compared to plain JTAG/SWD
</span><span class='line'>adapter speed: 2000 kHz
</span><span class='line'>adapter_nsrst_delay: 100
</span><span class='line'>none separate
</span><span class='line'>srst_only separate srst_nogate srst_open_drain connect_deassert_srst
</span><span class='line'>Info : Unable to match requested speed 2000 kHz, using 1800 kHz
</span><span class='line'>Info : Unable to match requested speed 2000 kHz, using 1800 kHz
</span><span class='line'>Info : clock speed 1800 kHz
</span><span class='line'>Info : STLINK v2 JTAG v17 API v2 SWIM v0 VID 0x0483 PID 0x3748
</span><span class='line'>Info : using stlink api v2
</span><span class='line'>Info : Target voltage: 2.862887
</span><span class='line'>Info : stm32f4x.cpu: hardware has 6 breakpoints, 4 watchpoints
</span></code></pre></td></tr></table></div></figure>


<p><a name="cm4-0-test"></a></p>

<h2>驗證燒錄</h2>

<p><a name="cm4-0-test-parepare"></a></p>

<h3>事前準備</h3>

<p>下載jserv整理的STM 軔體</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>git clone https://github.com/jserv/stm32f429-demos
</span></code></pre></td></tr></table></div></figure>


<p>將source中的hex轉成binary</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>cd stm32f429-demos/
</span><span class='line'>make
</span></code></pre></td></tr></table></div></figure>


<p>使用下載提供的Makefile燒錄，裏面會先用openocd燒錄，失敗的話自動切到st-flash燒錄，非常建議讀一下Makefile。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>make flash-demo檔案
</span></code></pre></td></tr></table></div></figure>


<p>目前套件內蒐集的demo檔案</p>

<ul>
<li>flash-GamesInJava</li>
<li>flash-STM32F429I-DISCOVERY_Demo_V1.0.1</li>
<li>flash-Paint</li>
<li>flash-TouchGFX-demo2014</li>
<li>flash-STM32CubeDemo_STM32F429I-Discovery</li>
</ul>


<p><a name="cm4-0-test-stflash"></a></p>

<h3>使用st-flash 開發版燒錄</h3>

<ul>
<li><code>st-flash write 軔體binary檔案名稱 0x8000000</code></li>
</ul>


<p>為什麼是<code>0x800000</code>呢？可以查一下<a href="http://www.st.com/web/en/resource/technical/document/datasheet/DM00071990.pdf">手冊</a>，上面有說這塊記憶體是分配給flash memory。</p>

<p><a name="cm4-0-test-openocd"></a></p>

<h4>使用openocd 開發版燒錄</h4>

<p>從<a href="https://github.com/jserv/stm32f429-demos">GitHub: jserv/stm32f429-demos</a>裏面的Makefile抄來的。指令比較長，不過這是因為openocd可以把一系列的命令連發的關係</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>openocd -f interface/stlink-v2.cfg  -f target/stm32f4x.cfg  -c &quot;init&quot;  -c &quot;reset init&quot;  -c &quot;stm32f2x unlock 0&quot;  -c &quot;flash probe 0&quot;  -c &quot;flash info 0&quot;  -c &quot;flash write_image erase 軔體binary檔案名稱 0x8000000&quot;  -c &quot;reset run&quot; -c shutdown
</span></code></pre></td></tr></table></div></figure>


<p>使用比較好看的排版</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>openocd -f interface/stlink-v2.cfg  \
</span><span class='line'>        -f target/stm32f4x.cfg      \
</span><span class='line'>        -c &quot;init&quot;                   \
</span><span class='line'>        -c &quot;reset init&quot;             \
</span><span class='line'>        -c &quot;stm32f2x unlock 0&quot;      \
</span><span class='line'>        -c &quot;flash probe 0&quot;          \
</span><span class='line'>        -c &quot;flash info 0&quot;           \
</span><span class='line'>        -c &quot;flash write_image erase 軔體binary檔案名稱 0x8000000&quot; \
</span><span class='line'>        -c &quot;reset run&quot; -c shutdown
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h4>參數說明</h4>

<ul>
<li><code>-f</code>

<ul>
<li>指定config檔案。你可能會想問說interface目錄在那邊，還記得<a href="cm4-0-steps-pkg-install-openocd">前面</a>的動作嘛？</li>
<li>可以指定

<ul>
<li>interface: 除錯使用的介面</li>
<li>target: 執行的平台CPU如STM32F4</li>
<li>board: 開發版</li>
</ul>
</li>
</ul>
</li>
<li><code>-c</code>

<ul>
<li>執行openocd指令</li>
</ul>
</li>
</ul>


<h4>指令說明</h4>

<ul>
<li><code>-f interface/stlink-v2.cfg</code></li>
<li><code>-f target/stm32f4x.cfg</code></li>
<li><code>-c "init"</code>

<ul>
<li>結束config stage，開始進入run stage (<a href="http://openocd.org/doc/html/Daemon-Configuration.html#Entering-the-Run-Stage">出處</a>)</li>
</ul>
</li>
<li><code>-c "reset init"</code>

<ul>
<li>reset 開發版，重新開機(<a href="http://openocd.org/doc/html/General-Commands.html#Target-State-handling">出處</a>)後進入init狀態。</li>
</ul>
</li>
<li><code>-c "stm32f2x unlock 0"</code>

<ul>
<li>將開發版的flash解鎖(<a href="http://openocd.org/doc/html/Flash-Commands.html#Flash-Configuration-Commands">出處</a>)</li>
</ul>
</li>
<li><code>-c "flash probe 0"</code>

<ul>
<li>偵測開發版的flash(<a href="http://openocd.org/doc/html/Flash-Commands.html#Flash-Configuration-Commands">出處</a>)</li>
</ul>
</li>
<li><code>-c "flash info 0"</code>

<ul>
<li>顯示開發版的flash資訊(<a href="http://openocd.org/doc/html/Flash-Commands.html#Flash-Configuration-Commands">出處</a>)</li>
</ul>
</li>
<li><code>-c "flash write_image erase 軔體binary檔案名稱 0x8000000"</code>

<ul>
<li>將檔案寫入flash(<a href="http://openocd.org/doc/html/Flash-Commands.html#Flash-Configuration-Commands">出處</a>)</li>
</ul>
</li>
<li><code>-c "reset run" -c shutdown</code>

<ul>
<li>正常重新開機(<a href="http://openocd.org/doc/html/General-Commands.html#Target-State-handling">出處</a>)</li>
</ul>
</li>
</ul>


<p><a name="cm4-0-ref"></a></p>

<h2>參考資料</h2>

<ul>
<li><a href="http://yottadocs.mbed.com/#installing-on-linux">yotta Documentation: Install on Linux</a></li>
<li><a href="https://launchpad.net/gcc-arm-embedded">ARM Embedded PPA網站</a></li>
<li><a href="https://launchpad.net/~team-gcc-arm-embedded/+archive/ubuntu/ppa">GNU ARM Embedded Toolchain</a></li>
<li><a href="https://github.com/jserv/stm32f429-demos">GitHub: jserv/stm32f429-demos</a></li>
<li><a href="http://openocd.org/doc/html/">OpenOCD手冊</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/24/talk-more-about-git-remote/">再談 Git Remote</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-24T20:30:32+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:30 pm</span></time>
        
           | <a href="/blog/2016/01/24/talk-more-about-git-remote/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2016/01/24/talk-more-about-git-remote/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>更新：

<ul>
<li>Apr/09/2016：感謝網友柏瑀的告知，修正白字。</li>
</ul>
</li>
</ul>


<p>git remote 是一個常常被忽略的東西，這次就來看看這個指令和對應的觀念吧。</p>

<p>一樣，先講測試環境，避免無法reproduce的問題。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.3 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty
</span><span class='line'>
</span><span class='line'>$ git --version
</span><span class='line'>git version 2.7.0
</span></code></pre></td></tr></table></div></figure>


<p>本次介紹目錄如下</p>

<ul>
<li><a href="#gr_gb">背景說明</a></li>
<li><a href="#gr_cmd">git remote指令介紹</a>

<ul>
<li><a href="#gr_cmd_status">查詢remote資訊</a></li>
<li><a href="#gr_cmd_add">新增remote</a></li>
<li><a href="#gr_cmd_fetch">拉remote repository</a></li>
<li><a href="#gr_cmd_push">remote的branch操作</a></li>
<li><a href="#gr_cmd_rm">刪除remote</a></li>
</ul>
</li>
</ul>


<p><a name="gr_gb"></a></p>

<h2>背景說明</h2>

<p>先來問問男人<code>git remote</code>是什麼吧？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>GIT-REMOTE(1)                                     Git Manual                                    GIT-REMOTE(1)
</span><span class='line'>
</span><span class='line'>NAME
</span><span class='line'>       git-remote - Manage set of tracked repositories
</span></code></pre></td></tr></table></div></figure>


<p>白話來說，<code>git remote</code>是用來管理<font color="red">多個</font>tracked repositories。（中文難翻，意思是你要追蹤的git repository）。在大部分的情況，<code>git clone</code>下來後只需要和原本clone的遠端互動的話，你只有一個remote，那麼你機乎不會感受到remote的運作，我天生駑鈍，剛開始只是覺得奇怪怎麼有時候後會有個<code>origin</code>跑出來而已。</p>

<p>如果夠幸運（還是不幸？）你不太會需要遇到需要處理remote的情況。不過在github上面，倒是蠻有機會要用到remote，情境如下。</p>

<ul>
<li>你在github上面有帳號，要fork別人的project <code>A</code>，fork來的稱為<code>A+</code></li>
<li>你在<code>A+</code>開發，同時<code>A</code>也在開發</li>
<li><code>A+</code>有需要和<code>A</code>同步，也許是<code>A</code>有新功能，或是你要回饋程式碼總不能回饋和<code>A</code>差異太大的程式碼</li>
</ul>


<p><code>A+</code>和<code>A</code>同步，是remote常用的情境。常用到github直接給<a href="https://help.github.com/articles/configuring-a-remote-for-a-fork/">懶人包</a>。大概描述如下：</p>

<ul>
<li><code>A+</code>加一個remote，URL為<code>A</code>的URL。白話來說，就是<code>A+</code>要track repository <code>A</code>。

<ul>
<li>remote必須給個名字，github的<a href="https://help.github.com/articles/configuring-a-remote-for-a-fork/">懶人包</a>上給的名字叫upstream。</li>
</ul>
</li>
<li>既然加了一個tracked repository，你就可以做

<ul>
<li>拉remote程式碼下來</li>
<li>切換到remote下面的branch</li>
<li><strong>merge remote 的branch</strong></li>
</ul>
</li>
</ul>


<p><a name="gr_cmd"></a></p>

<h2>git remote指令介紹</h2>

<p>在介紹指令之前，先建立示範git repository 以便下面的說明。情境如下</p>

<ol>
<li>建立新的git repository，稱為<code>repo_1</code></li>
<li>clone <code>repo_1</code>到<code>repo_2</code></li>
<li>clone <code>repo_2</code>到<code>repo_3</code></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ git init repo_1
</span><span class='line'>Initialized empty Git repository in /tmp/test_remote/repo_1/.git/
</span><span class='line'>
</span><span class='line'>$ cd repo_1/
</span><span class='line'>/repo_1$ touch test_file &amp;&amp; git add test_file &amp;&amp; git commit -a -m &quot;init for test&quot;
</span><span class='line'>[master (root-commit) 6847c3c] init for test
</span><span class='line'> 1 file changed, 0 insertions(+), 0 deletions(-)
</span><span class='line'> create mode 100644 test_file
</span><span class='line'>
</span><span class='line'>$ cd ../
</span><span class='line'>
</span><span class='line'>$ git clone --bare repo_1 repo_2
</span><span class='line'>Cloning into bare repository &#39;repo_2&#39;...
</span><span class='line'>done.
</span><span class='line'>
</span><span class='line'>$ git clone repo_2/ repo_3
</span><span class='line'>Cloning into &#39;repo_3&#39;...
</span><span class='line'>done.
</span></code></pre></td></tr></table></div></figure>


<p>關於repo_2的&ndash;bare部份，一言難盡。長話短說，不這樣幹repo_3不能push到repo_2，有興趣可以看<a href="http://stackoverflow.com/questions/2816369/git-push-error-remote-rejected-master-master-branch-is-currently-checked">這邊</a>。</p>

<p>如果你的git repository是clone過來的，一定會有一個預設remote。沒意外的會叫<code>origin</code> <del>(什麼？你的remote叫<code>aosp</code>? 呃太複雜不討論)</del>，接下來你可以對於remote 操作，分別說明如下：</p>

<ul>
<li><a href="#gr_cmd_status">查詢remote資訊</a></li>
<li><a href="#gr_cmd_add">新增remote</a></li>
<li><a href="#gr_cmd_fetch">拉remote repository</a></li>
<li><a href="#gr_cmd_push">remote的branch操作</a></li>
<li><a href="#gr_cmd_rm">刪除remote</a></li>
</ul>


<p><a name="gr_cmd_status"></a></p>

<h2>查詢remote資訊</h2>

<ul>
<li><code>git remote</code>

<ul>
<li>顯示remote名稱</li>
</ul>
</li>
<li><code>git remote -v</code>

<ul>
<li>顯示remote名稱及remote URL</li>
</ul>
</li>
<li><code>git remote show remote名稱</code>

<ul>
<li>顯示<code>remote名稱</code>的詳細資訊</li>
</ul>
</li>
</ul>


<p>直接看範例</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ cd /tmp/test_remote/repo_3
</span><span class='line'>
</span><span class='line'>$ git remote
</span><span class='line'>origin
</span><span class='line'>
</span><span class='line'>$ git remote -v
</span><span class='line'>origin    /tmp/test_remote/repo_2/ (fetch)
</span><span class='line'>origin    /tmp/test_remote/repo_2/ (push)
</span><span class='line'>
</span><span class='line'>$ git remote show origin
</span><span class='line'>* remote origin
</span><span class='line'>  Fetch URL: /tmp/test_remote/repo_2/
</span><span class='line'>  Push  URL: /tmp/test_remote/repo_2/
</span><span class='line'>  HEAD branch: master
</span><span class='line'>  Remote branch:
</span><span class='line'>    master tracked
</span><span class='line'>  Local branch configured for &#39;git pull&#39;:
</span><span class='line'>    master merges with remote master
</span><span class='line'>  Local ref configured for &#39;git push&#39;:
</span><span class='line'>    master pushes to master (up to date)
</span></code></pre></td></tr></table></div></figure>


<p><a name="gr_cmd_add"></a></p>

<h2>新增remote</h2>

<ul>
<li><code>git add remote名稱 remote_repository_URL</code></li>
</ul>


<p>範例如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ git remote add upstream /tmp/test_remote/repo_1/
</span><span class='line'>
</span><span class='line'>$ git remote -v
</span><span class='line'>origin    /tmp/test_remote/repo_2/ (fetch)
</span><span class='line'>origin    /tmp/test_remote/repo_2/ (push)
</span><span class='line'>upstream  /tmp/test_remote/repo_1/ (fetch)
</span><span class='line'>upstream  /tmp/test_remote/repo_1/ (push)
</span></code></pre></td></tr></table></div></figure>


<p>新增完畢後，請記得<code>remote_名稱</code>、<code>remote_名稱 remote_branch_名稱</code>或<code>remote_名稱/remote_branch_名稱</code>是你要操作remote的參數。</p>

<p>另外你還可以加入多個remote來場大亂鬥。例如你從<code>A</code> fork <code>A+</code>，也許有人fork 出來的<code>A++</code>有你想要的功能，就可以再把<code>A++</code>加入你<code>A</code> repository的remote。</p>

<p><a name="gr_cmd_fetch"></a></p>

<h2>拉remote repository</h2>

<ul>
<li><code>git fetch remote_名稱</code></li>
<li><code>git pull remote_名稱/remote_branch_名稱</code></li>
</ul>


<p>我們先在<code>repo_1</code>開一個branch稱為<code>br1</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ cd /tmp/test_remote/repo_1/
</span><span class='line'>
</span><span class='line'>$ git checkout -b br1
</span><span class='line'>Switched to a new branch &#39;br1&#39;
</span><span class='line'>
</span><span class='line'>$ touch test_on_branch &amp;&amp; git add test_on_branch &amp;&amp; git commit test_on_branch -m &quot;test&quot;
</span><span class='line'>[br1 cc7222f] test
</span><span class='line'> 1 file changed, 0 insertions(+), 0 deletions(-)
</span><span class='line'> create mode 100644 test_on_branch
</span></code></pre></td></tr></table></div></figure>


<p>接下來就是範例時間</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ git fetch upstream
</span><span class='line'>From /tmp/test_remote/repo_1
</span><span class='line'> * [new branch]      br1        -&gt; upstream/br1
</span><span class='line'> * [new branch]      master     -&gt; upstream/master
</span><span class='line'>
</span><span class='line'>$ ls
</span><span class='line'>test_file
</span><span class='line'>
</span><span class='line'>$ git pull upstream br1
</span><span class='line'>From /tmp/test_remote/repo_1
</span><span class='line'> * branch            br1        -&gt; FETCH_HEAD
</span><span class='line'>Updating 6847c3c..cc7222f
</span><span class='line'>Fast-forward
</span><span class='line'> test_on_branch | 0
</span><span class='line'> 1 file changed, 0 insertions(+), 0 deletions(-)
</span><span class='line'> create mode 100644 test_on_branch
</span><span class='line'>
</span><span class='line'>$ ls
</span><span class='line'>test_file  test_on_branch
</span><span class='line'>
</span><span class='line'>$ git status
</span><span class='line'>On branch master
</span><span class='line'>Your branch is ahead of &#39;origin/master&#39; by 1 commit.
</span><span class='line'>  (use &quot;git push&quot; to publish your local commits)
</span><span class='line'>nothing to commit, working directory clean
</span></code></pre></td></tr></table></div></figure>


<p>注意最後的指令，因為我們pull了<code>upstream/br1</code>，所以local多了一個commit。因此訊息中有說你目前repository 比<code>origin/master</code>(你clone的remote/branch)多一個commit。你可以push回<code>origin/master</code>。</p>

<p><a name="gr_cmd_push"></a></p>

<h2>remote的branch操作</h2>

<p>原則就是命令中有參數會是<code>remote_名稱</code>、<code>remote_名稱 remote_branch_名稱</code>或<code>remote_名稱/remote_branch_名稱</code>。</p>

<ul>
<li>切換</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ git checkout upstream/br1
</span><span class='line'>Note: checking out &#39;upstream/br1&#39;.
</span><span class='line'>
</span><span class='line'>You are in &#39;detached HEAD&#39; state. You can look around, make experimental
</span><span class='line'>changes and commit them, and you can discard any commits you make in this
</span><span class='line'>state without impacting any branches by performing another checkout.
</span><span class='line'>
</span><span class='line'>If you want to create a new branch to retain commits you create, you may
</span><span class='line'>do so (now or later) by using -b with the checkout command again. Example:
</span><span class='line'>
</span><span class='line'>  git checkout -b &lt;new-branch-name&gt;
</span><span class='line'>
</span><span class='line'>HEAD is now at bd026e3... test
</span></code></pre></td></tr></table></div></figure>


<p>中間的一堆英文簡單來說是因為git checkout沒特別參數，git只是把HEAD指到命令中的hash而已。如果你要同時在local開一個branch，可以這樣幹：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ git checkout --track  upstream/br1
</span><span class='line'>Branch br1 set up to track remote branch br1 from upstream.
</span><span class='line'>Switched to a new branch &#39;br1&#39;
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>merge</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># 先在upstream/br1建立新的commit
</span><span class='line'>$ cd /tmp/test_remote/repo_1/
</span><span class='line'>
</span><span class='line'>$ touch test1_on_branch &amp;&amp; git add test1_on_branch &amp;&amp; git commit test1_on_branch -m &quot;test1&quot;
</span><span class='line'>[br1 d82612a] test1
</span><span class='line'> 1 file changed, 0 insertions(+), 0 deletions(-)
</span><span class='line'> create mode 100644 test1_on_branch
</span><span class='line'>
</span><span class='line'># 切回repo_3
</span><span class='line'>cd /tmp/test_remote/repo_3
</span><span class='line'>
</span><span class='line'># 先fetch
</span><span class='line'>$ git fetch upstream
</span><span class='line'>remote: Counting objects: 2, done.
</span><span class='line'>remote: Compressing objects: 100% (2/2), done.
</span><span class='line'>remote: Total 2 (delta 0), reused 0 (delta 0)
</span><span class='line'>Unpacking objects: 100% (2/2), done.
</span><span class='line'>From /tmp/test_remote/repo_1
</span><span class='line'>   bd026e3..d82612a  br1        -&gt; upstream/br1
</span><span class='line'>
</span><span class='line'># 再merge，事實上和git pull upstream br1 一樣效果（默）
</span><span class='line'>$ git merge upstream/br1
</span><span class='line'>Updating bd026e3..d82612a
</span><span class='line'>Fast-forward
</span><span class='line'> test1_on_branch | 0
</span><span class='line'> 1 file changed, 0 insertions(+), 0 deletions(-)
</span><span class='line'> create mode 100644 test1_on_branch
</span></code></pre></td></tr></table></div></figure>


<p><a name="gr_cmd_rm"></a></p>

<h2>刪除remote</h2>

<ul>
<li>git remote remove remote名稱</li>
</ul>


<p>範例如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ git remote remove upstream
</span><span class='line'>
</span><span class='line'>$ git remote -v
</span><span class='line'>origin    /tmp/test_remote/repo_2 (fetch)
</span><span class='line'>origin    /tmp/test_remote/repo_2 (push)
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/10/about-inline-asm/">關於GNU Inline Assembly</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-10T22:16:49+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:16 pm</span></time>
        
           | <a href="/blog/2015/12/10/about-inline-asm/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2015/12/10/about-inline-asm/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>以前稍微接觸過GNU Inline Assembly，對於那些奇怪的符號總是覺得匪夷所思。這次找時間把他整理一下。雖然釐清了一些觀念，不過卻產生更多的疑惑，也許以後有機會看到範例會慢慢有感覺吧。</p>

<h2>目錄</h2>

<ul>
<li><a href="#ia-preface">前言</a></li>
<li><a href="#ia-env">測試環境</a></li>
<li><a href="#ia-syntax">語法</a>

<ul>
<li><a href="#ia-output">Output operands</a></li>
<li><a href="#ia-input">Input operands</a></li>
<li><a href="#ia-clo-reg">Clobbered registers list</a></li>
<li><a href="#ia-constr">Constraints</a></li>
</ul>
</li>
<li><a href="#ia-ref">參考資料</a></li>
</ul>


<p><a name="ia-preface"></a></p>

<h2>前言</h2>

<p>我自己對於GNU Inline Assembly的看法。</p>

<ul>
<li>編譯器 夠聰明，所以暫存器分配可以安心交給編譯器處理。也就是說語法上面要處理這塊。</li>
<li>暫存器、變數有些資訊仍然要讓編譯器知道，讓編譯器產生object binary遵守這樣的規則，如

<ul>
<li>這個operand是一個暫存器</li>
<li>這個operand是一塊記憶體</li>
<li>這個operand是浮點常數</li>
<li>&hellip;</li>
</ul>
</li>
<li>不想讓編譯器幫你安排暫存器，而是在Inline Assembly指定暫存器的話，就要明確的列出來。讓編譯器知道這些暫存器有被改過資料，進而針對這些暫存器做適當的處理。</li>
</ul>


<p><a name="ia-env"></a></p>

<h2>測試環境</h2>

<p>我使用ARMv7為主的Banana Pi開發版加上Lubuntu 14.04作為測試環境。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.3 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty
</span><span class='line'>
</span><span class='line'>$ dmesg
</span><span class='line'>...
</span><span class='line'>[    0.000000] Linux version 3.4.90 (bananapi@lemaker) (gcc version 4.6.3 (Ubuntu/Linaro 4.6.3-1ubuntu5) ) #2 SMP PREEMPT Tue Aug 5 14:11:40 CST 2014
</span><span class='line'>[    0.000000] CPU: ARMv7 Processor [410fc074] revision 4 (ARMv7), cr=10c5387d
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>$ gcc -v
</span><span class='line'>...
</span><span class='line'>Target: arm-linux-gnueabihf
</span><span class='line'>...
</span><span class='line'>gcc version 4.8.4 (Ubuntu/Linaro 4.8.4-2ubuntu1~14.04) </span></code></pre></td></tr></table></div></figure>


<p><a name="ia-syntax"></a></p>

<h2>語法</h2>

<p>inline assembler關鍵字是<code>asm</code>，不過<code>__asm__</code>也可以使用(<a href="#ia_ps0">註</a>)。</p>

<p>根據目前(Dec/2015)的<a href="https://gcc.gnu.org/onlinedocs/gcc/index.html#Top">gcc手冊</a>，inline assembler有分為<code>basic</code>和<code>extended</code>兩種。雖然我使用的平台是gcc 4.8.4，而且gcc 4.8.5<a href="https://gcc.gnu.org/onlinedocs/gcc-4.8.5/gcc/index.html#Top">手冊</a>(官方網站上沒有4.8.4手冊)並沒有提到這個部份。但是目前<strong>語法上</strong>測試的確沒有問題，但是有些說明上面卻很難驗證是否可以套用到4.8.5上(例如最佳化的說明、需要注意常犯的錯誤)，請自行斟酌。</p>

<p>以下是整理自最新的手冊說明，請自行斟酌您使用的gcc版本是否有符合。</p>

<h3>Basic inline assembler</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="p">[</span> <span class="k">volatile</span> <span class="p">]</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;Assembler Template&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>以下是整理自最新(Dec/2015)的手冊說明節錄，請自行斟酌您使用的gcc版本是否有符合。</p>

<ul>
<li>basic inline assembler 預設就是volatile</li>
<li>基本上編譯器只是把引號內的東西抄錄，所以只要組譯器支援的語法，就可以寫入Assembler Template內</li>
<li>和extended inline assembler的差異

<ul>
<li>extended inline assembler 只允許在函數內使用</li>
<li>有<code>naked</code>屬性的函數必須使用basic inline assembler(見<a href="#ia_ps1">註解</a>)</li>
<li>basic inline assembler就是把template內的字串作為組合語言組譯。而<code>%</code>字元在extended inline assembler有特別意義，然而有些組合語言如x86中<code>%</code>是暫存器語法的一部份。以至於<code>%</code>字元要在extended inline assembler中改為<code>%%</code>才是真正的意思，舉個例子<code>%eax</code>-><code>%%eax</code></li>
</ul>
</li>
<li>有要使用C 語言的資料，使用extended inline assembler比較妥當</li>
<li>GCC 最佳化時是有可能把你的inline assembler幹掉或是和你想的不一樣，請注意</li>
<li>你不可以從一個<code>asm(..)</code>裏面跳到另外一個<code>asm(..)</code>的label</li>
</ul>


<p>最簡單的<del>廢話</del>範例如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">asm</span><span class="p">(</span><span class="s">&quot;nop&quot;</span><span class="p">);</span> <span class="cm">/* 啥事都不要做 */</span>
</span></code></pre></td></tr></table></div></figure>


<p>在沒有使用C 語言的變數下，就和一般的組合語言沒有差太多。
更複雜一點的例子可以看<a href="https://github.com/embedded2014/rtenv/blob/master/kernel.c#L10">rtenv</a>裏面的使用方式：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">size_t</span> <span class="nf">strlen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="kr">naked</span><span class="p">));</span>
</span><span class='line'><span class="kt">size_t</span> <span class="nf">strlen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&quot;    sub  r3, r0, #1            </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;strlen_loop:               </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;    ldrb r2, [r3, #1]!        </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;    cmp  r2, #0                </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   bne  strlen_loop        </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;    sub  r0, r3, r0            </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;    bx   lr                    </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="o">:::</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>要注意<code>__attribute__ ((naked));</code>是有意義的。這是為何這段範例沒有直接指名用到C 語言函式變數名稱的關鍵點。有興趣請看<a href="https://gcc.gnu.org/onlinedocs/gcc/ARM-Function-Attributes.html#ARM-Function-Attributes">這邊</a>，請直接找字串<code>naked</code>。</p>

<h3>Extended inline assembler</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="n">asm</span> <span class="p">[</span><span class="k">volatile</span><span class="p">]</span> <span class="p">(</span> <span class="nl">AssemblerTemplate</span>
</span><span class='line'>                    <span class="p">:</span> <span class="n">OutputOperands</span>   <span class="c1">// optional</span>
</span><span class='line'>                  <span class="p">[</span> <span class="o">:</span> <span class="n">InputOperands</span>    <span class="c1">// optional</span>
</span><span class='line'>                  <span class="p">[</span> <span class="o">:</span> <span class="n">Clobbers</span> <span class="p">]</span>       <span class="c1">// optional</span>
</span><span class='line'>                  <span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>Assembler Template基本上就是你要寫的組語加上 Inline Assembler 專用的符號。要注意的是，在編譯的過程中，你寫的inline assembler可能由於最佳化考慮不會被組譯。如果你確認你inline assembler一定要被組譯，請加上<code>volatile</code> keyword。</p>

<p>Assembler 專用的符號節錄如下：</p>

<table  style="width:100%">
    <tr>
        <th>符號</th>
        <th>說明</th>
    </tr>
    <tr>
        <td width=15%">%%</td>
        <td>單一%字元</td>
    </tr>
    <tr>
        <td>%{</td>
        <td>單一{字元</td>
    </tr>
    <tr>
        <td>%}</td>
        <td>單一}字元</td>
    </tr>
    <tr>
        <td>|{</td>
        <td>單一|字元</td>
    </tr>
    <tr>
        <td>%=</td>
        <td>只知道並驗證過會產生唯一的數字。用途部份看不懂，英文真是奧妙的東西啊。</td>
    </tr>
</table>


<p></p>

<p>AssemblerTemplate</p>

<p>由於<a href="#ia-preface">前言</a>提到的三項個人猜測，造成inline assembler要使用C 語言變數時語法會出現很多令人眼花撩亂的符號。</p>

<p>由於編譯器提供協助分配暫存器和記憶體，也就是說需要有對應的語法指定目前指令的operand是什麼。GCC 有兩種方式指定，分別是</p>

<ul>
<li>編號指定，從零開始編號</li>
<li>Symbolic name指定: GCC 3.1以後支援<a href="https://gcc.gnu.org/onlinedocs/gcc-4.8.5/gcc/Extended-Asm.html#Extended-Asm">出處</a></li>
</ul>


<p>分別給個範例讓各位感受一下</p>

<h4>編號指定，從零開始編號</h4>

<p>這邊<code>%0</code>, <code>%1</code>就是編號。後面operand可以看到就是指定變數、以及變數的限制。這邊簡單解釋一下<code>=</code>表示這是一個輸出、而<code>r</code>表示變數要放在暫存器中、<code>m</code>表示變數是放在記憶體中。有興趣比對編譯出來的binary反組譯時的組合語言請看<a href="#ia_ps2">這邊</a>。不過編號和指令中的operand似乎很隨意，我沒有看到特殊規範。只能交叉比對assembler template和input/output operands才能看出端倪。我猜更複雜的情況你還要比對反組譯出來的結果。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">var1</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">var2</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;mov %0, %1 </span><span class="se">\n</span><span class="s">  \</span>
</span><span class='line'><span class="s">         add %1, %0, $1&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">var1</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">var2</span><span class="p">),</span> <span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="o">:</span><span class="p">);</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;var1 = %d, var2 = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;ldr r5, %0 </span><span class="se">\n</span><span class="s">&quot;</span><span class="o">:</span>           <span class="o">:</span> <span class="s">&quot;m&quot;</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="o">:</span> <span class="s">&quot;r5&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;str r4, %0&quot;</span>   <span class="o">:</span> <span class="s">&quot;=m&quot;</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span><span class="o">:</span>          <span class="o">:</span> <span class="s">&quot;r4&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Symbolic name指定</h4>

<p>編號的缺點就是可讀性比較差，所以gcc 3.1出現使用symbolic name的方式。至於那一個比較好，看你自己習慣。</p>

<p>直接把上面的範例更改一下。<a href="https://gcc.gnu.org/onlinedocs/gcc-4.8.5/gcc/Extended-Asm.html#Extended-Asm">GCC 4.8.5手冊</a>上面說symbolic name隨便取，甚至和變數同名稱都可以，<strong>只要單一asm(&hellip;)內的 symbolic name不要重複就好</strong>。有興趣比對編譯出來的binary反組譯時的組合語言請看<a href="#ia_ps3">這邊</a>。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">var1</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">var2</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;mov %[my_var1], %[my_var2] </span><span class="se">\n</span><span class="s">  \</span>
</span><span class='line'><span class="s">         add %[my_var3], %[my_var4], $1&quot;</span> <span class="o">:</span>
</span><span class='line'>            <span class="p">[</span><span class="n">my_var1</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">var1</span><span class="p">),</span> <span class="p">[</span><span class="n">my_var3</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">var2</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>            <span class="p">[</span><span class="n">my_var2</span><span class="p">]</span> <span class="s">&quot;r&quot;</span>  <span class="p">(</span><span class="n">var2</span><span class="p">),</span> <span class="p">[</span><span class="n">my_var4</span><span class="p">]</span> <span class="s">&quot;r&quot;</span>  <span class="p">(</span><span class="n">var1</span><span class="p">)</span> <span class="o">:</span><span class="p">);</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;var1 = %d, var2 = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;ldr r5, %[my_var1] </span><span class="se">\n</span><span class="s">&quot;</span><span class="o">::</span> <span class="p">[</span><span class="n">my_var1</span><span class="p">]</span> <span class="s">&quot;m&quot;</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="o">:</span> <span class="s">&quot;r5&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;str r4, %[my_var1]&quot;</span><span class="o">:</span> <span class="p">[</span><span class="n">my_var1</span><span class="p">]</span> <span class="s">&quot;=m&quot;</span> <span class="p">(</span><span class="n">var2</span><span class="p">)</span><span class="o">::</span> <span class="s">&quot;r4&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>接下來來看每個欄位吧。</p>

<p><a name="ia-output"></a></p>

<h4>Output operands</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">[</span> <span class="p">[</span><span class="n">asmSymbolicName</span><span class="p">]</span> <span class="p">]</span> <span class="n">constraint</span> <span class="p">(</span><span class="n">cvariablename</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>[asmSymbolicName]</code> 是GCC 3.1以後支援語法，如前所述，不用Symbolic Name就用編號方式對應assembler template operand。</p>

<p>指定結果要存在C 語言中的那個變數。要注意的除了要設定對的資訊（constraints，<a href="#ia-constr">下面</a>會節錄) 以外，operand的prefix一定要是<code>=</code>或<code>+</code>這兩個constraint。</p>

<p>隨便舉幾個範例</p>

<ul>
<li><code>=r(var1)</code>：變數請寫入並放在暫存器中</li>
<li><code>=m(var1)</code>：變數請寫入並存到記憶體中</li>
</ul>


<p><a name="ia-input"></a></p>

<h4>Input operands</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">[</span> <span class="p">[</span><span class="n">asmSymbolicName</span><span class="p">]</span> <span class="p">]</span> <span class="n">constraint</span> <span class="p">(</span><span class="n">cvariablename</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>[asmSymbolicName]</code> 是GCC 3.1以後支援語法，如前所述，不用Symbolic Name就用編號方式對應assembler template operand。</p>

<p>指定要從在C 語言中的那個變數取出資料。主要是要設定對的資訊（constraints，<a href="#ia-constr">下面</a>會節錄) 。</p>

<ul>
<li><code>r(var1)</code>：變數請放在暫存器中</li>
<li><code>m(var1)</code>：變數是在記憶體中</li>
</ul>


<p><a name="ia-clo-reg"></a></p>

<h4>Clobbered registers list</h4>

<p>先講結論，在<code>asm("語法")</code>中明確地指定暫存器名稱的話，要在這邊列出。</p>

<p>現在我會習慣查單字。<code>Clobbered</code>查英文單字會發現就是把東西用力地砸毀。所以翻譯成中文就是「砸爛的暫存器列表」。什麼是爛掉的暫存器？就是本節前面的結論囉。</p>

<p>另外從Dec/2015的gcc 手冊還有找到下面<a href="https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html#Clobbers">語法</a>，一樣請注意版本問題</p>

<table  style="width:100%">
    <tr>
        <th>符號</th>
        <th>說明</th>
    </tr>
    <tr>
        <td width="15%">&#8220;cc&#8221;</td>
        <td>和狀態有關的flag暫存器會被修改</td>
    </tr>
    <tr>
        <td>&#8220;memory&#8221;</td>
        <td>這段組合語言會讀寫列出operand以外的記憶體內容，因此編譯器會視情況備份暫存器或讀寫記憶體</td>
    </tr>
</table>


<p><a name="ia-constr"></a></p>

<h3>Constraints</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;</span><span class="n">Constraints</span><span class="o">&gt;</span>       <span class="o">::=</span> <span class="o">&lt;</span><span class="n">Constraint</span> <span class="n">Modifier</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">Other</span> <span class="n">Constraints</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">Other</span> <span class="n">Constraints</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">Other</span> <span class="n">Constraints</span><span class="o">&gt;</span> <span class="o">::=</span> <span class="o">&lt;</span><span class="n">Simple</span> <span class="n">Constraints</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">Machine</span> <span class="n">Constraints</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="cm">/* 以上BNF是我整理的，terminal symbol請自行看手冊 */</span>
</span></code></pre></td></tr></table></div></figure>


<p>節錄整理我<del>看得懂</del>感興趣的部份。</p>

<h5>Simple Constraints</h5>

<table  style="width:100%">
    <tr>
        <th>符號</th>
        <th>說明</th>
    </tr>
    <tr>
        <td width="15%">空白字元</td>
        <td>會被忽略，排版用</td>
    </tr>
    <tr>
        <td>m</td>
        <td>operand 存放在記憶體中</td>
    </tr>
    <tr>
        <td>r</td>
        <td>operand 將被放在暫存器中</td>
    </tr>
    <tr>
        <td>i</td>
        <td>operand 是一個整數常數，該常數包含下面的情形(symbolic name)：`#define MAX_LINE (32)`</td>
    </tr>
    <tr>
        <td>n</td>
        <td>operand 是一個整數常數，只允許填入數字</td>
    </tr>
    <tr>
        <td>E</td>
        <td>operand 是一個浮點數常數，不清楚和`F`的差異</td>
    </tr>
    <tr>
        <td>F</td>
        <td>operand 是一個浮點數常數，不清楚和`E`的差異</td>
    </tr>
    <tr>
        <td>g</td>
        <td>operand 存在暫存器(r)或是記憶體內(m)，或是這是一個整數常數</td>
    </tr>    
    <tr>
        <td>X</td>
        <td>不用檢查operand</td>
    </tr>
</table>


<p>　　</p>

<p>你可以使用組合技如<code>"rim"</code>，如果這樣寫的話，意思是要編譯器幫你挑一個最適合的方式處理對應於assembler template內的operand。
　　</p>

<h5>Constraint Modifier</h5>

<table  style="width:100%">
    <tr>
        <th>符號</th>
        <th>說明</th>
    </tr>
    <tr>
        <td width="15%">=</td>
        <td>表示這是一個write only的operand，必須為contraint開始字元。</td>
    </tr>
    <tr>
        <td>+</td>
        <td>表示這個 operand 在指令中是同時被讀寫的，必須為contraint開始字元。</td>
    </tr>
    <tr>
        <td>&</td>
        <td>該operand 為earlyclobber。earlyclobber就是在instruction讀取該operand前，該operand會被寫入。雖然如此，到底是多久前？是和data hazard有關嘛？還是跟資料一致性有關？或者是和編譯器 最佳化造成非預期結果有關？真是一團謎<font color="red">完全搞不懂做啥用，也不清楚使用時機。</font><a href="http://lxr.free-electrons.com/source/arch/arm/include/asm/uaccess.h#L364">這邊有範例</a>，一樣搞不懂為什麼要有+, &的modifier</td>
    </tr>
    <tr>
        <td>%</td>
        <td>該operand 可以讓編譯器 決定這個operand是否和後面的operand交換(commutative)，<font color="red">完全搞不懂做啥用</font></td>
    </tr>
</table>


<p>　　</p>

<h5>ARM 專用的Constraint</h5>

<p>我參考的是gcc 4.8.5手冊(因為和測試環境的gcc版本最接近)，可能有版本的問題，這些我都沒有做實驗測試，請自行斟酌。</p>

<table  style="width:100%">
    <tr>
        <th>符號</th>
        <th>說明(一般模式)</th>
    </tr>
    <tr>
        <td width="20%">w</td>
        <td width="80%">VFP 浮點運算</td>
    </tr>
    <tr>
        <td>G</td>
        <td>浮點運算的0.0</td>
    </tr>
    <tr>
        <td>I</td>
        <td>8 bit正整數</td>
    </tr>
    <tr>
        <td>K</td>
        <td>I contraint 的invert (一的補數)，Wen: 不知道為什麼要扯到I constraint？</td>
    </tr>
    <tr>
        <td>L</td>
        <td>I contraint 的負數 (二的補數)，Wen: 不知道為什麼要扯到I constraint？</td>
    </tr>
    <tr>
        <td>M</td>
        <td>0 ~ 32的正整數</td>
    </tr>
    <tr>
        <td>Q</td>
        <td>要參考的記憶體位址存放在一個暫存器內</td>
    </tr>
    <tr>
        <td>R</td>
        <td>operand是一個const pool內的東西，不要問我const pool是啥，估狗到都和Java有關</td>
    </tr>
    <tr>
        <td>S</td>
        <td>operand 目前檔案中.text內的一個symbol</td>
    </tr>
    <tr>
        <td>Uv</td>
        <td>VFP load/store 指令可存取的記憶體</td>
    </tr>
    <tr>
        <td>Uy</td>
        <td>iWMMXt load/store 指令可存取的記憶體</td>
    </tr>
    <tr>
        <td>Uq</td>
        <td>ARMv4 ldrsb 指令可存取的記憶體</td>
    </tr>
</table>


<p></p>

<p>完整列表在這邊，要注意的是2015年12月的手冊又多了一些新的contstraint。請自行參考。</p>

<ul>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-4.8.5/gcc/Machine-Constraints.html#Machine-Constraints">gcc 4.8.5: Constraints for Particular Machines</a>

<ul>
<li>請自行參考你的硬體平台</li>
</ul>
</li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/Machine-Constraints.html#Machine-Constraints">Dec/2015手冊: 6.44.4.4 Constraints for Particular Machines</a></li>
</ul>


<p><a name="ia-ref"></a></p>

<h2>參考資料</h2>

<ul>
<li>中文

<ul>
<li><a href="http://www.study-area.org/cyril/opentools/opentools/x969.html">(BIG5)用Open Source工具開發軟體: 新軟體開發關念: Chapter 4. GNU Compiler Collection</a>

<ul>
<li>題外話，寫這位文件的作者個人非常佩服，但是網路上似乎關於這位作者只有這份文件。真是神祕的人物</li>
</ul>
</li>
<li><a href="http://nano-chicken.blogspot.tw/2010/12/inline-assembly.html">Nano雞排: Inline Assembly</a></li>
</ul>
</li>
<li>英文

<ul>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/Using-Assembly-Language-with-C.html#Using-Assembly-Language-with-C">gcc: How to Use Inline Assembly Language in C Code</a>

<ul>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/index.html#Top">手冊</a>上寫是給<code>gcc 6.0</code>，我目前從GGG release網站上看到<a href="https://gcc.gnu.org/releases.html">最新版本</a>是5.3，怪。</li>
<li>為什麼列出這個，因為我原本找的gcc-4.8.5 對於assembler template說明沒有特別列出gcc 支援的inline assembler符號。另外這份的文件結構的確比4.8.5清楚。</li>
</ul>
</li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-4.8.5/gcc/Extended-Asm.html#Extended-Asm">gcc-4.8.5: Assembler Instructions with C Expression Operands</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-4.8.5/gcc/Constraints.html#Constraints">gcc-4.8.5: Constraints for asm Operands</a></li>
<li><a href="http://www.ethernut.de/en/documents/arm-inline-asm.html">ARM GCC Inline Assembler Cookbook</a>

<ul>
<li>相當推荐，不論是給的說明和範例，更厲害的是關於contraint部份寫的比手冊清楚，一樣我沒測過就是了。</li>
</ul>
</li>
<li><a href="http://ericw.ca/notes/a-tiny-guide-to-gcc-inline-assembly.html">A Tiny Guide to GCC Inline Assembly</a></li>
<li><a href="https://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html">GCC-Inline-Assembly-HOWTO</a></li>
<li><a href="http://wiki.osdev.org/Inline_Assembly">OSDev: Inline Assembly</a></li>
<li><a href="http://asm.sourceforge.net/articles/rmiyagi-inline-asm.txt">Introduction to GCC inline assembler</a>

<ul>
<li>似乎有點古老。</li>
</ul>
</li>
</ul>
</li>
</ul>


<h2>附錄</h2>

<p><a name="ia_ps0"></a></p>

<ul>
<li>C 語言標準有提到編譯器可以使用<code>asm</code> keyword，而且沒有定義語法。有興趣可以找<code>C11</code>、<code>C99</code>、<code>C89</code>的標準，直接搜尋<code>asm</code>就可以看到了。</li>
</ul>


<hr />

<p><a name="ia_ps1"></a></p>

<ul>
<li><code>naked</code>使用basic inline assembler和extended inline assembler比較</li>
</ul>


<p>下面兩個函數，<code>strcmp1</code>沒有任何extended inline assembler而<code>strcmp2</code>硬塞了一個下去：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">strcmp1</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="kr">naked</span><span class="p">));</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">strcmp1</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&quot;strcmp_lop1:                </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   ldrb    r2, [r0],#1     </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   ldrb    r3, [r1],#1     </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   cmp     r2, #1          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   it      hi              </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   cmphi   r2, r3          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   beq     strcmp_lop1      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;    sub     r0, r2, r3      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   bx      lr              </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="o">:::</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">strcmp2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="kr">naked</span><span class="p">));</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">strcmp2</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&quot;strcmp_lop2:                </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   ldrb    r2, [r0],#1     </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   ldrb    r3, [r1],#1     </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   cmp     r2, #1          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   it      hi              </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   cmphi   r2, r3          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   mov     %1, $1 </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   beq     strcmp_lop2      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;    sub     r0, r2, r3      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   bx      lr              </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="o">:</span><span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">::</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>我們可以比較一下下面兩個函數最後編譯出來的指令，<code>strcmp2</code>顯然和我們預期的差很多。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mf">000083f</span><span class="mi">4</span> <span class="o">&lt;</span><span class="n">strcmp1</span><span class="o">&gt;:</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">strcmp1</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="kr">naked</span><span class="p">));</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">strcmp1</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span>
</span><span class='line'>    <span class="mf">83f</span><span class="mi">4</span><span class="o">:</span>  <span class="n">f810</span> <span class="mi">2</span><span class="n">b01</span>     <span class="n">ldrb</span><span class="p">.</span><span class="n">w</span> <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r0</span><span class="p">],</span> <span class="err">#</span><span class="mi">1</span>
</span><span class='line'>    <span class="mf">83f</span><span class="mi">8</span><span class="o">:</span>  <span class="n">f811</span> <span class="mi">3</span><span class="n">b01</span>     <span class="n">ldrb</span><span class="p">.</span><span class="n">w</span> <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r1</span><span class="p">],</span> <span class="err">#</span><span class="mi">1</span>
</span><span class='line'>    <span class="mf">83f</span><span class="nl">c</span><span class="p">:</span>  <span class="mi">2</span><span class="n">a01</span>         <span class="n">cmp</span>  <span class="n">r2</span><span class="p">,</span> <span class="err">#</span><span class="mi">1</span>
</span><span class='line'>    <span class="mf">83f</span><span class="nl">e</span><span class="p">:</span>  <span class="n">bf88</span>         <span class="n">it</span>   <span class="n">hi</span>
</span><span class='line'>    <span class="mi">8400</span><span class="o">:</span>  <span class="mi">429</span><span class="n">a</span>         <span class="n">cmphi</span>    <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>    <span class="mi">8402</span><span class="o">:</span>  <span class="n">d0f7</span>         <span class="n">beq</span><span class="p">.</span><span class="n">n</span>  <span class="mf">83f</span><span class="mi">4</span> <span class="o">&lt;</span><span class="n">strcmp1</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="mi">8404</span><span class="o">:</span>  <span class="n">eba2</span> <span class="mo">0003</span>    <span class="n">sub</span><span class="p">.</span><span class="n">w</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>    <span class="mi">8408</span><span class="o">:</span>  <span class="mi">4770</span>        <span class="n">bx</span>   <span class="n">lr</span>
</span><span class='line'>        <span class="s">&quot;   beq     strcmp_lop1      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;    sub     r0, r2, r3      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   bx      lr              </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="o">:::</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>    <span class="mi">840</span><span class="nl">a</span><span class="p">:</span>  <span class="mi">4618</span>        <span class="n">mov</span>  <span class="n">r0</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>
</span><span class='line'><span class="mo">0000</span><span class="mi">840</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">strcmp2</span><span class="o">&gt;:</span>
</span><span class='line'>        <span class="s">&quot;   beq     strcmp_lop2      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;    sub     r0, r2, r3      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="s">&quot;   bx      lr              </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>        <span class="o">:</span><span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">::</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p><a name="ia_ps2"></a></p>

<ul>
<li>範例一的反組譯節錄</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">objdump</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">S</span> <span class="n">asm</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="mf">000083f</span><span class="mi">4</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">var1</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</span><span class='line'>    <span class="mf">83f</span><span class="nl">a</span><span class="p">:</span>  <span class="mi">230</span><span class="n">c</span>         <span class="n">movs</span> <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">12</span>
</span><span class='line'>    <span class="mf">83f</span><span class="nl">c</span><span class="p">:</span>  <span class="mi">603</span><span class="n">b</span>         <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="n">var2</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="mf">83f</span><span class="nl">e</span><span class="p">:</span>  <span class="mi">230</span><span class="n">a</span>         <span class="n">movs</span> <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">10</span>
</span><span class='line'>    <span class="mi">8400</span><span class="o">:</span>  <span class="mi">607</span><span class="n">b</span>         <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;mov %0, %1 </span><span class="se">\n</span><span class="s">  \</span>
</span><span class='line'><span class="s">         add %1, %0, $1&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">var1</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">var2</span><span class="p">),</span> <span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="o">:</span><span class="p">);</span>
</span><span class='line'>    <span class="mi">8402</span><span class="o">:</span>  <span class="mi">687</span><span class="n">b</span>         <span class="n">ldr</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'>    <span class="mi">8404</span><span class="o">:</span>  <span class="mi">683</span><span class="n">a</span>         <span class="n">ldr</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="mi">8406</span><span class="o">:</span>  <span class="mi">461</span><span class="n">a</span>         <span class="n">mov</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>    <span class="mi">8408</span><span class="o">:</span>  <span class="n">f102</span> <span class="mo">0301</span>    <span class="n">add</span><span class="p">.</span><span class="n">w</span>  <span class="n">r3</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="err">#</span><span class="mi">1</span>
</span><span class='line'>    <span class="mi">840</span><span class="nl">c</span><span class="p">:</span>  <span class="mi">603</span><span class="n">a</span>         <span class="n">str</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="mi">840</span><span class="nl">e</span><span class="p">:</span>  <span class="mi">607</span><span class="n">b</span>         <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;ldr r5, %0 </span><span class="se">\n</span><span class="s">&quot;</span><span class="o">:</span>           <span class="o">:</span> <span class="s">&quot;m&quot;</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="o">:</span> <span class="s">&quot;r5&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="mi">8424</span><span class="o">:</span>  <span class="mi">683</span><span class="n">d</span>         <span class="n">ldr</span>  <span class="n">r5</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;str r4, %0&quot;</span>   <span class="o">:</span> <span class="s">&quot;=m&quot;</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span><span class="o">:</span>          <span class="o">:</span> <span class="s">&quot;r4&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="mi">8426</span><span class="o">:</span>  <span class="mi">607</span><span class="n">c</span>         <span class="n">str</span>  <span class="n">r4</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p><a name="ia_ps3"></a></p>

<ul>
<li>範例二的反組譯節錄</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">objdump</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">S</span> <span class="n">asm</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="mf">000083f</span><span class="mi">4</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">var1</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</span><span class='line'>    <span class="mf">83f</span><span class="nl">a</span><span class="p">:</span>  <span class="mi">230</span><span class="n">c</span>         <span class="n">movs</span> <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">12</span>
</span><span class='line'>    <span class="mf">83f</span><span class="nl">c</span><span class="p">:</span>  <span class="mi">603</span><span class="n">b</span>         <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="n">var2</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="mf">83f</span><span class="nl">e</span><span class="p">:</span>  <span class="mi">230</span><span class="n">a</span>         <span class="n">movs</span> <span class="n">r3</span><span class="p">,</span> <span class="err">#</span><span class="mi">10</span>
</span><span class='line'>    <span class="mi">8400</span><span class="o">:</span>  <span class="mi">607</span><span class="n">b</span>         <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;mov %[my_var1], %[my_var2] </span><span class="se">\n</span><span class="s">  \</span>
</span><span class='line'><span class="s">         add %[my_var3], %[my_var4], $1&quot;</span> <span class="o">:</span>
</span><span class='line'>            <span class="p">[</span><span class="n">my_var1</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">var1</span><span class="p">),</span> <span class="p">[</span><span class="n">my_var3</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">var2</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>            <span class="p">[</span><span class="n">my_var2</span><span class="p">]</span> <span class="s">&quot;r&quot;</span>  <span class="p">(</span><span class="n">var2</span><span class="p">),</span> <span class="p">[</span><span class="n">my_var4</span><span class="p">]</span> <span class="s">&quot;r&quot;</span>  <span class="p">(</span><span class="n">var1</span><span class="p">)</span> <span class="o">:</span><span class="p">);</span>
</span><span class='line'>    <span class="mi">8402</span><span class="o">:</span>  <span class="mi">687</span><span class="n">b</span>         <span class="n">ldr</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'>    <span class="mi">8404</span><span class="o">:</span>  <span class="mi">683</span><span class="n">a</span>         <span class="n">ldr</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="mi">8406</span><span class="o">:</span>  <span class="mi">461</span><span class="n">a</span>         <span class="n">mov</span>  <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span>
</span><span class='line'>    <span class="mi">8408</span><span class="o">:</span>  <span class="n">f102</span> <span class="mo">0301</span>    <span class="n">add</span><span class="p">.</span><span class="n">w</span>  <span class="n">r3</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="err">#</span><span class="mi">1</span>
</span><span class='line'>    <span class="mi">840</span><span class="nl">c</span><span class="p">:</span>  <span class="mi">603</span><span class="n">a</span>         <span class="n">str</span>  <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>    <span class="mi">840</span><span class="nl">e</span><span class="p">:</span>  <span class="mi">607</span><span class="n">b</span>         <span class="n">str</span>  <span class="n">r3</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;ldr r5, %[my_var1] </span><span class="se">\n</span><span class="s">&quot;</span><span class="o">::</span> <span class="p">[</span><span class="n">my_var1</span><span class="p">]</span> <span class="s">&quot;m&quot;</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span><span class="o">:</span> <span class="s">&quot;r5&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="mi">8424</span><span class="o">:</span>  <span class="mi">683</span><span class="n">d</span>         <span class="n">ldr</span>  <span class="n">r5</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">asm</span><span class="p">(</span><span class="s">&quot;str r4, %[my_var1]&quot;</span><span class="o">:</span> <span class="p">[</span><span class="n">my_var1</span><span class="p">]</span> <span class="s">&quot;=m&quot;</span> <span class="p">(</span><span class="n">var2</span><span class="p">)</span><span class="o">::</span> <span class="s">&quot;r4&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="mi">8426</span><span class="o">:</span>  <span class="mi">607</span><span class="n">c</span>         <span class="n">str</span>  <span class="n">r4</span><span class="p">,</span> <span class="p">[</span><span class="n">r7</span><span class="p">,</span> <span class="err">#</span><span class="mi">4</span><span class="p">]</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/03/bananapi-she-ding-wu-xian-wang-lu/">在Banana Pi設定WPA2-PSK無線網路</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-03T20:50:34+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>8:50 pm</span></time>
        
           | <a href="/blog/2015/12/03/bananapi-she-ding-wu-xian-wang-lu/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2015/12/03/bananapi-she-ding-wu-xian-wang-lu/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Banana Pi是一套ARMv7為處理器的開發版。一般來說照官方網頁把IMAGE燒到SD卡，外接鍵盤、滑鼠、HDMI螢幕，再通電即可透過GUI設定網路。</p>

<p>由於手上沒有任何外接設備，只有USB轉RS232線和USB WiFi。因此我只能在這樣的設備上設定網路，設定完成後就可以透過ssh server從外面連進去版子了。</p>

<p>照例先描述環境</p>

<p>HOST端</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.3 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty
</span><span class='line'>
</span><span class='line'>$ minicom --version
</span><span class='line'>minicom version 2.7 (compiled Jan  1 2014)
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>設備端，假設你已經將系統燒入到SD卡中</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.3 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>接上TTY</h2>

<p>首先你要有一條RS232轉USB的設備，上頭有TX/RX/GND/VCC，VCC在這邊用不到。
<img src="/files/banana_pi/DSC_0026.jpg" title="RS232轉USB線"></p>

<p>版子上面其實已經幫你把腳位標示好了，上面有TX/RX和GND如下：
<img src="/files/banana_pi/DSC_0030.jpg" title="Banana Pi RS232接腳"></p>

<p>剩下的就是把線路接起來。由於版子已經裝上外框，我有用鑷子協助連接線路。
<img src="/files/banana_pi/DSC_0024.jpg" title="接上訊號線"></p>

<p>線路接完後，將USB接上你的HOST，檢查下面幾項</p>

<ul>
<li>下<code>dmesg</code>確認HOST找到<code>/dev/ttyUSBn</code>（n為0開始的正整數）</li>
<li>確認你的終端機（我用minicom）設備指定<code>/dev/ttyUSBn</code>（n為0開始的正整數）</li>
<li>確認你的終端機（我用minicom）參數為115200 BPS，8N1，軟體硬體流量控制關閉</li>
</ul>


<p>開啟你的終端機軟體，然後版子通電。當終端機畫面進入提示符號，請輸入帳號密碼。Banana Pi有預設的帳號密碼請自行上網查詢。</p>

<h2>設定無線網路</h2>

<p>Ubuntu 是透過<code>/etc/network/interface</code>去設定網路介面。這邊我們可以分成兩個部份討論</p>

<h3>設定無線網路介面</h3>

<p>首先你要下<code>ifconfig -a</code>看看你的無線網路介面名稱是什麼。我這邊是<code>wlan2</code>，為什麼不是<code>wlan0</code>，不要問我。</p>

<p>接下來就是修改<code>/etc/network/interface</code>，先貼上我網路參考的部份</p>

<figure class='code'><figcaption><span>/etc/network/interface</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>auto wlan2
</span><span class='line'>
</span><span class='line'>allow-hotplug wlan2
</span><span class='line'>iface wlan2 inet dhcp
</span><span class='line'>wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf
</span></code></pre></td></tr></table></div></figure>


<p>大概解釋一下</p>

<ul>
<li><code>auto</code>：<code>ifup</code>指令有<code>-a</code>參數會把有<code>auto</code>的網路介面全部bring up (bring up請自行估狗)</li>
<li><code>allow-hotplug</code>：當kernel偵測到該網路介面被接上會自動bring up該網路介面，<a href="https://www.debian.org/doc/manuals/debian-reference/ch05.en.html">出處</a></li>
<li><code>iface wlan2 inet dhcp</code>：指定網路介面<code>wlan2</code>使用<code>TCP/IP</code>，動態分配IP</li>
<li><code>wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</code>：找不到最原始出處，網路上就算是<a href="https://wiki.debian.org/WiFi/HowToUse">Debian官方文件</a>也直接拿來用而已，<code>man -K wpa-conf</code>也找不到。不過字面上不太難猜，就是指定wpa 會吃的config檔案路徑。</li>
</ul>


<h3>設定無線網路連線</h3>

<p>前面有看到設定wpa的config檔案，接下來就來設定吧。我這邊是沒有該config檔，所以要自己新增一個。基本上就是設定SSID，密碼，加密方式，以及說明是否你要連的AP是否沒有broadcast SSID等。這邊我只是<a href="https://coderwall.com/p/v290ta/raspberry-pi-wifi-setup-with-wpa2-psk-aes">參考這邊</a>，有興趣的人可以自行鑽研。</p>

<figure class='code'><figcaption><span>/etc/wpa_supplicant/wpa_supplicant.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
</span><span class='line'>update_config=1
</span><span class='line'>
</span><span class='line'>network={
</span><span class='line'>ssid=&quot;AP的SSID&quot;
</span><span class='line'>scan_ssid=1 # 如果你的AP 是沒有broadcast SSID就要加這個
</span><span class='line'>psk=&quot;你的AP 密碼(passphase)&quot;
</span><span class='line'>proto=RSN
</span><span class='line'>key_mgmt=WPA-PSK
</span><span class='line'>pairwise=CCMP
</span><span class='line'>auth_alg=OPEN
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>設定完畢確認連線正常、有安裝sshd後，剩下就透過ssh操作版子了。祝好運！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/29/notes-of-lao-jie-li-mian-gong-fa-pian/">空間母語 - 老街立面工法篇</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-29T00:11:13+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:11 am</span></time>
        
           | <a href="/blog/2015/11/29/notes-of-lao-jie-li-mian-gong-fa-pian/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2015/11/29/notes-of-lao-jie-li-mian-gong-fa-pian/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>以下為課程筆記，我沒有專業能力判斷是否有誤解，請自行斟酌。</p>

<ul>
<li>街屋立面產生原因

<ul>
<li>新建物</li>
<li>街道拓寬舊的建築物被切掉</li>
</ul>
</li>
<li>人造石材質卷草工法

<ul>
<li>開模</li>
<li>泥塑(堆花）</li>
</ul>
</li>
<li><a href="https://zh.wikipedia.org/zh-tw/%E4%B8%89%E8%A7%92%E7%AA%97">三角窗</a>有一段時期流行將轉角切成三等份。範例如下：</li>
</ul>


<iframe src="https://www.google.com/maps/embed?pb=!1m0!3m2!1sen!2stw!4v1448805405994!6m8!1m7!1snHu2mYfzaDlINYr4ESvzIA!2m2!1d25.05902974020674!2d121.512159091819!3f128.17169937491852!4f29.63316041627023!5f0.7820865974627469" width="600" height="450" frameborder="0" style="border:0" allowfullscreen></iframe>


<ul>
<li>日治時代唯二允許的廟會 (待查證）

<ul>
<li>北港朝天宮</li>
<li>霞海城隍廟</li>
</ul>
</li>
<li>大溪老街和大稻埕以及葉金塗宅是同一批團隊建造的。

<ul>
<li>陳旺來、陳三川兄弟</li>
</ul>
</li>
<li>由於日治時期和之前台灣石材缺乏，因此使用人造石頻率高於日本。</li>
<li>人造石材料來源

<ul>
<li>宜蘭石，天然碎石，圓潤無稜角</li>
<li>大理石震碎</li>
</ul>
</li>
<li>葉宅新砌磚和舊的差別可從磚頭之間收縫粗細判斷</li>
<li>以前的建築計費方式是按實際工作日計工錢，所以耗工時可以慢工出細活。然而現在是一份工程一筆費用，也就是說如果可以愈快完成，那麼就可以把資訊空出來接下一筆工程，因此慢工出細活反而是違反利潤的事情。</li>
<li>角木（不知道是啥，似乎屋頂疊瓦和樓層都有用到）</li>
<li>建築物裝修目的

<ul>
<li>防災</li>
<li>保護結構</li>
<li>舒適度考量</li>
<li>美觀</li>
</ul>
</li>
<li>建物裝修工法

<ul>
<li>泥塑(堆花）下面兩種原料

<ul>
<li>水泥</li>
<li>灰泥(比較不耐久）

<ul>
<li>白灰、稻殼混合</li>
</ul>
</li>
</ul>
</li>
<li>剪黏

<ul>
<li>使用灰泥以及鐵絲（後期使用不繡鋼線，銅線（銅線沒記是否後期））塑形，再使用瓦片黏上</li>
<li>使用瓷片、後來也有人有嘗試使用壓克力和玻璃</li>
<li>現代有量產版本，有外型成品如龍，匠師只要把瓷片黏上成品即完成</li>
<li>早期瓷片是從真的碗取出，後來有單純剪黏用瓷碗。主要差別是剪黏用瓷碗不需要立起來，所以碗面和桌面接觸，確保力起來那個部份就不用做了</li>
</ul>
</li>
<li>交趾陶</li>
<li>人造石

<ul>
<li>做廟的團隊和做街屋的團隊可以是同一批</li>
<li>立面山牆背面其實，你知道的</li>
<li>洗石子

<ul>
<li>將細石和水泥還有其他塗料混合後，塗上平面，待快乾時使用水沖洗平面，露出石頭部份</li>
<li>工法

<ul>
<li>平面</li>
<li>泥塑</li>
<li>開模</li>
</ul>
</li>
</ul>
</li>
<li>斬石子

<ul>
<li>將細石和水泥還有其他塗料混合後，塗上平面，待快乾時使用斬刀依工法塗抹平面，塑造不同石材的質感。</li>
</ul>
</li>
<li>磨石子</li>
</ul>
</li>
</ul>
</li>
</ul>


<h2>其他</h2>

<ul>
<li>左官職人：日本泥水匠稱呼，日本的泥塑是由左官職人負責。台灣的剪黏師傅很多也包辦泥塑部份。</li>
<li>丁蘭尺：陰宅使用</li>
<li>門公尺：住家使用</li>
<li>何金龍：佳里金唐殿</li>
<li>蘇陽水：交趾陶</li>
<li>洪坤福：大龍峒保安宮</li>
<li>李重耀：維修過戰後總統府建築師</li>
<li>中和圓通寺大象</li>
<li>郭德蘭：泥塑匠師，郭三川之子</li>
<li><a href="https://zh.wikipedia.org/zh-tw/%E5%9C%8B%E5%88%86%E7%9B%B4%E4%B8%80">國分直一</a></li>
<li>桃園有圓頂加泥塑的建築，一個在大溪建成商行一個在桃園市，待查詢</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/16/tan-tan-strip/">談談strip</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-16T21:32:23+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:32 pm</span></time>
        
           | <a href="/blog/2015/11/16/tan-tan-strip/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2015/11/16/tan-tan-strip/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Strip，顧名思義，就是脫脫。有興趣的紳士可以估狗strip club。那麼在Linux的binutil中strip是要脫什麼呢？先來問一下男人</p>

<figure class='code'><figcaption><span>man strip</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>STRIP(1)                                    GNU Development Tools                                    STRIP(1)
</span><span class='line'>
</span><span class='line'>NAME
</span><span class='line'>       strip - Discard symbols from object files.
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>用中文說，就是從object 檔中把symbol丟掉。讓我們做幾個小實驗吧。</p>

<ul>
<li><a href="#strip_test1">測試一：Strip 執行檔</a></li>
<li><a href="#strip_test2">測試二：Strip Object檔</a></li>
<li><a href="#strip_test3">測試三：Strip debug 資訊</a></li>
<li><a href="#strip_test4">測試四：Strip shared library</a></li>
</ul>


<h2>測試環境</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ lsb_release -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.3 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty
</span></code></pre></td></tr></table></div></figure>


<h2>測試程式</h2>

<figure class='code'><figcaption><span>main_test.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="k">extern</span> <span class="nf">test</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">test</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>test.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">char</span> <span class="o">*</span><span class="n">g_myStr</span> <span class="o">=</span> <span class="s">&quot;Wen&quot;</span><span class="p">;</span>
</span><span class='line'><span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">gp_myStr</span> <span class="o">=</span> <span class="s">&quot;Liao&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">s_test</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">g_myStr</span><span class="p">,</span> <span class="n">gp_myStr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">test</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello &quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">s_test</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Makefile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">TARGET</span><span class="o">=</span><span class="nb">test</span>
</span><span class='line'><span class="nv">SRCS</span><span class="o">=</span>test.c main_test.c
</span><span class='line'><span class="nv">OBJS</span><span class="o">=</span><span class="k">$(</span>patsubst  %.c, %.o, <span class="k">$(</span>SRCS<span class="k">))</span>
</span><span class='line'><span class="nv">CFLAGS</span><span class="o">=</span>-g
</span><span class='line'>
</span><span class='line'><span class="nf">$(TARGET)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span>
</span><span class='line'>  <span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="nv">$^</span> -o <span class="nv">$@</span>
</span><span class='line'>
</span><span class='line'><span class="nf">clean</span><span class="o">:</span>
</span><span class='line'>  rm -rf <span class="k">$(</span>TARGET<span class="k">)</span> <span class="k">$(</span>OBJS<span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><a name="strip_test1"></a></p>

<h2>測試一：Strip 執行檔</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ make clean
</span><span class='line'>rm -rf test  test.o  main_test.o
</span><span class='line'>
</span><span class='line'>$ make
</span><span class='line'>cc -g   -c -o test.o test.c
</span><span class='line'>cc -g   -c -o main_test.o main_test.c
</span><span class='line'>cc -g test.o main_test.o -o test
</span><span class='line'>
</span><span class='line'>$ ./test
</span><span class='line'>Hello Wen Liao
</span><span class='line'>
</span><span class='line'>$ ls test -gG
</span><span class='line'>-rwxrwxr-x 1 10217 Nov 16 22:33 test
</span></code></pre></td></tr></table></div></figure>


<p>可以看到產生出來的執行檔有<code>10217</code> bytes。我們進一步來看執行檔的symbol。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ nm test
</span><span class='line'>0000000000601050 B __bss_start
</span><span class='line'>...
</span><span class='line'>0000000000601040 D g_myStr
</span><span class='line'>00000000004003e0 T _init
</span><span class='line'>...
</span><span class='line'>0000000000601048 d gp_myStr
</span><span class='line'>...
</span><span class='line'>000000000040056d T main
</span><span class='line'>                 U printf@@GLIBC_2.2.5
</span><span class='line'>...
</span><span class='line'>000000000040052d t s_test
</span><span class='line'>0000000000400553 T test
</span><span class='line'>0000000000601050 D __TMC_END__
</span></code></pre></td></tr></table></div></figure>


<p>那麼來看看strip後的檔案size和symbol吧。你可以看到size變小而且symbol不見了。另外上面可以比對一下<code>t</code>、<code>T</code>、<code>d</code>、<code>D</code>和<code>s_test</code>、<code>test</code>、<code>gp_myStr</code>、<code>g_myStr</code>的關係。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ strip test
</span><span class='line'>
</span><span class='line'>$ ./test
</span><span class='line'>Hello Wen Liao
</span><span class='line'>
</span><span class='line'>$ nm test
</span><span class='line'>nm: test: no symbols
</span><span class='line'>
</span><span class='line'>$ ls -gG test
</span><span class='line'>-rwxrwxr-x 1 6296 Nov 16 22:36 test
</span></code></pre></td></tr></table></div></figure>


<p><a name="strip_test2"></a></p>

<h2>測試二：Strip Object檔</h2>

<p>因為strip就是把object file (執行檔也是一種object file)的symbol拿掉，所以在link time需要symbol時如果該object檔案被strip過，就會發生錯誤。範例如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ make clean
</span><span class='line'>rm -rf test  test.o  main_test.o
</span><span class='line'>
</span><span class='line'>$ make
</span><span class='line'>cc -g   -c -o test.o test.c
</span><span class='line'>cc -g   -c -o main_test.o main_test.c
</span><span class='line'>cc -g test.o main_test.o -o test
</span><span class='line'>
</span><span class='line'>$ nm -a test.o
</span><span class='line'>0000000000000000 b .bss
</span><span class='line'>0000000000000000 n .comment
</span><span class='line'>0000000000000000 d .data
</span><span class='line'>0000000000000000 N .debug_abbrev
</span><span class='line'>0000000000000000 N .debug_aranges
</span><span class='line'>0000000000000000 N .debug_info
</span><span class='line'>0000000000000000 N .debug_line
</span><span class='line'>0000000000000000 N .debug_str
</span><span class='line'>0000000000000000 r .eh_frame
</span><span class='line'>0000000000000000 D g_myStr
</span><span class='line'>0000000000000008 d gp_myStr
</span><span class='line'>0000000000000000 n .note.GNU-stack
</span><span class='line'>                 U printf
</span><span class='line'>0000000000000000 r .rodata
</span><span class='line'>0000000000000000 t s_test
</span><span class='line'>0000000000000026 T test
</span><span class='line'>0000000000000000 a test.c
</span><span class='line'>0000000000000000 t .text
</span><span class='line'>
</span><span class='line'>$ ls -gG test.o
</span><span class='line'>-rw-rw-r-- 1 3944 Nov 16 23:02 test.o
</span><span class='line'>
</span><span class='line'>$ strip test.o
</span><span class='line'>
</span><span class='line'>$ ls -gG test.o
</span><span class='line'>-rw-rw-r-- 1 952 Nov 16 23:03 test.o
</span><span class='line'>
</span><span class='line'>$ nm test.o
</span><span class='line'>nm: test.o: no symbols
</span><span class='line'>
</span><span class='line'>$ make
</span><span class='line'>cc -g test.o main_test.o -o test
</span><span class='line'>/usr/bin/ld: error in test.o(.eh_frame); no .eh_frame_hdr table will be created.
</span><span class='line'>main_test.o: In function `main&#39;:
</span><span class='line'>/home/wen/tmp/sandbox/main_test.c:6: undefined reference to `test&#39;
</span><span class='line'>collect2: error: ld returned 1 exit status
</span><span class='line'>make: *** [test] Error 1
</span></code></pre></td></tr></table></div></figure>


<p>這邊我<code>nm</code>下了<code>-a</code>參數，這會顯示出<strong>所有的symbol</strong>，預設的<code>nm</code>輸出如下提供比較。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ nm test.o
</span><span class='line'>0000000000000000 D g_myStr
</span><span class='line'>0000000000000008 d gp_myStr
</span><span class='line'>                 U printf
</span><span class='line'>0000000000000000 t s_test
</span><span class='line'>0000000000000026 T test
</span></code></pre></td></tr></table></div></figure>


<p><a name="strip_test3"></a></p>

<h2>測試三：Strip debug 資訊</h2>

<p>其實只是單純要介紹<code>-d</code>參數而已</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ make clean
</span><span class='line'>rm -rf test  test.o  main_test.o
</span><span class='line'>
</span><span class='line'>$ ls -gG test.o
</span><span class='line'>-rw-rw-r-- 1 3944 Nov 16 23:02 test.o
</span><span class='line'>
</span><span class='line'>$ make
</span><span class='line'>cc -g   -c -o test.o test.c
</span><span class='line'>cc -g   -c -o main_test.o main_test.c
</span><span class='line'>cc -g test.o main_test.o -o test
</span><span class='line'>
</span><span class='line'>$ ls -gG test.o
</span><span class='line'>-rw-rw-r-- 1 3944 Nov 16 23:02 test.o
</span><span class='line'>
</span><span class='line'>$ strip -d test.o
</span><span class='line'>
</span><span class='line'>$ nm -a test.o
</span><span class='line'>0000000000000000 b .bss
</span><span class='line'>0000000000000000 n .comment
</span><span class='line'>0000000000000000 d .data
</span><span class='line'>0000000000000000 r .eh_frame
</span><span class='line'>0000000000000000 D g_myStr
</span><span class='line'>0000000000000008 d gp_myStr
</span><span class='line'>0000000000000000 n .note.GNU-stack
</span><span class='line'>                 U printf
</span><span class='line'>0000000000000000 r .rodata
</span><span class='line'>0000000000000000 t s_test
</span><span class='line'>0000000000000026 T test
</span><span class='line'>0000000000000000 t .text
</span><span class='line'>
</span><span class='line'>$ make
</span><span class='line'>cc -g test.o main_test.o -o test
</span><span class='line'>
</span><span class='line'>$ ./test
</span><span class='line'>Hello Wen Liao
</span><span class='line'>
</span><span class='line'>$ ls -gG test test.o
</span><span class='line'>-rwxrwxr-x 1 9737 Nov 16 23:01 test
</span><span class='line'>-rw-rw-r-- 1 1896 Nov 16 23:01 test.o
</span></code></pre></td></tr></table></div></figure>


<p><a name="strip_test4"></a></p>

<h2>測試四：Strip shared library</h2>

<p>這邊要幹的第一件事是修改Makefile如下。主要是把test.o包裝成shared library，這個Makefile很醜，我知道。</p>

<figure class='code'><figcaption><span>Makefile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='Makefile'><span class='line'><span class="nv">TARGET</span><span class="o">=</span><span class="nb">test</span>
</span><span class='line'><span class="nv">SRC</span><span class="o">=</span>main_test.c
</span><span class='line'><span class="nv">OBJ</span><span class="o">=</span><span class="k">$(</span>patsubst  %.c, %.o, <span class="k">$(</span>SRC<span class="k">))</span>
</span><span class='line'>
</span><span class='line'><span class="nv">LIB_SRC</span><span class="o">=</span>test.c
</span><span class='line'><span class="nv">LIB_OBJ</span><span class="o">=</span><span class="k">$(</span>patsubst  %.c, %.o, <span class="k">$(</span>LIB_SRC<span class="k">))</span>
</span><span class='line'><span class="nv">LIB_NAME</span><span class="o">=</span><span class="nb">test</span>
</span><span class='line'><span class="nv">LIB</span><span class="o">=</span>lib<span class="k">$(</span>LIB_NAME<span class="k">)</span>.so
</span><span class='line'><span class="nv">CFLAGS</span><span class="o">=</span>-g
</span><span class='line'>
</span><span class='line'><span class="nf">$(TARGET)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJ</span><span class="k">)</span> <span class="k">$(</span><span class="nv">LIB</span><span class="k">)</span>
</span><span class='line'>  <span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="nv">$&lt;</span> -o <span class="nv">$@</span> -L./ -l<span class="k">$(</span>LIB_NAME<span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="nf">$(LIB)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">LIB_OBJ</span><span class="k">)</span>
</span><span class='line'>  <span class="k">$(</span>CC<span class="k">)</span> -shared -Wl,-soname,<span class="k">$(</span>LIB<span class="k">)</span>.0 <span class="nv">$^</span> -o <span class="nv">$@</span>
</span><span class='line'>  rm <span class="k">$(</span>LIB<span class="k">)</span>.0 <span class="o">&amp;&amp;</span> ln -sf <span class="k">$(</span>LIB<span class="k">)</span> <span class="k">$(</span>LIB<span class="k">)</span>.0
</span><span class='line'>
</span><span class='line'><span class="nf">$(LIB_OBJ)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">LIB_SRC</span><span class="k">)</span>
</span><span class='line'>  <span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> -c -fPIC <span class="nv">$^</span>
</span><span class='line'>
</span><span class='line'><span class="nf">clean</span><span class="o">:</span>
</span><span class='line'>  rm -rf <span class="k">$(</span>TARGET<span class="k">)</span> <span class="k">$(</span>OBJ<span class="k">)</span> <span class="k">$(</span>LIB_OBJ<span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>自幹shared library執行程式的時候不要忘記加上<code>LD_LIBRARY_PATH</code>環境變數：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ make clean
</span><span class='line'>rm -rf test  main_test.o  test.o
</span><span class='line'>
</span><span class='line'>$ make
</span><span class='line'>cc -g   -c -o main_test.o main_test.c
</span><span class='line'>cc -g -c -fPIC test.c
</span><span class='line'>cc -shared -Wl,-soname,libtest.so.0 test.o -o libtest.so
</span><span class='line'>rm libtest.so.0 &amp;&amp; ln -sf libtest.so libtest.so.0
</span><span class='line'>cc -g main_test.o -o test -L./ -ltest
</span><span class='line'>
</span><span class='line'>$ LD_LIBRARY_PATH=`pwd` ./test
</span><span class='line'>Hello Wen Liao
</span></code></pre></td></tr></table></div></figure>


<p>現在來比較strip前後的shared library 差異吧。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ nm -a libtest.so
</span><span class='line'>0000000000000000 a
</span><span class='line'>0000000000201048 b .bss
</span><span class='line'>0000000000201048 B __bss_start
</span><span class='line'>0000000000000000 n .comment
</span><span class='line'>0000000000201048 b completed.6973
</span><span class='line'>0000000000000000 a crtstuff.c
</span><span class='line'>0000000000000000 a crtstuff.c
</span><span class='line'>                 w __cxa_finalize@@GLIBC_2.2.5
</span><span class='line'>0000000000201030 d .data
</span><span class='line'>0000000000000000 N .debug_abbrev
</span><span class='line'>0000000000000000 N .debug_aranges
</span><span class='line'>0000000000000000 N .debug_info
</span><span class='line'>0000000000000000 N .debug_line
</span><span class='line'>0000000000000000 N .debug_str
</span><span class='line'>0000000000000650 t deregister_tm_clones
</span><span class='line'>00000000000006c0 t __do_global_dtors_aux
</span><span class='line'>0000000000200df0 t __do_global_dtors_aux_fini_array_entry
</span><span class='line'>0000000000201030 d __dso_handle
</span><span class='line'>0000000000200e00 d .dynamic
</span><span class='line'>0000000000200e00 d _DYNAMIC
</span><span class='line'>0000000000000398 r .dynstr
</span><span class='line'>0000000000000230 r .dynsym
</span><span class='line'>0000000000201048 D _edata
</span><span class='line'>00000000000007c0 r .eh_frame
</span><span class='line'>000000000000079c r .eh_frame_hdr
</span><span class='line'>0000000000201050 B _end
</span><span class='line'>000000000000077c T _fini
</span><span class='line'>000000000000077c t .fini
</span><span class='line'>0000000000200df0 t .fini_array
</span><span class='line'>0000000000000700 t frame_dummy
</span><span class='line'>0000000000200de8 t __frame_dummy_init_array_entry
</span><span class='line'>0000000000000840 r __FRAME_END__
</span><span class='line'>0000000000201000 d _GLOBAL_OFFSET_TABLE_
</span><span class='line'>                 w __gmon_start__
</span><span class='line'>0000000000201038 D g_myStr
</span><span class='line'>00000000000001f0 r .gnu.hash
</span><span class='line'>000000000000045c r .gnu.version
</span><span class='line'>0000000000000480 r .gnu.version_r
</span><span class='line'>0000000000200fd0 d .got
</span><span class='line'>0000000000201000 d .got.plt
</span><span class='line'>0000000000201040 d gp_myStr
</span><span class='line'>00000000000005f0 T _init
</span><span class='line'>00000000000005f0 t .init
</span><span class='line'>0000000000200de8 t .init_array
</span><span class='line'>                 w _ITM_deregisterTMCloneTable
</span><span class='line'>                 w _ITM_registerTMCloneTable
</span><span class='line'>0000000000200df8 d .jcr
</span><span class='line'>0000000000200df8 d __JCR_END__
</span><span class='line'>0000000000200df8 d __JCR_LIST__
</span><span class='line'>                 w _Jv_RegisterClasses
</span><span class='line'>00000000000001c8 r .note.gnu.build-id
</span><span class='line'>0000000000000610 t .plt
</span><span class='line'>                 U printf@@GLIBC_2.2.5
</span><span class='line'>0000000000000680 t register_tm_clones
</span><span class='line'>00000000000004a0 r .rela.dyn
</span><span class='line'>00000000000005a8 r .rela.plt
</span><span class='line'>0000000000000785 r .rodata
</span><span class='line'>0000000000000735 t s_test
</span><span class='line'>0000000000000760 T test
</span><span class='line'>0000000000000000 a test.c
</span><span class='line'>0000000000000650 t .text
</span><span class='line'>0000000000201048 d __TMC_END__
</span><span class='line'>
</span><span class='line'>$ ls -gG libtest.so
</span><span class='line'>-rwxrwxr-x 1 9275 Nov 16 23:47 libtest.so
</span><span class='line'>
</span><span class='line'>$ strip libtest.so
</span><span class='line'>
</span><span class='line'>$ ls -gG libtest.so
</span><span class='line'>-rwxrwxr-x 1 6104 Nov 16 23:47 libtest.so
</span><span class='line'>
</span><span class='line'>$ nm -a libtest.so
</span><span class='line'>nm: libtest.so: no symbols
</span><span class='line'>
</span><span class='line'>$ LD_LIBRARY_PATH=`pwd` ./test
</span><span class='line'>Hello Wen Liao
</span></code></pre></td></tr></table></div></figure>


<p>這邊變成有新的作業，dynamic link的時候沒有shared library沒有symbol怎麼拿到function address和全域變數？下次有看到再來解釋吧。</p>

<h2>補充</h2>

<p>如果編譯的程式碼有加入debug資訊，objdump在反組譯的時候可以加入<code>-S</code>參數比對原始碼對應的機械碼，對於想要研究系統細節的人應該有所幫助。簡單範例如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'> x$ make clean
</span><span class='line'>rm -rf test  test.o  main_test.o
</span><span class='line'>$ make
</span><span class='line'>cc -g   -c -o test.o test.c
</span><span class='line'>cc -g   -c -o main_test.o main_test.c
</span><span class='line'>cc -g test.o main_test.o -o test
</span><span class='line'>
</span><span class='line'>$ objdump -S -d test
</span><span class='line'>
</span><span class='line'>test:     file format elf64-x86-64
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Disassembly of section .init:
</span><span class='line'>
</span><span class='line'>00000000004003e0 &lt;_init&gt;:
</span><span class='line'>  4003e0: 48 83 ec 08             sub    $0x8,%rsp
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>0000000000400553 &lt;test&gt;:
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>void test(void)
</span><span class='line'>{
</span><span class='line'>  400553: 55                      push   %rbp
</span><span class='line'>  400554: 48 89 e5                mov    %rsp,%rbp
</span><span class='line'>    printf(&quot;Hello &quot;);
</span><span class='line'>  400557: bf 24 06 40 00          mov    $0x400624,%edi
</span><span class='line'>  40055c: b8 00 00 00 00          mov    $0x0,%eax
</span><span class='line'>  400561: e8 aa fe ff ff          callq  400410 &lt;printf@plt&gt;
</span><span class='line'>    s_test();
</span><span class='line'>  400566: e8 c2 ff ff ff          callq  40052d &lt;s_test&gt;
</span><span class='line'>}
</span><span class='line'>  40056b: 5d                      pop    %rbp
</span><span class='line'>  40056c: c3                      retq
</span><span class='line'>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>參考資料</h2>

<ul>
<li>Binary Hacks：駭客秘傳技巧一百招</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/14/tai-wan-lao-jie-te-se-pian/">空間母語 - 台灣老街特色篇</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-14T21:32:02+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:32 pm</span></time>
        
           | <a href="/blog/2015/11/14/tai-wan-lao-jie-te-se-pian/#disqus_thread"
             data-disqus-identifier="http://wen00072.github.io/blog/2015/11/14/tai-wan-lao-jie-te-se-pian/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>以下為課程筆記，我沒有專業能力判斷是否有誤解，請自行斟酌。</p>

<ul>
<li>早期職業主要分為士農工商。而

<ul>
<li>士農住三合院或四合院</li>
<li>工商住在市區內，主要是街屋</li>
</ul>
</li>
<li>本次活動主要討論街屋，三合院、四合院不在討論範圍。</li>
<li>早期街屋考量風水，會在街道前後左右出入口安排在廟宇、山川、牆等位置，希望氣不要漏掉。</li>
<li>台灣靠海風大、北部雨多，在這些地區會看到<a href="https://zh.wikipedia.org/zh-tw/%E4%B8%8D%E8%A6%8B%E5%A4%A9%E8%A1%97">不見天街</a>。</li>
<li>街道的兩側的立面就像是臉一樣，各種的裝飾就像面具一樣，發揮自己的個性。</li>
<li>樓井的樓梯入口一般來說不會面對入口方向，原因是風水考量不希望氣跑掉。</li>
<li>過水：兩進(兩落)之間的空間，一般廚房、水井安排在這邊。</li>
<li>陳旺來、陳三川(郭三川)：日治時期的土水師傅，曾經參與大溪老街、迪化街老街街屋、葉金塗宅立面工程。</li>
<li>街屋中，單拱的難度比較高，沒有處理好會出現裂縫。</li>
<li>圓形磚造柱子會使用弧線磚，該磚頭是大正年間才有產出。</li>
<li>弧線立面是巴洛克建築元素之一。</li>
<li>立面工法之一：使用以焦炭為主的材料，捏成丸狀，往特定區域砸，造出凹凸不平的效果。此工法可以去斗六看。</li>
<li>立面工法之二：將黏性物質糊在平面上，再覆蓋上紙。等待一段時間後用力撕開紙張，造出凹凸不平的效果。</li>
<li><a href="http://vr.theatre.ntu.edu.tw/fineart/architect-wt/palladio/palladio.htm">Palladio建築</a></li>
<li>台灣工匠受日本影響

<ul>
<li>刨刀和中國不同，沒有兩邊的握柄。另外操作刨刀方向是朝身體內側刨，而不是朝身體外側刨。</li>
<li>鋸子兩邊都有齒，一邊是粗的，用來鋸和木頭紋理同方向；而細的齒則是用來橫鋸木頭紋理方向。傳統的情況，是會有兩個鋸子，一個是粗的，另外一個是細的。</li>
</ul>
</li>
</ul>


<h2>參考資料</h2>

<ul>
<li><a href="https://www.facebook.com/kjmu.foundation/photos/a.438258032864411.95777.433151266708421/961818460508363/?type=3&amp;theater">活動資訊</a></li>
<li><a href="http://twinhall.org/">新埔鎮雙堂屋</a></li>
<li><a href="http://nrch.culture.tw/twpedia.aspx?id=9055">台灣大百科全書：陳旺來</a></li>
<li><a href="https://zh.wikipedia.org/zh-tw/%E5%A4%A7%E6%BA%AA%E8%80%81%E8%A1%97">Wikipedia: 大溪老街</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/06/08/glibc-surface-observing/">在Ubuntu 18.04.2 Trace 程式呼叫 Glibc 函數</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/03/20/dump-process-memory-block-via-gdb/">從gdb Dump Process 記憶體資料</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/12/12/linux-binary-resources/">Linux Binary 縮寫和連結</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/12/06/update-octopress-environment-for-ubuntu-18-dot-04/">Ubuntu 16.04更新到Ubuntu 18.04後Octopress 環境變動</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/26/vim-posix-group-regex/">Vim POSIX Group Regex 使用方式</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Top Categories</h1>
    <ul id="top-category-list"><li><a href='/blog/categories/linux'>linux (42)</a></li><li><a href='/blog/categories/c'>c (33)</a></li><li><a href='/blog/categories/debian'>debian (16)</a></li><li><a href='/blog/categories/presentation'>presentation (14)</a></li><li><a href='/blog/categories/binutils'>binutils (14)</a></li><li><a href='/blog/categories/arm'>arm (12)</a></li><li><a href='/blog/categories/octopress'>octopress (9)</a></li><li><a href='/blog/categories/gan-xiang'>感想 (8)</a></li><li><a href='/blog/categories/make'>make (6)</a></li><li><a href='/blog/categories/stm32'>stm32 (5)</a></li></ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/arm'>arm (12)</a></li><li><a href='/blog/categories/asm'>asm (1)</a></li><li><a href='/blog/categories/assembler'>assembler (2)</a></li><li><a href='/blog/categories/assembly'>assembly (3)</a></li><li><a href='/blog/categories/autotools'>autotools (4)</a></li><li><a href='/blog/categories/banana-pi'>banana pi (1)</a></li><li><a href='/blog/categories/bash'>bash (1)</a></li><li><a href='/blog/categories/binutil'>binutil (1)</a></li><li><a href='/blog/categories/binutils'>binutils (14)</a></li><li><a href='/blog/categories/buildroot'>buildroot (2)</a></li><li><a href='/blog/categories/c'>c (33)</a></li><li><a href='/blog/categories/c-preprocessor'>c preprocessor (1)</a></li><li><a href='/blog/categories/c99'>c99 (2)</a></li><li><a href='/blog/categories/cmake'>cmake (2)</a></li><li><a href='/blog/categories/cscope'>cscope (1)</a></li><li><a href='/blog/categories/ctags'>ctags (1)</a></li><li><a href='/blog/categories/dbdoclet'>dbdoclet (1)</a></li><li><a href='/blog/categories/debian'>debian (16)</a></li><li><a href='/blog/categories/debootstrap'>debootstrap (1)</a></li><li><a href='/blog/categories/debug'>debug (1)</a></li><li><a href='/blog/categories/doxygen'>doxygen (1)</a></li><li><a href='/blog/categories/elf'>elf (1)</a></li><li><a href='/blog/categories/f9'>f9 (1)</a></li><li><a href='/blog/categories/free-software'>free software (1)</a></li><li><a href='/blog/categories/freertos'>freertos (1)</a></li><li><a href='/blog/categories/fsf'>fsf (1)</a></li><li><a href='/blog/categories/gcc'>gcc (2)</a></li><li><a href='/blog/categories/gdb'>gdb (4)</a></li><li><a href='/blog/categories/getopt'>getopt (1)</a></li><li><a href='/blog/categories/gettext'>gettext (2)</a></li><li><a href='/blog/categories/git'>git (4)</a></li><li><a href='/blog/categories/git-remote'>git remote (2)</a></li><li><a href='/blog/categories/github-flavored-markdown'>github flavored markdown (1)</a></li><li><a href='/blog/categories/github-pages'>github pages (1)</a></li><li><a href='/blog/categories/glibc'>glibc (1)</a></li><li><a href='/blog/categories/gnu'>gnu (2)</a></li><li><a href='/blog/categories/gnu-as'>gnu as (1)</a></li><li><a href='/blog/categories/gpl'>gpl (1)</a></li><li><a href='/blog/categories/gstreamer'>gstreamer (1)</a></li><li><a href='/blog/categories/hole'>hole (1)</a></li><li><a href='/blog/categories/inline'>inline (1)</a></li><li><a href='/blog/categories/javadoc'>javadoc (2)</a></li><li><a href='/blog/categories/kernel'>kernel (1)</a></li><li><a href='/blog/categories/ld'>ld (1)</a></li><li><a href='/blog/categories/libtool'>libtool (2)</a></li><li><a href='/blog/categories/linker'>linker (1)</a></li><li><a href='/blog/categories/linker-script'>linker script (5)</a></li><li><a href='/blog/categories/linux'>linux (42)</a></li><li><a href='/blog/categories/linux-kernel'>linux kernel (3)</a></li><li><a href='/blog/categories/linux-utilities'>linux utilities (2)</a></li><li><a href='/blog/categories/live-cd'>live cd (1)</a></li><li><a href='/blog/categories/lseek'>lseek (1)</a></li><li><a href='/blog/categories/macro'>macro (1)</a></li><li><a href='/blog/categories/make'>make (6)</a></li><li><a href='/blog/categories/markdown'>markdown (2)</a></li><li><a href='/blog/categories/octopress'>octopress (9)</a></li><li><a href='/blog/categories/osm'>osm (1)</a></li><li><a href='/blog/categories/patch'>patch (1)</a></li><li><a href='/blog/categories/pbuilder'>pbuilder (2)</a></li><li><a href='/blog/categories/pomodoro-technique'>pomodoro technique (1)</a></li><li><a href='/blog/categories/presentation'>presentation (14)</a></li><li><a href='/blog/categories/python'>python (4)</a></li><li><a href='/blog/categories/qemu'>qemu (5)</a></li><li><a href='/blog/categories/quilt'>quilt (1)</a></li><li><a href='/blog/categories/regex'>regex (2)</a></li><li><a href='/blog/categories/rtenv'>rtenv (1)</a></li><li><a href='/blog/categories/rtos'>rtos (1)</a></li><li><a href='/blog/categories/semihosting'>semihosting (1)</a></li><li><a href='/blog/categories/shell-script'>shell script (4)</a></li><li><a href='/blog/categories/software-development'>software development (1)</a></li><li><a href='/blog/categories/stm32'>stm32 (5)</a></li><li><a href='/blog/categories/strip'>strip (1)</a></li><li><a href='/blog/categories/trace'>trace (1)</a></li><li><a href='/blog/categories/ubuntu'>ubuntu (1)</a></li><li><a href='/blog/categories/upnp'>upnp (1)</a></li><li><a href='/blog/categories/usb'>usb (1)</a></li><li><a href='/blog/categories/valgrind'>valgrind (2)</a></li><li><a href='/blog/categories/vim'>vim (5)</a></li><li><a href='/blog/categories/vim-plugin'>vim plugin (1)</a></li><li><a href='/blog/categories/virtualbox'>virtualbox (2)</a></li><li><a href='/blog/categories/vundle'>vundle (1)</a></li><li><a href='/blog/categories/wireless'>wireless (1)</a></li><li><a href='/blog/categories/wpa-supplicant'>wpa_supplicant (1)</a></li><li><a href='/blog/categories/tai-wan-xiao-chi'>台灣小吃 (1)</a></li><li><a href='/blog/categories/gan-xiang'>感想 (8)</a></li><li><a href='/blog/categories/kuang-rou'>爌肉 (1)</a></li><li><a href='/blog/categories/bi-ji'>筆記 (2)</a></li><li><a href='/blog/categories/zu-zhuang'>組裝 (3)</a></li><li><a href='/blog/categories/lao-jian-zhu'>老建築 (3)</a></li><li><a href='/blog/categories/guo-qi'>過期 (3)</a></li></ul>
</section>
<section>
  <h1>Category Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/arm' style='font-size: 117.14285714285714%'>arm(12)</a> <a href='/blog/categories/asm' style='font-size: 101.42857142857143%'>asm(1)</a> <a href='/blog/categories/assembler' style='font-size: 102.85714285714286%'>assembler(2)</a> <a href='/blog/categories/assembly' style='font-size: 104.28571428571429%'>assembly(3)</a> <a href='/blog/categories/autotools' style='font-size: 105.71428571428571%'>autotools(4)</a> <a href='/blog/categories/banana-pi' style='font-size: 101.42857142857143%'>banana pi(1)</a> <a href='/blog/categories/bash' style='font-size: 101.42857142857143%'>bash(1)</a> <a href='/blog/categories/binutil' style='font-size: 101.42857142857143%'>binutil(1)</a> <a href='/blog/categories/binutils' style='font-size: 120.0%'>binutils(14)</a> <a href='/blog/categories/buildroot' style='font-size: 102.85714285714286%'>buildroot(2)</a> <a href='/blog/categories/c' style='font-size: 147.14285714285714%'>c(33)</a> <a href='/blog/categories/c-preprocessor' style='font-size: 101.42857142857143%'>c preprocessor(1)</a> <a href='/blog/categories/c99' style='font-size: 102.85714285714286%'>c99(2)</a> <a href='/blog/categories/cmake' style='font-size: 102.85714285714286%'>cmake(2)</a> <a href='/blog/categories/cscope' style='font-size: 101.42857142857143%'>cscope(1)</a> <a href='/blog/categories/ctags' style='font-size: 101.42857142857143%'>ctags(1)</a> <a href='/blog/categories/dbdoclet' style='font-size: 101.42857142857143%'>dbdoclet(1)</a> <a href='/blog/categories/debian' style='font-size: 122.85714285714286%'>debian(16)</a> <a href='/blog/categories/debootstrap' style='font-size: 101.42857142857143%'>debootstrap(1)</a> <a href='/blog/categories/debug' style='font-size: 101.42857142857143%'>debug(1)</a> <a href='/blog/categories/doxygen' style='font-size: 101.42857142857143%'>doxygen(1)</a> <a href='/blog/categories/elf' style='font-size: 101.42857142857143%'>elf(1)</a> <a href='/blog/categories/f9' style='font-size: 101.42857142857143%'>f9(1)</a> <a href='/blog/categories/free-software' style='font-size: 101.42857142857143%'>free software(1)</a> <a href='/blog/categories/freertos' style='font-size: 101.42857142857143%'>freertos(1)</a> <a href='/blog/categories/fsf' style='font-size: 101.42857142857143%'>fsf(1)</a> <a href='/blog/categories/gcc' style='font-size: 102.85714285714286%'>gcc(2)</a> <a href='/blog/categories/gdb' style='font-size: 105.71428571428571%'>gdb(4)</a> <a href='/blog/categories/getopt' style='font-size: 101.42857142857143%'>getopt(1)</a> <a href='/blog/categories/gettext' style='font-size: 102.85714285714286%'>gettext(2)</a> <a href='/blog/categories/git' style='font-size: 105.71428571428571%'>git(4)</a> <a href='/blog/categories/git-remote' style='font-size: 102.85714285714286%'>git remote(2)</a> <a href='/blog/categories/github-flavored-markdown' style='font-size: 101.42857142857143%'>github flavored markdown(1)</a> <a href='/blog/categories/github-pages' style='font-size: 101.42857142857143%'>github pages(1)</a> <a href='/blog/categories/glibc' style='font-size: 101.42857142857143%'>glibc(1)</a> <a href='/blog/categories/gnu' style='font-size: 102.85714285714286%'>gnu(2)</a> <a href='/blog/categories/gnu-as' style='font-size: 101.42857142857143%'>gnu as(1)</a> <a href='/blog/categories/gpl' style='font-size: 101.42857142857143%'>gpl(1)</a> <a href='/blog/categories/gstreamer' style='font-size: 101.42857142857143%'>gstreamer(1)</a> <a href='/blog/categories/hole' style='font-size: 101.42857142857143%'>hole(1)</a> <a href='/blog/categories/inline' style='font-size: 101.42857142857143%'>inline(1)</a> <a href='/blog/categories/javadoc' style='font-size: 102.85714285714286%'>javadoc(2)</a> <a href='/blog/categories/kernel' style='font-size: 101.42857142857143%'>kernel(1)</a> <a href='/blog/categories/ld' style='font-size: 101.42857142857143%'>ld(1)</a> <a href='/blog/categories/libtool' style='font-size: 102.85714285714286%'>libtool(2)</a> <a href='/blog/categories/linker' style='font-size: 101.42857142857143%'>linker(1)</a> <a href='/blog/categories/linker-script' style='font-size: 107.14285714285714%'>linker script(5)</a> <a href='/blog/categories/linux' style='font-size: 160.0%'>linux(42)</a> <a href='/blog/categories/linux-kernel' style='font-size: 104.28571428571429%'>linux kernel(3)</a> <a href='/blog/categories/linux-utilities' style='font-size: 102.85714285714286%'>linux utilities(2)</a> <a href='/blog/categories/live-cd' style='font-size: 101.42857142857143%'>live cd(1)</a> <a href='/blog/categories/lseek' style='font-size: 101.42857142857143%'>lseek(1)</a> <a href='/blog/categories/macro' style='font-size: 101.42857142857143%'>macro(1)</a> <a href='/blog/categories/make' style='font-size: 108.57142857142857%'>make(6)</a> <a href='/blog/categories/markdown' style='font-size: 102.85714285714286%'>markdown(2)</a> <a href='/blog/categories/octopress' style='font-size: 112.85714285714286%'>octopress(9)</a> <a href='/blog/categories/osm' style='font-size: 101.42857142857143%'>osm(1)</a> <a href='/blog/categories/patch' style='font-size: 101.42857142857143%'>patch(1)</a> <a href='/blog/categories/pbuilder' style='font-size: 102.85714285714286%'>pbuilder(2)</a> <a href='/blog/categories/pomodoro-technique' style='font-size: 101.42857142857143%'>pomodoro technique(1)</a> <a href='/blog/categories/presentation' style='font-size: 120.0%'>presentation(14)</a> <a href='/blog/categories/python' style='font-size: 105.71428571428571%'>python(4)</a> <a href='/blog/categories/qemu' style='font-size: 107.14285714285714%'>qemu(5)</a> <a href='/blog/categories/quilt' style='font-size: 101.42857142857143%'>quilt(1)</a> <a href='/blog/categories/regex' style='font-size: 102.85714285714286%'>regex(2)</a> <a href='/blog/categories/rtenv' style='font-size: 101.42857142857143%'>rtenv(1)</a> <a href='/blog/categories/rtos' style='font-size: 101.42857142857143%'>rtos(1)</a> <a href='/blog/categories/semihosting' style='font-size: 101.42857142857143%'>semihosting(1)</a> <a href='/blog/categories/shell-script' style='font-size: 105.71428571428571%'>shell script(4)</a> <a href='/blog/categories/software-development' style='font-size: 101.42857142857143%'>software development(1)</a> <a href='/blog/categories/stm32' style='font-size: 107.14285714285714%'>stm32(5)</a> <a href='/blog/categories/strip' style='font-size: 101.42857142857143%'>strip(1)</a> <a href='/blog/categories/trace' style='font-size: 101.42857142857143%'>trace(1)</a> <a href='/blog/categories/ubuntu' style='font-size: 101.42857142857143%'>ubuntu(1)</a> <a href='/blog/categories/upnp' style='font-size: 101.42857142857143%'>upnp(1)</a> <a href='/blog/categories/usb' style='font-size: 101.42857142857143%'>usb(1)</a> <a href='/blog/categories/valgrind' style='font-size: 102.85714285714286%'>valgrind(2)</a> <a href='/blog/categories/vim' style='font-size: 107.14285714285714%'>vim(5)</a> <a href='/blog/categories/vim-plugin' style='font-size: 101.42857142857143%'>vim plugin(1)</a> <a href='/blog/categories/virtualbox' style='font-size: 102.85714285714286%'>virtualbox(2)</a> <a href='/blog/categories/vundle' style='font-size: 101.42857142857143%'>vundle(1)</a> <a href='/blog/categories/wireless' style='font-size: 101.42857142857143%'>wireless(1)</a> <a href='/blog/categories/wpa-supplicant' style='font-size: 101.42857142857143%'>wpa_supplicant(1)</a> <a href='/blog/categories/tai-wan-xiao-chi' style='font-size: 101.42857142857143%'>台灣小吃(1)</a> <a href='/blog/categories/gan-xiang' style='font-size: 111.42857142857143%'>感想(8)</a> <a href='/blog/categories/kuang-rou' style='font-size: 101.42857142857143%'>爌肉(1)</a> <a href='/blog/categories/bi-ji' style='font-size: 102.85714285714286%'>筆記(2)</a> <a href='/blog/categories/zu-zhuang' style='font-size: 104.28571428571429%'>組裝(3)</a> <a href='/blog/categories/lao-jian-zhu' style='font-size: 104.28571428571429%'>老建築(3)</a> <a href='/blog/categories/guo-qi' style='font-size: 104.28571428571429%'>過期(3)</a> </span>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.<br>
  Copyright &copy; 2019 - Wen Liao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'httpwen00072githubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
